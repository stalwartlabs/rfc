<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>JMAP Enhanced Result References</title>
<meta content="Mauro De Gennaro" name="author">
<meta content="
       This document specifies an extension to the JSON Meta Application Protocol (JMAP) that enhances the result reference mechanism defined in  . The extension allows result references to be used in additional contexts beyond method call arguments, specifically within object properties during JMAP /set operations and within FilterCondition objects used in /query operations. Additionally, this specification extends result references to support JSON Path expressions ( ) as an alternative to JSON Pointer ( ), providing more expressive query capabilities for extracting values from previous method call results. These enhancements enable more efficient data reuse patterns across JMAP method calls, reducing the need for multiple round trips between client and server. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-degennaro-jmap-enhanced-references-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.13.3
    ConfigArgParse 1.7.1
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.0
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="index.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://static.ietf.org/fonts/noto-sans/import.css'); /* Sans-serif */
@import url('https://static.ietf.org/fonts/noto-serif/import.css'); /* Serif (print) */
@import url('https://static.ietf.org/fonts/roboto-mono/import.css'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
@media print {
  svg {
    max-height: 850px;
    max-width: 660px;
  }
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > blockquote:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">JMAP Enhanced Result References</td>
<td class="right">October 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">De Gennaro</td>
<td class="center">Expires 29 April 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-degennaro-jmap-enhanced-references-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-10-26" class="published">26 October 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-04-29">29 April 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. De Gennaro</div>
<div class="org">Stalwart Labs</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">JMAP Enhanced Result References</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies an extension to the JSON Meta Application Protocol (JMAP) that enhances the result reference mechanism defined in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>. The extension allows result references to be used in additional contexts beyond method call arguments, specifically within object properties during JMAP /set operations and within FilterCondition objects used in /query operations. Additionally, this specification extends result references to support JSON Path expressions (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>) as an alternative to JSON Pointer (<span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>), providing more expressive query capabilities for extracting values from previous method call results. These enhancements enable more efficient data reuse patterns across JMAP method calls, reducing the need for multiple round trips between client and server.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 29 April 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-notational-conventions" class="internal xref">Notational Conventions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-addition-to-the-capabilitie" class="internal xref">Addition to the Capabilities Object</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="auto internal xref">1.2.1</a>.  <a href="#name-urnietfparamsjmaprefplus" class="internal xref">urn:ietf:params:jmap:refplus</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-enhanced-result-references" class="internal xref">Enhanced Result References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-json-path-support" class="internal xref">JSON Path Support</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-comparison-with-json-pointe" class="internal xref">Comparison with JSON Pointer</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-support-and-capabilities" class="internal xref">Support and Capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.3">
                    <p id="section-toc.1-1.2.2.1.2.3.1"><a href="#section-2.1.3" class="auto internal xref">2.1.3</a>.  <a href="#name-validation-requirements" class="internal xref">Validation Requirements</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-resolution-algorithm" class="internal xref">Resolution Algorithm</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-resolving-json-path-referen" class="internal xref">Resolving JSON Path References</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-resolving-json-pointer-refe" class="internal xref">Resolving JSON Pointer References</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="auto internal xref">2.2.3</a>.  <a href="#name-type-validation" class="internal xref">Type Validation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-usage-in-set-methods" class="internal xref">Usage in /set Methods</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-usage-in-patch-objects" class="internal xref">Usage in Patch Objects</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-usage-in-filtercondition-ob" class="internal xref">Usage in FilterCondition Objects</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-usage-in-set" class="internal xref">Usage in /set</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-usage-in-set-patch-objects" class="internal xref">Usage in /set patch objects</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-usage-in-query-filtercondit" class="internal xref">Usage in /query FilterCondition</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-extracting-multiple-values-" class="internal xref">Extracting Multiple Values with JSON Path</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-denial-of-service-considera" class="internal xref">Denial of Service Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-computational-complexity-of" class="internal xref">Computational Complexity of JSON Path</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-resource-exhaustion-through" class="internal xref">Resource Exhaustion Through Reference Chains</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="auto internal xref">4.1.3</a>.  <a href="#name-algorithmic-complexity-atta" class="internal xref">Algorithmic Complexity Attacks</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-data-integrity-and-validati" class="internal xref">Data Integrity and Validation Concerns</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="auto internal xref">4.2.1</a>.  <a href="#name-type-confusion" class="internal xref">Type Confusion</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="auto internal xref">4.2.2</a>.  <a href="#name-injection-attacks" class="internal xref">Injection Attacks</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="auto internal xref">4.2.3</a>.  <a href="#name-circular-reference-preventi" class="internal xref">Circular Reference Prevention</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-data-leakage-across-context" class="internal xref">Data Leakage Across Contexts</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-audit-and-logging" class="internal xref">Audit and Logging</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-implementation-consideratio" class="internal xref">Implementation Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.  <a href="#name-parser-security" class="internal xref">Parser Security</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="auto internal xref">4.4.2</a>.  <a href="#name-cache-security" class="internal xref">Cache Security</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="auto internal xref">4.4.3</a>.  <a href="#name-backward-compatibility" class="internal xref">Backward Compatibility</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-iana-considerations" class="internal xref">IANA considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-jmap-capability-registratio" class="internal xref">JMAP Capability Registration for "refplus"</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-changes" class="internal xref">Changes</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">JMAP (<span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> — JSON Meta Application Protocol) is a generic protocol for synchronizing data, such as mail, calendars or contacts, between a client and a server. It is optimized for mobile and web environments, and aims to provide a consistent interface to different data types.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">One of JMAP's core design principles is its ability to build efficient request chains that minimize the number of round trips between client and server. This is achieved through the result reference mechanism defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, which allows method call arguments to reference the results of previous method calls within the same request. When processing a request, the server executes method calls sequentially, and any argument prefixed with "#" (an octothorpe) is resolved by extracting the specified value from a previous method call's result before the current method is executed.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Since the publication of JMAP Core (<span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>) and JMAP for Mail (<span>[<a href="#RFC8621" class="cite xref">RFC8621</a>]</span>), the JMAP ecosystem has expanded significantly with the definition of multiple additional data types and extensions, including JMAP for Calendars (<span>[<a href="#I-D.ietf-jmap-calendars" class="cite xref">I-D.ietf-jmap-calendars</a>]</span>), JMAP for Contacts (<span>[<a href="#RFC9610" class="cite xref">RFC9610</a>]</span>), and others. This growth has revealed practical limitations in the current result reference mechanism. Many real-world use cases require creating JMAP objects that incorporate data from other JMAP objects. For example, when creating a CalendarEvent, it is often necessary to copy "Participant" or "Location" objects from an existing event. Similarly, when creating Email objects, reusing attachment information or recipient lists from other messages would be beneficial.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The current result reference mechanism, however, is limited to method call arguments. This restriction prevents result references from being used within the object structures passed to /set methods for creating or updating records, or within FilterCondition objects used in /query methods. These limitations force clients to either make additional round trips to fetch intermediate data or to duplicate data within the request, both of which reduce efficiency.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Furthermore, JMAP Core exclusively uses JSON Pointer (<span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>) syntax for navigating result structures. While JSON Pointer is simple and efficient, it has limited expressive power for certain selection patterns. JSON Path (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>), a more recent standard, provides a richer query language for extracting values from JSON structures, including support for filters, array slicing, and more sophisticated selection patterns.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Therefore, this document aims to extend the result references defined in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> to be usable in multiple additional contexts, specifically within JMAP /set method calls for object property values and within FilterCondition objects used in /query methods. Additionally, this specification defines support for JSON Path (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>) expressions as an optional alternative to JSON Pointer, enabling more powerful value extraction capabilities while maintaining backward compatibility with existing implementations.<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="notational-conventions">
<section id="section-1.1">
        <h3 id="name-notational-conventions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="addition-to-the-capabilities-object">
<section id="section-1.2">
        <h3 id="name-addition-to-the-capabilitie">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-addition-to-the-capabilitie" class="section-name selfRef">Addition to the Capabilities Object</a>
        </h3>
<p id="section-1.2-1">The capabilities object is returned as part of the JMAP Session object; see <span><a href="https://rfc-editor.org/rfc/rfc8620#section-2" class="relref">Section 2</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>. This document defines one additional capability URI.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<div id="urnietfparamsjmaprefplus">
<section id="section-1.2.1">
          <h4 id="name-urnietfparamsjmaprefplus">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-urnietfparamsjmaprefplus" class="section-name selfRef">urn:ietf:params:jmap:refplus</a>
          </h4>
<p id="section-1.2.1-1">This capability indicates that the server supports enhanced result references as defined in this specification. When this capability is present, clients may use result references within /set method object properties and FilterCondition objects, in addition to the standard method call argument usage defined in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-1.2.1-2">The value of this property in the JMAP Session "capabilities" property is an empty object.<a href="#section-1.2.1-2" class="pilcrow">¶</a></p>
<p id="section-1.2.1-3">The value of this property in an account's "accountCapabilities" property is an object that <span class="bcp14">MUST</span> contain the following information on server capabilities and permissions for that account:<a href="#section-1.2.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.2.1-4">
            <dt id="section-1.2.1-4.1">
<strong>jsonPath</strong>: <code>Boolean</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-1.2.1-4.2">
              <p id="section-1.2.1-4.2.1">Whether the server supports JSON Path expressions in result references. If true, result references may use JSON Path (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>) syntax in addition to JSON Pointer (<span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>) syntax. If false or absent, only JSON Pointer syntax is supported.<a href="#section-1.2.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="enhanced-result-references">
<section id="section-2">
      <h2 id="name-enhanced-result-references">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-enhanced-result-references" class="section-name selfRef">Enhanced Result References</a>
      </h2>
<p id="section-2-1">Enhanced result references extend the existing result reference mechanism defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> to enable broader applicability and more expressive value extraction. Specifically, enhanced result references support two key extensions to the base mechanism:<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">First, enhanced result references may be used in additional contexts beyond method call arguments. They may be used anywhere within a "Foo" object when creating or updating such an object via the Foo/set method, allowing property values to be derived from previous method call results. They may also be used within FilterCondition objects in Foo/query method calls, enabling dynamic query construction based on prior results.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Second, enhanced result references optionally support JSON Path (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>) expressions as an alternative to JSON Pointer (<span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>) for extracting values from result structures. JSON Path provides more sophisticated query capabilities, including array filtering, recursive descent, and complex selection patterns, while JSON Pointer remains the baseline requirement for all implementations.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">The syntax and resolution mechanism for enhanced result references follows the same fundamental pattern as standard result references, with extensions to accommodate the new contexts and optional JSON Path support. Backward compatibility is maintained: clients that do not use enhanced result references, and servers that do not advertise the <code>urn:ietf:params:jmap:refplus</code> capability, interoperate normally using the base result reference mechanism from <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-2-4" class="pilcrow">¶</a></p>
<div id="json-path-support">
<section id="section-2.1">
        <h3 id="name-json-path-support">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-json-path-support" class="section-name selfRef">JSON Path Support</a>
        </h3>
<p id="section-2.1-1">JSON Path (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>) is a query language for JSON that provides powerful capabilities for selecting and extracting values from JSON structures. While JSON Pointer (<span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>) provides a simple notation for referencing a specific value within a JSON document using a sequence of reference tokens, JSON Path offers a more expressive syntax that supports complex queries including filters, recursive descent, array slicing, and wildcard selections.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div id="comparison-with-json-pointer">
<section id="section-2.1.1">
          <h4 id="name-comparison-with-json-pointe">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-comparison-with-json-pointe" class="section-name selfRef">Comparison with JSON Pointer</a>
          </h4>
<p id="section-2.1.1-1">The key differences between JSON Pointer and JSON Path include:<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1.1-2.1">
              <p id="section-2.1.1-2.1.1">JSON Pointer uses a simple path syntax with "/" separators and identifies exactly one value. JSON Path uses a richer syntax with multiple selector types and can return zero, one, or multiple values.<a href="#section-2.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.1-2.2">
              <p id="section-2.1.1-2.2.1">JSON Pointer is deterministic and always produces the same result for a given document. JSON Path queries may be order-dependent when multiple values match.<a href="#section-2.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.1-2.3">
              <p id="section-2.1.1-2.3.1">JSON Pointer has no conditional or filtering capabilities. JSON Path supports filter expressions, enabling selection based on value predicates.<a href="#section-2.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.1.1-2.4">
              <p id="section-2.1.1-2.4.1">JSON Pointer requires exact knowledge of the structure. JSON Path supports recursive descent (..) allowing queries to find values at any depth.<a href="#section-2.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="support-and-capabilities">
<section id="section-2.1.2">
          <h4 id="name-support-and-capabilities">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-support-and-capabilities" class="section-name selfRef">Support and Capabilities</a>
          </h4>
<p id="section-2.1.2-1">Enhanced result references extend the base result reference mechanism to optionally support JSON Path expressions. This support is indicated by the "jsonPath" property in the account capabilities being set to true. Servers <span class="bcp14">MAY</span> implement JSON Path support, as it can be more resource-intensive than JSON Pointer due to the potential for complex query evaluation.<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2-2">When a server supports JSON Path, enhanced result references may use JSON Path syntax as an alternative to JSON Pointer syntax in the "path" property of a ResultReference object. To indicate that a path should be interpreted as a JSON Path expression rather than a JSON Pointer, the path <span class="bcp14">MUST</span> begin with "$" (dollar sign), which is the root node identifier in JSON Path syntax. Paths not beginning with "$" are interpreted as JSON Pointer expressions following the rules in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-2.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validation-requirements">
<section id="section-2.1.3">
          <h4 id="name-validation-requirements">
<a href="#section-2.1.3" class="section-number selfRef">2.1.3. </a><a href="#name-validation-requirements" class="section-name selfRef">Validation Requirements</a>
          </h4>
<p id="section-2.1.3-1">If the JSON Path expression is syntactically invalid according to <span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>, the server <span class="bcp14">MUST</span> reject the method call with an "invalidResultReference" error. The error description <span class="bcp14">SHOULD</span> indicate the syntax error where possible.<a href="#section-2.1.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.3-2">If a client attempts to use a JSON Path expression (path beginning with "$") but the server does not support JSON Path (jsonPath capability is false or absent), the server <span class="bcp14">MUST</span> reject the method call with an "invalidResultReference" error. The error description <span class="bcp14">SHOULD</span> indicate that JSON Path is not supported.<a href="#section-2.1.3-2" class="pilcrow">¶</a></p>
<p id="section-2.1.3-3">Servers supporting JSON Path <span class="bcp14">SHOULD</span> implement the complete JSON Path specification as defined in <span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>, including all standard function extensions. However, servers <span class="bcp14">MAY</span> limit the complexity of JSON Path expressions for security or performance reasons, for example by restricting maximum expression length, maximum result set size, or computational complexity. If a server rejects a valid JSON Path expression due to such limitations, it <span class="bcp14">SHOULD</span> return an "invalidResultReference" error with a description indicating the specific limitation encountered.<a href="#section-2.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="resolution-algorithm">
<section id="section-2.2">
        <h3 id="name-resolution-algorithm">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-resolution-algorithm" class="section-name selfRef">Resolution Algorithm</a>
        </h3>
<p id="section-2.2-1">This section defines the algorithm for resolving enhanced result references, which extends the base resolution mechanism defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> to handle both JSON Path expressions and extended JSON Pointer expressions (including wildcard support).<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">When processing a ResultReference object, the server <span class="bcp14">MUST</span> follow these steps:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-3">
<li id="section-2.2-3.1">
            <p id="section-2.2-3.1.1">Resolve the "resultOf" and "name" properties to identify the target method response, as defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.2-3.2">
            <p id="section-2.2-3.2.1">Identify the second element of the method response array (the arguments object) as the target JSON structure for path evaluation.<a href="#section-2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.2-3.3">
            <p id="section-2.2-3.3.1">Determine whether the "path" property uses JSON Path or JSON Pointer syntax:<a href="#section-2.2-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.3.2.1">
                <p id="section-2.2-3.3.2.1.1">If the path begins with "$" (dollar sign), treat it as a JSON Path expression.<a href="#section-2.2-3.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-2.2-3.3.2.2">
                <p id="section-2.2-3.3.2.2.1">Otherwise, treat it as a JSON Pointer expression.<a href="#section-2.2-3.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-2.2-3.4">
            <p id="section-2.2-3.4.1">Evaluate the path expression against the target JSON structure according to the appropriate specification (<span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span> for JSON Path, <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span> for JSON Pointer).<a href="#section-2.2-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.2-3.5">
            <p id="section-2.2-3.5.1">Apply the type-specific resolution rules defined in this section to produce the final resolved value.<a href="#section-2.2-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div id="resolving-json-path-references">
<section id="section-2.2.1">
          <h4 id="name-resolving-json-path-referen">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-resolving-json-path-referen" class="section-name selfRef">Resolving JSON Path References</a>
          </h4>
<p id="section-2.2.1-1">When processing a ResultReference with a JSON Path expression, the server <span class="bcp14">MUST</span>:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.1-2">
<li id="section-2.2.1-2.1">
              <p id="section-2.2.1-2.1.1">Apply the JSON Path expression (the "path" value) to the arguments object of the identified response.<a href="#section-2.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.1-2.2">
              <p id="section-2.2.1-2.2.1">Evaluate the JSON Path expression according to <span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span> to produce a nodelist.<a href="#section-2.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.1-2.3">
              <p id="section-2.2.1-2.3.1">Determine the expected type of the property being set and resolve the nodelist according to the following type-specific rules.<a href="#section-2.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-2.2.1-3">The nodelist produced by JSON Path evaluation <span class="bcp14">MUST</span> be resolved according to the expected type of the target property:<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">For properties that expect <strong>JSON primitive types</strong> (String, Boolean, Number as defined in <span>[<a href="#RFC8259" class="cite xref">RFC8259</a>]</span>, or null) or a <strong>single JMAP object</strong> type:<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1-5.1">
              <p id="section-2.2.1-5.1.1">If the nodelist contains exactly one node, use that node's value as the resolved value.<a href="#section-2.2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-5.2">
              <p id="section-2.2.1-5.2.1">If the nodelist contains zero nodes, use null as the resolved value.<a href="#section-2.2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-5.3">
              <p id="section-2.2.1-5.3.1">If the nodelist contains more than one node, the result reference resolution fails with an "invalidResultReference" error.<a href="#section-2.2.1-5.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.1-6">For properties that expect an <strong>array type</strong> (denoted as "A[]" in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-1.1" class="relref">Section 1.1</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, where A[] is an array of values of type A):<a href="#section-2.2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1-7.1">
              <p id="section-2.2.1-7.1.1">Map the nodelist to an array containing the value of each node in the nodelist, in the order specified by <span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span>.<a href="#section-2.2.1-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-7.2">
              <p id="section-2.2.1-7.2.1">If the nodelist contains zero nodes, use an empty array as the resolved value.<a href="#section-2.2.1-7.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-7.3">
              <p id="section-2.2.1-7.3.1">If the nodelist contains one or more nodes, use an array containing all node values as the resolved value.<a href="#section-2.2.1-7.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.1-8">For properties that expect a <strong>map type</strong> (denoted as "A[B]" in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-1.1" class="relref">Section 1.1</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, where the keys are of type A and the values are of type B):<a href="#section-2.2.1-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.1-9.1">
              <p id="section-2.2.1-9.1.1">If the nodelist contains exactly one node and that node's value is a JSON object conforming to the A[B] type, use that object as the resolved value.<a href="#section-2.2.1-9.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-9.2">
              <p id="section-2.2.1-9.2.1">If the nodelist contains zero nodes, use an empty object {} as the resolved value.<a href="#section-2.2.1-9.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.1-9.3">
              <p id="section-2.2.1-9.3.1">If the nodelist contains more than one node, or if the single node's value is not a JSON object, the result reference resolution fails with an "invalidResultReference" error.<a href="#section-2.2.1-9.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="resolving-json-pointer-references">
<section id="section-2.2.2">
          <h4 id="name-resolving-json-pointer-refe">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-resolving-json-pointer-refe" class="section-name selfRef">Resolving JSON Pointer References</a>
          </h4>
<p id="section-2.2.2-1">JSON Pointer expressions, as defined in <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>, provide a deterministic path to a single value within a JSON structure. However, <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> extends JSON Pointer syntax to support wildcards ("*") in certain contexts, allowing a single pointer to match multiple values. This extension is maintained in enhanced result references.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">When processing a ResultReference with a JSON Pointer expression, the server <span class="bcp14">MUST</span>:<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2.2-3">
<li id="section-2.2.2-3.1">
              <p id="section-2.2.2-3.1.1">Apply the JSON Pointer expression (the "path" value) to the arguments object of the identified response.<a href="#section-2.2.2-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.2-3.2">
              <p id="section-2.2.2-3.2.1">Evaluate the JSON Pointer expression according to <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>, with wildcard extensions as defined in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-2.2.2-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.2.2-3.3">
              <p id="section-2.2.2-3.3.1">Determine the expected type of the property being set and resolve according to the following type-specific rules.<a href="#section-2.2.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-2.2.2-4">The result produced by JSON Pointer evaluation (which may be a single value or multiple values when wildcards are used) <span class="bcp14">MUST</span> be resolved according to the expected type of the target property:<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2.2-5">For properties that expect <strong>JSON primitive types</strong> (String, Boolean, Number as defined in <span>[<a href="#RFC8259" class="cite xref">RFC8259</a>]</span>, or null) or a <strong>single JMAP object</strong> type:<a href="#section-2.2.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-6.1">
              <p id="section-2.2.2-6.1.1">If the pointer identifies exactly one value, use that value as the resolved value.<a href="#section-2.2.2-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-6.2">
              <p id="section-2.2.2-6.2.1">If the pointer contains wildcards and matches zero values, use null as the resolved value.<a href="#section-2.2.2-6.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-6.3">
              <p id="section-2.2.2-6.3.1">If the pointer contains wildcards and matches more than one value, the result reference resolution fails with an "invalidResultReference" error.<a href="#section-2.2.2-6.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-6.4">
              <p id="section-2.2.2-6.4.1">If the pointer does not contain wildcards and does not match any value, the result reference resolution fails with an "invalidResultReference" error (per <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>).<a href="#section-2.2.2-6.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.2-7">For properties that expect an <strong>array type</strong> (denoted as "A[]" in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-1.1" class="relref">Section 1.1</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, where A[] is an array of values of type A):<a href="#section-2.2.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-8.1">
              <p id="section-2.2.2-8.1.1">If the pointer identifies a single value that is already an array, use that array as the resolved value.<a href="#section-2.2.2-8.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-8.2">
              <p id="section-2.2.2-8.2.1">If the pointer contains wildcards and matches multiple values, collect all matched values into an array in the order they appear in the document structure.<a href="#section-2.2.2-8.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-8.3">
              <p id="section-2.2.2-8.3.1">If the pointer contains wildcards and matches zero values, use an empty array as the resolved value.<a href="#section-2.2.2-8.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-8.4">
              <p id="section-2.2.2-8.4.1">If the pointer identifies a single value that is not an array, create an array containing that single value as the resolved value.<a href="#section-2.2.2-8.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.2.2-9">For properties that expect a <strong>map type</strong> (denoted as "A[B]" in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-1.1" class="relref">Section 1.1</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, where the keys are of type A and the values are of type B):<a href="#section-2.2.2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-10.1">
              <p id="section-2.2.2-10.1.1">If the pointer identifies exactly one value and that value is a JSON object conforming to the A[B] type, use that object as the resolved value.<a href="#section-2.2.2-10.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-10.2">
              <p id="section-2.2.2-10.2.1">If the pointer contains wildcards and matches zero values, use an empty object {} as the resolved value.<a href="#section-2.2.2-10.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.2.2-10.3">
              <p id="section-2.2.2-10.3.1">If the pointer contains wildcards and matches more than one value, or if the single identified value is not a JSON object, the result reference resolution fails with an "invalidResultReference" error.<a href="#section-2.2.2-10.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="type-validation">
<section id="section-2.2.3">
          <h4 id="name-type-validation">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-type-validation" class="section-name selfRef">Type Validation</a>
          </h4>
<p id="section-2.2.3-1">After applying the type-specific resolution rules, the server <span class="bcp14">MUST</span> validate that the resolved value conforms to the expected type for the property. If type validation fails after resolution, the server <span class="bcp14">MUST</span> reject the operation with an "invalidProperties" error (for /set operations) or an "invalidArguments" error (for /query operations).<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="usage-in-set-methods">
<section id="section-2.3">
        <h3 id="name-usage-in-set-methods">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-usage-in-set-methods" class="section-name selfRef">Usage in /set Methods</a>
        </h3>
<p id="section-2.3-1">Enhanced result references may be used anywhere within object property values when creating or updating objects via the Foo/set method. This enables efficient reuse of data from previous method calls when constructing new objects or modifying existing ones.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">To use an enhanced result reference within an object property, the property name is prefixed with "#" (an octothorpe), and the value is set to a ResultReference object as defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>. This follows the same pattern as using result references in method call arguments. For example, to set a property "participants" to a value from a previous result, the object would include a property "#participants" with a ResultReference value.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Enhanced result references may be used at any depth within the object structure, not just at the top level. For nested objects and arrays, result references can be applied to properties at any level of nesting. The server <span class="bcp14">MUST</span> recursively process all levels of object and array nesting to resolve all result references before validating the complete object structure.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">When processing a Foo/set method call, the server <span class="bcp14">MUST</span> examine all objects in the "create" and "update" arguments for properties with names beginning with "#". For each such property found, the server <span class="bcp14">MUST</span>:<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3-5">
<li id="section-2.3-5.1">
            <p id="section-2.3-5.1.1">Remove the "#" prefix to determine the actual property name.<a href="#section-2.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.3-5.2">
            <p id="section-2.3-5.2.1">Resolve the ResultReference value following the resolution algorithm defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, with the extensions defined in this specification.<a href="#section-2.3-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.3-5.3">
            <p id="section-2.3-5.3.1">Set the actual property to the resolved value.<a href="#section-2.3-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.3-5.4">
            <p id="section-2.3-5.4.1">Remove the property with the "#" prefix from the object.<a href="#section-2.3-5.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.3-6">If a result reference fails to resolve, the server <span class="bcp14">MUST</span> reject the creation or update of that specific object with a SetError of type "invalidResultReference". The SetError <span class="bcp14">SHOULD</span> include a description indicating which property reference failed and why.<a href="#section-2.3-6" class="pilcrow">¶</a></p>
<p id="section-2.3-7">If an object contains both a property name with "#" prefix and the same property name without the prefix (e.g., both "#participants" and "participants"), the server <span class="bcp14">MUST</span> reject the creation or update with a SetError of type "invalidProperties", as this represents an ambiguous specification.<a href="#section-2.3-7" class="pilcrow">¶</a></p>
<p id="section-2.3-8">The resolved value <span class="bcp14">MUST</span> be of a type appropriate for the property being set. If the resolved value does not match the expected type for the property, the server <span class="bcp14">MUST</span> reject the creation or update with a SetError of type "invalidProperties". Type validation occurs after result reference resolution but before other property validation.<a href="#section-2.3-8" class="pilcrow">¶</a></p>
<div id="usage-in-patch-objects">
<section id="section-2.3.1">
          <h4 id="name-usage-in-patch-objects">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-usage-in-patch-objects" class="section-name selfRef">Usage in Patch Objects</a>
          </h4>
<p id="section-2.3.1-1">Enhanced result references may also be used as values within patch objects, as defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-5.3" class="relref">Section 5.3</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>. A patch object is used to update specific properties of an existing object without having to send the entire object. When using result references in patch objects, special syntax rules apply:<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<p id="section-2.3.1-2">The patch object key (the path to the property being patched) <span class="bcp14">MUST</span> be a JSON Pointer as specified in <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>, and <span class="bcp14">MUST</span> be prefixed with "#" to indicate that the value is a result reference. For example, to patch a property "locations/a1/city" with a value from a previous result, the patch object would include a key "#/locations/a1/city" with a ResultReference value.<a href="#section-2.3.1-2" class="pilcrow">¶</a></p>
<p id="section-2.3.1-3">The value associated with the prefixed JSON Pointer key is a ResultReference object. This ResultReference may use either JSON Pointer or JSON Path (if supported by the server) in its "path" property to extract the value from the previous method result.<a href="#section-2.3.1-3" class="pilcrow">¶</a></p>
<p id="section-2.3.1-4">When processing patch objects, the server <span class="bcp14">MUST</span>:<a href="#section-2.3.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3.1-5">
<li id="section-2.3.1-5.1">
              <p id="section-2.3.1-5.1.1">Identify keys in the patch object that begin with "#".<a href="#section-2.3.1-5.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.3.1-5.2">
              <p id="section-2.3.1-5.2.1">Remove the "#" prefix to obtain the JSON Pointer path to be patched.<a href="#section-2.3.1-5.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.3.1-5.3">
              <p id="section-2.3.1-5.3.1">Resolve the ResultReference value according to the resolution algorithm.<a href="#section-2.3.1-5.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.3.1-5.4">
              <p id="section-2.3.1-5.4.1">Apply the resolved value to the location specified by the JSON Pointer path in the target object.<a href="#section-2.3.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-2.3.1-6">If a result reference in a patch object fails to resolve, the server <span class="bcp14">MUST</span> reject the update with a SetError of type "invalidResultReference".<a href="#section-2.3.1-6" class="pilcrow">¶</a></p>
<p id="section-2.3.1-7">It is important to note that while the patch object key (the path) <span class="bcp14">MUST</span> use JSON Pointer syntax, the ResultReference value's "path" property may use either JSON Pointer or JSON Path syntax (if the server supports JSON Path).<a href="#section-2.3.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="usage-in-filtercondition-objects">
<section id="section-2.4">
        <h3 id="name-usage-in-filtercondition-ob">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-usage-in-filtercondition-ob" class="section-name selfRef">Usage in FilterCondition Objects</a>
        </h3>
<p id="section-2.4-1">Enhanced result references may be used within FilterCondition objects in Foo/query method calls. This enables dynamic query construction where filter criteria are derived from the results of previous method calls in the same request.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">To use an enhanced result reference within a FilterCondition, the filter property name is prefixed with "#" (an octothorpe), and the value is set to a ResultReference object. For example, to filter based on a dynamically determined mailbox id, the FilterCondition would include "#inMailbox" rather than "inMailbox".<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.4-3">When processing a Foo/query method call, the server <span class="bcp14">MUST</span> examine the "filter" argument and any nested FilterCondition objects for properties with names beginning with "#". For each such property found, the server <span class="bcp14">MUST</span>:<a href="#section-2.4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.4-4">
<li id="section-2.4-4.1">
            <p id="section-2.4-4.1.1">Remove the "#" prefix to determine the actual filter property name.<a href="#section-2.4-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-4.2">
            <p id="section-2.4-4.2.1">Resolve the ResultReference value following the resolution algorithm defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-3.7" class="relref">Section 3.7</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>, with the extensions defined in this specification.<a href="#section-2.4-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-4.3">
            <p id="section-2.4-4.3.1">Replace the property with "#" prefix with a property of the actual name, having the resolved value.<a href="#section-2.4-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.4-5">If a result reference in a FilterCondition fails to resolve, the server <span class="bcp14">MUST</span> reject the entire query method call with an error response of type "invalidResultReference". The error response <span class="bcp14">SHOULD</span> include a description indicating which filter property reference failed and why.<a href="#section-2.4-5" class="pilcrow">¶</a></p>
<p id="section-2.4-6">If a FilterCondition contains both a property name with "#" prefix and the same property name without the prefix (e.g., both "#inMailbox" and "inMailbox"), the server <span class="bcp14">MUST</span> reject the query with an "invalidArguments" error, as this represents an ambiguous filter specification.<a href="#section-2.4-6" class="pilcrow">¶</a></p>
<p id="section-2.4-7">The resolved value <span class="bcp14">MUST</span> be of a type appropriate for the filter property being set. If the resolved value does not match the expected type for that filter property, the server <span class="bcp14">MUST</span> reject the query with an "invalidArguments" error.<a href="#section-2.4-7" class="pilcrow">¶</a></p>
<p id="section-2.4-8">Enhanced result references in FilterConditions support the full range of filter compositions defined by JMAP specifications, including nested FilterCondition objects combined with FilterOperators. The server <span class="bcp14">MUST</span> recursively process all levels of FilterCondition nesting to resolve all result references before evaluating the query.<a href="#section-2.4-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-3">
      <h2 id="name-examples">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-3-1">This section provides additional examples demonstrating the use of enhanced result references in various contexts.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="usage-in-set">
<section id="section-3.1">
        <h3 id="name-usage-in-set">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-usage-in-set" class="section-name selfRef">Usage in /set</a>
        </h3>
<p id="section-3.1-1">Example using JSON Path (assuming server supports jsonPath capability):<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-2">
<pre>
[
  ["CalendarEvent/query", {
    "accountId": "a1",
    "filter": {
      "uid": "meeting-template-001"
    }
  }, "c0"],
  ["CalendarEvent/get", {
    "accountId": "a1",
    "#ids": {
      "resultOf": "c0",
      "name": "CalendarEvent/query",
      "path": "/ids"
    },
    "properties": ["participants", "locations"]
  }, "c1"],
  ["CalendarEvent/set", {
    "accountId": "a1",
    "create": {
      "new-event": {
        "calendarIds": {"cal-1": true},
        "title": "Team Sync",
        "start": "2025-11-01T14:00:00Z",
        "duration": "PT1H",
        "#participants": {
          "resultOf": "c1",
          "name": "CalendarEvent/get",
          "path": "$.list[0].participants"
        },
        "#locations": {
          "resultOf": "c1",
          "name": "CalendarEvent/get",
          "path": "$.list[0].locations"
        }
      }
    }
  }, "c2"]
]
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">In this example, the new calendar event reuses the participants and locations from a template event retrieved in previous calls. The server would resolve the result references before creating the event, effectively copying those complex object values without requiring the client to extract and reformat them.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="usage-in-set-patch-objects">
<section id="section-3.2">
        <h3 id="name-usage-in-set-patch-objects">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-usage-in-set-patch-objects" class="section-name selfRef">Usage in /set patch objects</a>
        </h3>
<p id="section-3.2-1">Example of using result references in a patch object (assuming server supports jsonPath capability):<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.2-2">
<pre>
[
  ["CalendarEvent/get", {
    "accountId": "a1",
    "ids": ["event-template"],
    "properties": [ "locations",
                    "organizerCalendarAddress",
                    "participants"]
  }, "c0"],
  ["CalendarEvent/set", {
    "accountId": "a1",
    "update": {
      "event-123": {
        "#/locations/a1": {
          "resultOf": "c0",
          "name": "CalendarEvent/get",
          "path": "$.list[0].locations.loc1"
        },
        "#/organizerCalendarAddress": {
          "resultOf": "c0",
          "name": "CalendarEvent/get",
          "path": "$.list[0].organizerCalendarAddress"
        },
        "#/participants/p1": {
          "resultOf": "c0",
          "name": "CalendarEvent/get",
          "path": "$.list[0].participants[?@.roles.chair]"
        }
      }
    }
  }, "c1"]
]
</pre><a href="#section-3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2-3">In this example, the patch object updates specific properties of event-123 using values extracted from a template event. The patch updates a single location entry ("locations/a1"), copies the organizer's calendar address, and adds a participant ("participants/p1") by extracting a participant with the "chair" role from the template using a JSON Path filter expression. The patch keys "#/locations/a1", "#/organizerCalendarAddress", and "#/participants/p1" use JSON Pointer syntax (prefixed with "#"), while the ResultReference path properties use a mix of JSON Path expressions (including the filter expression for selecting the chair participant) and simple paths.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="usage-in-query-filtercondition">
<section id="section-3.3">
        <h3 id="name-usage-in-query-filtercondit">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-usage-in-query-filtercondit" class="section-name selfRef">Usage in /query FilterCondition</a>
        </h3>
<p id="section-3.3-1">Example using JSON Path for array extraction (assuming server supports jsonPath capability):<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.3-2">
<pre>
[
  ["Mailbox/query", {
    "accountId": "a1",
    "filter": {
      "role": "inbox"
    }
  }, "c0"],
  ["Email/query", {
    "accountId": "a1",
    "filter": {
      "#inMailboxOtherThan": {
        "resultOf": "c0",
        "name": "Mailbox/query",
        "path": "$.ids[0]"
      },
      "from": "boss@example.com"
    },
    "sort": [{"property": "receivedAt", "isAscending": false}],
    "limit": 50
  }, "c1"]
]
</pre><a href="#section-3.3-2" class="pilcrow">¶</a>
</div>
<p id="section-3.3-3">In this example, the Email/query uses a dynamically resolved mailbox id from the previous Mailbox/query call. The JSON Path expression <code>$.ids[0]</code> extracts the first mailbox id from the query result. The server resolves this reference before executing the email query, effectively filtering emails that are not in the user's inbox and are from a specific sender.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extracting-multiple-values-with-json-path">
<section id="section-3.4">
        <h3 id="name-extracting-multiple-values-">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-extracting-multiple-values-" class="section-name selfRef">Extracting Multiple Values with JSON Path</a>
        </h3>
<p id="section-3.4-1">Example demonstrating JSON Path for extracting multiple values:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-2">
<pre>
[
  ["Email/get", {
    "accountId": "a1",
    "ids": ["template-email-id"],
    "properties": ["attachments"],
    "bodyProperties": ["blobId", "name", "type"]
  }, "c0"],
  ["Email/set", {
    "accountId": "a1",
    "create": {
      "new-email": {
        "mailboxIds": {
          "inbox-id": true
        },
        "subject": "Quarterly Reports",
        "from": [{"email": "sender@example.com"}],
        "to": [{"email": "recipient@example.com"}],
        "#attachments": {
          "resultOf": "c0",
          "name": "Email/get",
          "path": "$.list[0].attachments[?@.name &amp;&amp;
                @.name.toLowerCase().endsWith('.pdf')]"
        }
      }
    }
  }, "c1"]
]
</pre><a href="#section-3.4-2" class="pilcrow">¶</a>
</div>
<p id="section-3.4-3">In this example, the JSON Path expression <code>$.list[0].attachments[?@.name &amp;&amp; @.name.toLowerCase().endsWith('.pdf')]</code> extracts all EmailBodyPart objects from the attachments array that have a "name" property ending with ".pdf" (case-insensitive). The result would be an array of EmailBodyPart objects (each containing <code>blobId</code>, <code>name</code> and <code>type</code>) that is then used to populate the attachments property of the new email, effectively copying only the PDF attachments from the template email.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-4">
      <h2 id="name-security-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-4-1">The security considerations described in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span> and <span>[<a href="#RFC9535" class="cite xref">RFC9535</a>]</span> apply to this specification. This section discusses additional security implications introduced by allowing result references to be used in object properties and FilterCondition objects, and by supporting JSON Path expressions.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="denial-of-service-considerations">
<section id="section-4.1">
        <h3 id="name-denial-of-service-considera">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-denial-of-service-considera" class="section-name selfRef">Denial of Service Considerations</a>
        </h3>
<p id="section-4.1-1">Enhanced result references, particularly when combined with JSON Path support, introduce additional denial of service (DoS) vectors that implementations must address.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div id="computational-complexity-of-json-path">
<section id="section-4.1.1">
          <h4 id="name-computational-complexity-of">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-computational-complexity-of" class="section-name selfRef">Computational Complexity of JSON Path</a>
          </h4>
<p id="section-4.1.1-1">JSON Path expressions can be significantly more computationally expensive to evaluate than JSON Pointer references. Servers supporting JSON Path <span class="bcp14">MUST</span> implement appropriate safeguards against excessive resource consumption:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1">
              <p id="section-4.1.1-2.1.1">Servers <span class="bcp14">SHOULD</span> enforce limits on the complexity of JSON Path expressions, such as maximum expression length, maximum nesting depth of selectors, or maximum number of filter predicates.<a href="#section-4.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-2.2">
              <p id="section-4.1.1-2.2.1">Servers <span class="bcp14">SHOULD</span> enforce timeouts on JSON Path evaluation to prevent indefinitely long computations.<a href="#section-4.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-2.3">
              <p id="section-4.1.1-2.3.1">Servers <span class="bcp14">SHOULD</span> limit the size of nodelists that can be produced by a single JSON Path expression. An expression that matches a very large number of nodes could consume excessive memory.<a href="#section-4.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-2.4">
              <p id="section-4.1.1-2.4.1">Servers <span class="bcp14">SHOULD</span> consider the cumulative cost of evaluating multiple result references in a single request. An attacker might attempt to overwhelm the server by including many complex JSON Path expressions in a single request.<a href="#section-4.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.1-3">Servers that implement these limitations <span class="bcp14">MUST</span> return an "invalidResultReference" error when a limit is exceeded, with a description that indicates the nature of the limitation where possible without revealing sensitive operational details.<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="resource-exhaustion-through-reference-chains">
<section id="section-4.1.2">
          <h4 id="name-resource-exhaustion-through">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-resource-exhaustion-through" class="section-name selfRef">Resource Exhaustion Through Reference Chains</a>
          </h4>
<p id="section-4.1.2-1">Enhanced result references enable longer and more complex chains of dependent method calls within a single request. While this is a design goal that improves efficiency, it also creates opportunities for resource exhaustion:<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2-2.1">
              <p id="section-4.1.2-2.1.1">An attacker might construct requests with deeply nested result reference dependencies that require the server to maintain large amounts of intermediate state.<a href="#section-4.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-2.2">
              <p id="section-4.1.2-2.2.1">The expanded use of result references in /set operations means that a single method call might need to resolve many result references across complex nested object structures.<a href="#section-4.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-2.3">
              <p id="section-4.1.2-2.3.1">Result references in FilterCondition objects might require repeated evaluation of the same reference multiple times during query execution.<a href="#section-4.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.2-3">Servers <span class="bcp14">SHOULD</span> enforce reasonable limits on the complexity of result reference usage, such as:<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2-4.1">
              <p id="section-4.1.2-4.1.1">Maximum number of result references per request<a href="#section-4.1.2-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-4.2">
              <p id="section-4.1.2-4.2.1">Maximum number of result references per method call<a href="#section-4.1.2-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-4.3">
              <p id="section-4.1.2-4.3.1">Maximum depth of property nesting when resolving result references in /set operations<a href="#section-4.1.2-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.2-4.4">
              <p id="section-4.1.2-4.4.1">Maximum number of FilterCondition objects containing result references in a single query<a href="#section-4.1.2-4.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.2-5">These limits <span class="bcp14">SHOULD</span> be documented and consistent with other JMAP request limits defined in <span>[<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="algorithmic-complexity-attacks">
<section id="section-4.1.3">
          <h4 id="name-algorithmic-complexity-atta">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-algorithmic-complexity-atta" class="section-name selfRef">Algorithmic Complexity Attacks</a>
          </h4>
<p id="section-4.1.3-1">Certain combinations of JSON Path expressions and data structures can exhibit pathological performance characteristics. For example:<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.3-2.1">
              <p id="section-4.1.3-2.1.1">Recursive descent (..) combined with wildcard selectors on deeply nested structures can produce very large intermediate results.<a href="#section-4.1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.3-2.2">
              <p id="section-4.1.3-2.2.1">Filter expressions with complex predicates applied to large arrays can require substantial computation.<a href="#section-4.1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.3-2.3">
              <p id="section-4.1.3-2.3.1">JSON Path expressions that produce large nodelists, when used multiple times within a single request, can cause quadratic or worse time complexity.<a href="#section-4.1.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.3-3">Servers <span class="bcp14">SHOULD</span> implement query cost analysis and impose limits on expensive operations. When possible, servers <span class="bcp14">SHOULD</span> detect potentially problematic patterns before full evaluation and reject them proactively.<a href="#section-4.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="data-integrity-and-validation-concerns">
<section id="section-4.2">
        <h3 id="name-data-integrity-and-validati">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-data-integrity-and-validati" class="section-name selfRef">Data Integrity and Validation Concerns</a>
        </h3>
<p id="section-4.2-1">The use of result references in /set operations creates additional considerations for data validation and integrity.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="type-confusion">
<section id="section-4.2.1">
          <h4 id="name-type-confusion">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-type-confusion" class="section-name selfRef">Type Confusion</a>
          </h4>
<p id="section-4.2.1-1">Result references resolve to values of arbitrary JSON types. When these values are used to populate object properties or filter conditions, type mismatches can occur. While this specification requires servers to validate types after resolution, implementations must be careful to avoid type confusion vulnerabilities:<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-2.1">
              <p id="section-4.2.1-2.1.1">Type validation <span class="bcp14">MUST</span> occur after result reference resolution but before the value is used in any security-sensitive operation.<a href="#section-4.2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.2">
              <p id="section-4.2.1-2.2.1">Servers <span class="bcp14">MUST NOT</span> make assumptions about the type of a resolved value based on the context. The value type must be explicitly checked.<a href="#section-4.2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.1-2.3">
              <p id="section-4.2.1-2.3.1">String-to-number or string-to-boolean coercions <span class="bcp14">MUST NOT</span> be performed automatically, as these can lead to unexpected behavior and potential security issues.<a href="#section-4.2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="injection-attacks">
<section id="section-4.2.2">
          <h4 id="name-injection-attacks">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-injection-attacks" class="section-name selfRef">Injection Attacks</a>
          </h4>
<p id="section-4.2.2-1">When result references are used to populate FilterCondition properties, there is a potential for filter injection attacks. Consider a scenario where a result reference is used to set a filter property that expects a simple string value, but the resolution produces a complex object or an array:<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.2-2.1">
              <p id="section-4.2.2-2.1.1">Servers <span class="bcp14">MUST</span> validate that resolved values match the expected type and structure for the property or filter being populated.<a href="#section-4.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.2">
              <p id="section-4.2.2-2.2.1">Servers <span class="bcp14">MUST NOT</span> attempt to serialize complex objects to strings or perform other automatic conversions that might enable injection attacks.<a href="#section-4.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.2.2-2.3">
              <p id="section-4.2.2-2.3.1">When a resolved value is used in a filter that performs string matching or other operations, the server <span class="bcp14">MUST</span> ensure that the value is properly sanitized and does not alter the semantic meaning of the filter.<a href="#section-4.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="circular-reference-prevention">
<section id="section-4.2.3">
          <h4 id="name-circular-reference-preventi">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-circular-reference-preventi" class="section-name selfRef">Circular Reference Prevention</a>
          </h4>
<p id="section-4.2.3-1">While JMAP's sequential processing model prevents direct circular references (a method cannot reference a method that comes after it), enhanced result references in nested object structures could potentially create complex data copying patterns that consume excessive memory or lead to unexpected behavior. Servers <span class="bcp14">SHOULD</span> implement safeguards against pathological data copying patterns.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-4.3">
        <h3 id="name-privacy-considerations">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
        </h3>
<p id="section-4.3-1">Enhanced result references can affect user privacy in several ways:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="data-leakage-across-contexts">
<section id="section-4.3.1">
          <h4 id="name-data-leakage-across-context">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-data-leakage-across-context" class="section-name selfRef">Data Leakage Across Contexts</a>
          </h4>
<p id="section-4.3.1-1">The ability to copy data from one JMAP object to another using result references creates potential for unintended data leakage. For example:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-2.1">
              <p id="section-4.3.1-2.1.1">Private or sensitive data from one context might be inadvertently copied into a more widely shared context.<a href="#section-4.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-2.2">
              <p id="section-4.3.1-2.2.1">Metadata or structural information might be leaked through the types and structures of resolved values.<a href="#section-4.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.3.1-3">Implementations <span class="bcp14">SHOULD</span> provide mechanisms for administrators and users to understand and control how data flows between different contexts through result references.<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="audit-and-logging">
<section id="section-4.3.2">
          <h4 id="name-audit-and-logging">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-audit-and-logging" class="section-name selfRef">Audit and Logging</a>
          </h4>
<p id="section-4.3.2-1">The use of result references can obscure the true source of data in audit logs. When an object is created or modified using result references, audit logs <span class="bcp14">SHOULD</span> record not just the final object state but also information about which data was derived from result references. This enables proper forensic analysis and compliance with data protection regulations.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implementation-considerations">
<section id="section-4.4">
        <h3 id="name-implementation-consideratio">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
        </h3>
<p id="section-4.4-1">Implementers should be aware of several security-relevant implementation challenges:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div id="parser-security">
<section id="section-4.4.1">
          <h4 id="name-parser-security">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-parser-security" class="section-name selfRef">Parser Security</a>
          </h4>
<p id="section-4.4.1-1">JSON Path parsers are complex and may contain vulnerabilities. Servers implementing JSON Path support <span class="bcp14">SHOULD</span>:<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1-2.1">
              <p id="section-4.4.1-2.1.1">Use well-tested, maintained JSON Path libraries rather than custom implementations.<a href="#section-4.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-2.2">
              <p id="section-4.4.1-2.2.1">Keep JSON Path libraries up to date with security patches.<a href="#section-4.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.1-2.3">
              <p id="section-4.4.1-2.3.1">Consider sandboxing or isolating JSON Path evaluation from critical server components.<a href="#section-4.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="cache-security">
<section id="section-4.4.2">
          <h4 id="name-cache-security">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-cache-security" class="section-name selfRef">Cache Security</a>
          </h4>
<p id="section-4.4.2-1">To improve performance, servers might cache the results of result reference resolution. Such caches <span class="bcp14">MUST</span> respect all security boundaries:<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2-2.1">
              <p id="section-4.4.2-2.1.1">Cached results <span class="bcp14">MUST NOT</span> be shared across different users or security contexts.<a href="#section-4.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-2.2">
              <p id="section-4.4.2-2.2.1">Cache entries <span class="bcp14">MUST</span> be invalidated when relevant access control policies change.<a href="#section-4.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.2-2.3">
              <p id="section-4.4.2-2.3.1">Cache implementations <span class="bcp14">MUST</span> be resistant to timing attacks that might reveal the presence or contents of cached data.<a href="#section-4.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="backward-compatibility">
<section id="section-4.4.3">
          <h4 id="name-backward-compatibility">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-backward-compatibility" class="section-name selfRef">Backward Compatibility</a>
          </h4>
<p id="section-4.4.3-1">Servers that support enhanced result references <span class="bcp14">MUST</span> continue to correctly handle requests from clients that do not use this extension. In particular:<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.3-2.1">
              <p id="section-4.4.3-2.1.1">Servers <span class="bcp14">MUST</span> correctly reject enhanced result references from clients that have not included the <code>urn:ietf:params:jmap:refplus</code> capability in the "using" property of the request.<a href="#section-4.4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.4.3-2.2">
              <p id="section-4.4.3-2.2.1">The presence of properties with "#" prefixes in contexts where standard JMAP does not allow result references <span class="bcp14">MUST</span> be handled appropriately (typically as invalid property names).<a href="#section-4.4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-5">
      <h2 id="name-iana-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA considerations</a>
      </h2>
<div id="jmap-capability-registration-for-refplus">
<section id="section-5.1">
        <h3 id="name-jmap-capability-registratio">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-jmap-capability-registratio" class="section-name selfRef">JMAP Capability Registration for "refplus"</a>
        </h3>
<p id="section-5.1-1">IANA will register the "refplus" JMAP Capability as follows:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2"><strong>Capability Name:</strong> urn:ietf:params:jmap:refplus<br>
          <strong>Specification document:</strong> this document<br>
          <strong>Intended use:</strong> common<br>
          <strong>Change Controller:</strong> IETF<br>
          <strong>Security and privacy considerations:</strong> this document, <a href="#security-considerations" class="auto internal xref">Section 4</a><a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-6">
      <h2 id="name-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-6.1">
        <h3 id="name-normative-references">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6901">[RFC6901]</dt>
        <dd>
<span class="refAuthor">Bryan, P., Ed.</span>, <span class="refAuthor">Zyp, K.</span>, and <span class="refAuthor">M. Nottingham, Ed.</span>, <span class="refTitle">"JavaScript Object Notation (JSON) Pointer"</span>, <span class="seriesInfo">RFC 6901</span>, <span class="seriesInfo">DOI 10.17487/RFC6901</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6901">https://www.rfc-editor.org/rfc/rfc6901</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8259">[RFC8259]</dt>
        <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8620">[RFC8620]</dt>
        <dd>
<span class="refAuthor">Jenkins, N.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"The JSON Meta Application Protocol (JMAP)"</span>, <span class="seriesInfo">RFC 8620</span>, <span class="seriesInfo">DOI 10.17487/RFC8620</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8620">https://www.rfc-editor.org/rfc/rfc8620</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8621">[RFC8621]</dt>
        <dd>
<span class="refAuthor">Jenkins, N.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"The JSON Meta Application Protocol (JMAP) for Mail"</span>, <span class="seriesInfo">RFC 8621</span>, <span class="seriesInfo">DOI 10.17487/RFC8621</span>, <time datetime="2019-08" class="refDate">August 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8621">https://www.rfc-editor.org/rfc/rfc8621</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9535">[RFC9535]</dt>
      <dd>
<span class="refAuthor">Gössner, S., Ed.</span>, <span class="refAuthor">Normington, G., Ed.</span>, and <span class="refAuthor">C. Bormann, Ed.</span>, <span class="refTitle">"JSONPath: Query Expressions for JSON"</span>, <span class="seriesInfo">RFC 9535</span>, <span class="seriesInfo">DOI 10.17487/RFC9535</span>, <time datetime="2024-02" class="refDate">February 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9535">https://www.rfc-editor.org/rfc/rfc9535</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-6.2">
        <h3 id="name-informative-references">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-jmap-calendars">[I-D.ietf-jmap-calendars]</dt>
        <dd>
<span class="refAuthor">Jenkins, N.</span> and <span class="refAuthor">M. Douglass</span>, <span class="refTitle">"JSON Meta Application Protocol (JMAP) for Calendars"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-jmap-calendars-25</span>, <time datetime="2025-10-08" class="refDate">8 October 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-jmap-calendars-25">https://datatracker.ietf.org/doc/html/draft-ietf-jmap-calendars-25</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9610">[RFC9610]</dt>
      <dd>
<span class="refAuthor">Jenkins, N., Ed.</span>, <span class="refTitle">"JSON Meta Application Protocol (JMAP) for Contacts"</span>, <span class="seriesInfo">RFC 9610</span>, <span class="seriesInfo">DOI 10.17487/RFC9610</span>, <time datetime="2024-12" class="refDate">December 2024</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9610">https://www.rfc-editor.org/rfc/rfc9610</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="changes">
<section id="appendix-A">
      <h2 id="name-changes">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-changes" class="section-name selfRef">Changes</a>
      </h2>
<p id="appendix-A-1">[[This section to be removed by RFC Editor]]<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2"><strong>draft-degennaro-jmap-enhanced-references-00</strong><a href="#appendix-A-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-3.1">
          <p id="appendix-A-3.1.1">Initial version<a href="#appendix-A-3.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mauro De Gennaro</span></div>
<div dir="auto" class="left"><span class="org">Stalwart Labs LLC</span></div>
<div dir="auto" class="left"><span class="street-address">1309 Coffeen Avenue, Suite 1200</span></div>
<div dir="auto" class="left">
<span class="locality">Sheridan</span>, <span class="region">WY</span> <span class="postal-code">82801</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mauro@stalw.art" class="email">mauro@stalw.art</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://stalw.art" class="url">https://stalw.art</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
