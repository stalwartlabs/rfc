<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>MTA Hooks: An HTTP-Based Mail Processing Protocol</title>
<meta content="Mauro De Gennaro" name="author">
<meta content="
       This document specifies MTA Hooks, an HTTP-based protocol enabling Mail Transfer Agents (MTAs) to delegate message processing decisions to external services. MTA Hooks provides a modern alternative to legacy mail filtering protocols by leveraging ubiquitous HTTP infrastructure, supporting both JSON and CBOR serialization, and offering fine-grained capability negotiation. The protocol supports both inbound message reception and outbound message delivery scenarios, allowing external scanners to inspect messages, modify content, and influence routing decisions at various stages of mail processing. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-degennaro-mta-hooks-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.13.3
    ConfigArgParse 1.7.1
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.0
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="index.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://static.ietf.org/fonts/noto-sans/import.css'); /* Sans-serif */
@import url('https://static.ietf.org/fonts/noto-serif/import.css'); /* Serif (print) */
@import url('https://static.ietf.org/fonts/roboto-mono/import.css'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
@media print {
  svg {
    max-height: 850px;
    max-width: 660px;
  }
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > blockquote:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MTA Hooks</td>
<td class="right">December 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">De Gennaro</td>
<td class="center">Expires 26 June 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-degennaro-mta-hooks-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-12-23" class="published">23 December 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-06-26">26 June 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. De Gennaro</div>
<div class="org">Stalwart Labs</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">MTA Hooks: An HTTP-Based Mail Processing Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies MTA Hooks, an HTTP-based protocol enabling Mail Transfer Agents (MTAs) to delegate message processing decisions to external services. MTA Hooks provides a modern alternative to legacy mail filtering protocols by leveraging ubiquitous HTTP infrastructure, supporting both JSON and CBOR serialization, and offering fine-grained capability negotiation. The protocol supports both inbound message reception and outbound message delivery scenarios, allowing external scanners to inspect messages, modify content, and influence routing decisions at various stages of mail processing.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 June 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-notational-conventions" class="internal xref">Notational Conventions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-data-types" class="internal xref">Data Types</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-architecture" class="internal xref">Architecture</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-serialization" class="internal xref">Serialization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-processing-stages" class="internal xref">Processing Stages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-inbound-stages" class="internal xref">Inbound Stages</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="auto internal xref">2.3.2</a>.  <a href="#name-outbound-stages" class="internal xref">Outbound Stages</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-inbound-message-processing" class="internal xref">Inbound Message Processing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4.2.1">
                    <p id="section-toc.1-1.2.2.4.2.1.1"><a href="#section-2.4.1" class="auto internal xref">2.4.1</a>.  <a href="#name-multiple-scanner-handling" class="internal xref">Multiple Scanner Handling</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-outbound-message-processing" class="internal xref">Outbound Message Processing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-modifications" class="internal xref">Modifications</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-discovery" class="internal xref">Discovery</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-well-known-endpoint" class="internal xref">Well-Known Endpoint</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-discovery-document-format" class="internal xref">Discovery Document Format</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-example-discovery-document" class="internal xref">Example Discovery Document</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-manual-configuration" class="internal xref">Manual Configuration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-registration" class="internal xref">Registration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-registration-request" class="internal xref">Registration Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-filter-configuration" class="internal xref">Filter Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-example-registration-reques" class="internal xref">Example Registration Request</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-callback-verification" class="internal xref">Callback Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-registration-response" class="internal xref">Registration Response</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-example-registration-respon" class="internal xref">Example Registration Response</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-authentication" class="internal xref">Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-registration-lifecycle" class="internal xref">Registration Lifecycle</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.  <a href="#name-status-queries" class="internal xref">Status Queries</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="auto internal xref">4.5.2</a>.  <a href="#name-example-status-response" class="internal xref">Example Status Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="auto internal xref">4.5.3</a>.  <a href="#name-registration-expiration-and" class="internal xref">Registration Expiration and Renewal</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-deregistration" class="internal xref">Deregistration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.  <a href="#name-in-flight-requests" class="internal xref">In-Flight Requests</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.2">
                    <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="auto internal xref">4.6.2</a>.  <a href="#name-automatic-deregistration" class="internal xref">Automatic Deregistration</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-hook-request" class="internal xref">Hook Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-request-structure" class="internal xref">Request Structure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-common-properties" class="internal xref">Common Properties</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-envelope-properties" class="internal xref">Envelope Properties</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-queue-properties" class="internal xref">Queue Properties</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-message-properties" class="internal xref">Message Properties</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.1">
                    <p id="section-toc.1-1.5.2.5.2.1.1"><a href="#section-5.5.1" class="auto internal xref">5.5.1</a>.  <a href="#name-structured-message" class="internal xref">Structured Message</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.2">
                    <p id="section-toc.1-1.5.2.5.2.2.1"><a href="#section-5.5.2" class="auto internal xref">5.5.2</a>.  <a href="#name-raw-message" class="internal xref">Raw Message</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.3">
                    <p id="section-toc.1-1.5.2.5.2.3.1"><a href="#section-5.5.3" class="auto internal xref">5.5.3</a>.  <a href="#name-choosing-between-structured" class="internal xref">Choosing Between Structured and Raw</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-server-properties" class="internal xref">Server Properties</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="auto internal xref">5.7</a>.  <a href="#name-protocol-properties" class="internal xref">Protocol Properties</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="auto internal xref">5.8</a>.  <a href="#name-inbound-properties" class="internal xref">Inbound Properties</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8.2.1">
                    <p id="section-toc.1-1.5.2.8.2.1.1"><a href="#section-5.8.1" class="auto internal xref">5.8.1</a>.  <a href="#name-smtp-response-properties" class="internal xref">SMTP Response Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8.2.2">
                    <p id="section-toc.1-1.5.2.8.2.2.1"><a href="#section-5.8.2" class="auto internal xref">5.8.2</a>.  <a href="#name-client-properties" class="internal xref">Client Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8.2.3">
                    <p id="section-toc.1-1.5.2.8.2.3.1"><a href="#section-5.8.3" class="auto internal xref">5.8.3</a>.  <a href="#name-tls-properties" class="internal xref">TLS Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8.2.4">
                    <p id="section-toc.1-1.5.2.8.2.4.1"><a href="#section-5.8.4" class="auto internal xref">5.8.4</a>.  <a href="#name-sender-authentication-prope" class="internal xref">Sender Authentication Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8.2.5">
                    <p id="section-toc.1-1.5.2.8.2.5.1"><a href="#section-5.8.5" class="auto internal xref">5.8.5</a>.  <a href="#name-smtp-authentication-propert" class="internal xref">SMTP Authentication Properties</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9">
                <p id="section-toc.1-1.5.2.9.1"><a href="#section-5.9" class="auto internal xref">5.9</a>.  <a href="#name-outbound-properties" class="internal xref">Outbound Properties</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9.2.1">
                    <p id="section-toc.1-1.5.2.9.2.1.1"><a href="#section-5.9.1" class="auto internal xref">5.9.1</a>.  <a href="#name-extended-queue-properties" class="internal xref">Extended Queue Properties</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.9.2.2">
                    <p id="section-toc.1-1.5.2.9.2.2.1"><a href="#section-5.9.2" class="auto internal xref">5.9.2</a>.  <a href="#name-recipient-delivery-status" class="internal xref">Recipient Delivery Status</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.10">
                <p id="section-toc.1-1.5.2.10.1"><a href="#section-5.10" class="auto internal xref">5.10</a>. <a href="#name-example-inbound-hook-reques" class="internal xref">Example Inbound Hook Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.11">
                <p id="section-toc.1-1.5.2.11.1"><a href="#section-5.11" class="auto internal xref">5.11</a>. <a href="#name-example-outbound-hook-reque" class="internal xref">Example Outbound Hook Request</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-hook-response" class="internal xref">Hook Response</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-response-structure" class="internal xref">Response Structure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-actions" class="internal xref">Actions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-inbound-actions" class="internal xref">Inbound Actions</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-outbound-actions" class="internal xref">Outbound Actions</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-modifications-2" class="internal xref">Modifications</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="auto internal xref">6.3.1</a>.  <a href="#name-set-operations" class="internal xref">Set Operations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.2">
                    <p id="section-toc.1-1.6.2.3.2.2.1"><a href="#section-6.3.2" class="auto internal xref">6.3.2</a>.  <a href="#name-add-operations" class="internal xref">Add Operations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.3">
                    <p id="section-toc.1-1.6.2.3.2.3.1"><a href="#section-6.3.3" class="auto internal xref">6.3.3</a>.  <a href="#name-delete-operations" class="internal xref">Delete Operations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.4">
                    <p id="section-toc.1-1.6.2.3.2.4.1"><a href="#section-6.3.4" class="auto internal xref">6.3.4</a>.  <a href="#name-modification-order" class="internal xref">Modification Order</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.5">
                    <p id="section-toc.1-1.6.2.3.2.5.1"><a href="#section-6.3.5" class="auto internal xref">6.3.5</a>.  <a href="#name-conflicting-operations" class="internal xref">Conflicting Operations</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.6">
                    <p id="section-toc.1-1.6.2.3.2.6.1"><a href="#section-6.3.6" class="auto internal xref">6.3.6</a>.  <a href="#name-no-modification-response" class="internal xref">No Modification Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.7">
                    <p id="section-toc.1-1.6.2.3.2.7.1"><a href="#section-6.3.7" class="auto internal xref">6.3.7</a>.  <a href="#name-size-limits" class="internal xref">Size Limits</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.8">
                    <p id="section-toc.1-1.6.2.3.2.8.1"><a href="#section-6.3.8" class="auto internal xref">6.3.8</a>.  <a href="#name-modification-errors" class="internal xref">Modification Errors</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-example-hook-responses" class="internal xref">Example Hook Responses</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.1">
                    <p id="section-toc.1-1.6.2.4.2.1.1"><a href="#section-6.4.1" class="auto internal xref">6.4.1</a>.  <a href="#name-accept-with-header-addition" class="internal xref">Accept with Header Addition</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.2">
                    <p id="section-toc.1-1.6.2.4.2.2.1"><a href="#section-6.4.2" class="auto internal xref">6.4.2</a>.  <a href="#name-reject-with-custom-response" class="internal xref">Reject with Custom Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.3">
                    <p id="section-toc.1-1.6.2.4.2.3.1"><a href="#section-6.4.3" class="auto internal xref">6.4.3</a>.  <a href="#name-modify-subject-and-add-reci" class="internal xref">Modify Subject and Add Recipient</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.4">
                    <p id="section-toc.1-1.6.2.4.2.4.1"><a href="#section-6.4.4" class="auto internal xref">6.4.4</a>.  <a href="#name-cancel-specific-recipient-d" class="internal xref">Cancel Specific Recipient Delivery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4.2.5">
                    <p id="section-toc.1-1.6.2.4.2.5.1"><a href="#section-6.4.5" class="auto internal xref">6.4.5</a>.  <a href="#name-no-action-response" class="internal xref">No Action Response</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-transport" class="internal xref">Transport</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-http-version" class="internal xref">HTTP Version</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-tls-requirements" class="internal xref">TLS Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-request-methods" class="internal xref">Request Methods</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-content-negotiation" class="internal xref">Content Negotiation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-error-handling" class="internal xref">Error Handling</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5.2.1">
                    <p id="section-toc.1-1.7.2.5.2.1.1"><a href="#section-7.5.1" class="auto internal xref">7.5.1</a>.  <a href="#name-http-status-codes" class="internal xref">HTTP Status Codes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5.2.2">
                    <p id="section-toc.1-1.7.2.5.2.2.1"><a href="#section-7.5.2" class="auto internal xref">7.5.2</a>.  <a href="#name-timeout-handling" class="internal xref">Timeout Handling</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5.2.3">
                    <p id="section-toc.1-1.7.2.5.2.3.1"><a href="#section-7.5.3" class="auto internal xref">7.5.3</a>.  <a href="#name-retry-policy" class="internal xref">Retry Policy</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="auto internal xref">7.6</a>.  <a href="#name-connection-management" class="internal xref">Connection Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-implementation-consideratio" class="internal xref">Implementation Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-mta-considerations" class="internal xref">MTA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-multiple-scanner-handling-2" class="internal xref">Multiple Scanner Handling</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="auto internal xref">8.1.2</a>.  <a href="#name-unavailable-scanners" class="internal xref">Unavailable Scanners</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="auto internal xref">8.1.3</a>.  <a href="#name-performance-considerations" class="internal xref">Performance Considerations</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-scanner-considerations" class="internal xref">Scanner Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-idempotency" class="internal xref">Idempotency</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="auto internal xref">8.2.2</a>.  <a href="#name-response-time" class="internal xref">Response Time</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="auto internal xref">8.2.3</a>.  <a href="#name-stateless-design" class="internal xref">Stateless Design</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-large-message-handling" class="internal xref">Large Message Handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-high-availability" class="internal xref">High Availability</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.1">
                    <p id="section-toc.1-1.8.2.4.2.1.1"><a href="#section-8.4.1" class="auto internal xref">8.4.1</a>.  <a href="#name-scanner-high-availability" class="internal xref">Scanner High Availability</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4.2.2">
                    <p id="section-toc.1-1.8.2.4.2.2.1"><a href="#section-8.4.2" class="auto internal xref">8.4.2</a>.  <a href="#name-registration-state" class="internal xref">Registration State</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-authentication-and-authoriz" class="internal xref">Authentication and Authorization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-transport-security" class="internal xref">Transport Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-message-confidentiality" class="internal xref">Message Confidentiality</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-denial-of-service" class="internal xref">Denial of Service</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.1">
                    <p id="section-toc.1-1.9.2.4.2.1.1"><a href="#section-9.4.1" class="auto internal xref">9.4.1</a>.  <a href="#name-registration-attacks" class="internal xref">Registration Attacks</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.2">
                    <p id="section-toc.1-1.9.2.4.2.2.1"><a href="#section-9.4.2" class="auto internal xref">9.4.2</a>.  <a href="#name-scanner-resource-exhaustion" class="internal xref">Scanner Resource Exhaustion</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.3">
                    <p id="section-toc.1-1.9.2.4.2.3.1"><a href="#section-9.4.3" class="auto internal xref">9.4.3</a>.  <a href="#name-slow-scanner-attacks" class="internal xref">Slow Scanner Attacks</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-injection-attacks" class="internal xref">Injection Attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-well-known-uri-registration" class="internal xref">Well-Known URI Registration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-mta-hooks-serialization-for" class="internal xref">MTA Hooks Serialization Format Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="auto internal xref">10.3</a>.  <a href="#name-mta-hooks-inbound-action-re" class="internal xref">MTA Hooks Inbound Action Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="auto internal xref">10.4</a>.  <a href="#name-mta-hooks-outbound-action-r" class="internal xref">MTA Hooks Outbound Action Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="auto internal xref">10.5</a>.  <a href="#name-mta-hooks-inbound-stage-reg" class="internal xref">MTA Hooks Inbound Stage Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.6">
                <p id="section-toc.1-1.10.2.6.1"><a href="#section-10.6" class="auto internal xref">10.6</a>.  <a href="#name-mta-hooks-outbound-stage-re" class="internal xref">MTA Hooks Outbound Stage Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.7">
                <p id="section-toc.1-1.10.2.7.1"><a href="#section-10.7" class="auto internal xref">10.7</a>.  <a href="#name-mta-hooks-error-code-regist" class="internal xref">MTA Hooks Error Code Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-error-codes" class="internal xref">Error Codes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-error-response-structure" class="internal xref">Error Response Structure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-http-400-bad-request" class="internal xref">HTTP 400 Bad Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-http-401-unauthorized" class="internal xref">HTTP 401 Unauthorized</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.  <a href="#name-http-403-forbidden" class="internal xref">HTTP 403 Forbidden</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#appendix-A.5" class="auto internal xref">A.5</a>.  <a href="#name-http-404-not-found" class="internal xref">HTTP 404 Not Found</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#appendix-A.6" class="auto internal xref">A.6</a>.  <a href="#name-http-409-conflict" class="internal xref">HTTP 409 Conflict</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.7">
                <p id="section-toc.1-1.12.2.7.1"><a href="#appendix-A.7" class="auto internal xref">A.7</a>.  <a href="#name-http-422-unprocessable-enti" class="internal xref">HTTP 422 Unprocessable Entity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.8">
                <p id="section-toc.1-1.12.2.8.1"><a href="#appendix-A.8" class="auto internal xref">A.8</a>.  <a href="#name-http-429-too-many-requests" class="internal xref">HTTP 429 Too Many Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.9">
                <p id="section-toc.1-1.12.2.9.1"><a href="#appendix-A.9" class="auto internal xref">A.9</a>.  <a href="#name-http-500-internal-server-er" class="internal xref">HTTP 500 Internal Server Error</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.10">
                <p id="section-toc.1-1.12.2.10.1"><a href="#appendix-A.10" class="auto internal xref">A.10</a>. <a href="#name-http-503-service-unavailabl" class="internal xref">HTTP 503 Service Unavailable</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-complete-example-flows" class="internal xref">Complete Example Flows</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-inbound-spam-filtering" class="internal xref">Inbound Spam Filtering</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.1">
                    <p id="section-toc.1-1.13.2.1.2.1.1"><a href="#appendix-B.1.1" class="auto internal xref">B.1.1</a>.  <a href="#name-discovery-2" class="internal xref">Discovery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.2">
                    <p id="section-toc.1-1.13.2.1.2.2.1"><a href="#appendix-B.1.2" class="auto internal xref">B.1.2</a>.  <a href="#name-registration-2" class="internal xref">Registration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.3">
                    <p id="section-toc.1-1.13.2.1.2.3.1"><a href="#appendix-B.1.3" class="auto internal xref">B.1.3</a>.  <a href="#name-verification-callback" class="internal xref">Verification Callback</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.4">
                    <p id="section-toc.1-1.13.2.1.2.4.1"><a href="#appendix-B.1.4" class="auto internal xref">B.1.4</a>.  <a href="#name-registration-response-2" class="internal xref">Registration Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.5">
                    <p id="section-toc.1-1.13.2.1.2.5.1"><a href="#appendix-B.1.5" class="auto internal xref">B.1.5</a>.  <a href="#name-hook-invocation-clean-messa" class="internal xref">Hook Invocation - Clean Message</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1.2.6">
                    <p id="section-toc.1-1.13.2.1.2.6.1"><a href="#appendix-B.1.6" class="auto internal xref">B.1.6</a>.  <a href="#name-hook-invocation-spam-detect" class="internal xref">Hook Invocation - Spam Detected</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-outbound-delivery-logging" class="internal xref">Outbound Delivery Logging</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.1">
                    <p id="section-toc.1-1.13.2.2.2.1.1"><a href="#appendix-B.2.1" class="auto internal xref">B.2.1</a>.  <a href="#name-registration-3" class="internal xref">Registration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2.2.2">
                    <p id="section-toc.1-1.13.2.2.2.2.1"><a href="#appendix-B.2.2" class="auto internal xref">B.2.2</a>.  <a href="#name-hook-invocation-partial-del" class="internal xref">Hook Invocation - Partial Delivery</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-B.3" class="auto internal xref">B.3</a>.  <a href="#name-deregistration-2" class="internal xref">Deregistration</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-C" class="auto internal xref">Appendix C</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-D" class="auto internal xref">Appendix D</a>.  <a href="#name-changes" class="internal xref">Changes</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Mail Transfer Agents require extensible mechanisms to integrate with external services for spam filtering, virus scanning, policy enforcement, and compliance monitoring. While legacy protocols such as the Milter protocol have served this purpose, they present challenges in modern deployments including proprietary wire formats, limited tooling, and operational complexity.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">MTA Hooks addresses these challenges by defining an HTTP-based protocol for mail processing delegation. The protocol leverages the widespread availability of HTTP client and server implementations, standard serialization formats, and established operational practices for HTTP services.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">MTA Hooks achieves broad deployment compatibility by building upon standard HTTP semantics and methods, allowing implementers to leverage existing HTTP client and server libraries. The protocol supports both JSON and CBOR serialization to accommodate environments with different performance and parsing requirements. Capability negotiation during registration enables graceful feature discovery and forward compatibility as the protocol evolves. Mandatory transport encryption protects message content in transit, while the authentication mechanism remains pluggable to integrate with diverse deployment environments. The HTTP foundation ensures compatibility with existing operational infrastructure including load balancers, reverse proxies, and monitoring systems.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">MTA Hooks supports two primary use cases: inbound processing during message reception from remote clients, and outbound processing during message delivery to remote servers. Both scenarios follow a consistent request-response pattern where the MTA invokes the registered hook endpoints at configured processing stages.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="notational-conventions">
<section id="section-1.1">
        <h3 id="name-notational-conventions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">The following terms are used throughout this document:<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">
            <p id="section-1.2-2.1.1">MTA (Mail Transfer Agent): A software component responsible for transferring electronic mail messages between hosts, as described in <span>[<a href="#RFC5321" class="cite xref">RFC5321</a>]</span>.<a href="#section-1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.2">
            <p id="section-1.2-2.2.1">Hook Endpoint: An HTTP server endpoint that receives hook invocations from an MTA and returns processing instructions.<a href="#section-1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.3">
            <p id="section-1.2-2.3.1">Scanner: A service that registers with an MTA to receive hook invocations. Scanners perform functions such as spam filtering, virus scanning, or policy enforcement. The terms "scanner" and "hook endpoint" are used interchangeably when referring to the service receiving hook requests.<a href="#section-1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.4">
            <p id="section-1.2-2.4.1">Registration: The process by which a scanner establishes a relationship with an MTA, including capability negotiation and callback URL configuration.<a href="#section-1.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.5">
            <p id="section-1.2-2.5.1">Inbound Processing: Hook invocation during message reception, when the MTA accepts a message from a remote SMTP client.<a href="#section-1.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.6">
            <p id="section-1.2-2.6.1">Outbound Processing: Hook invocation during message delivery, when the MTA transmits a message to a remote SMTP server.<a href="#section-1.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.7">
            <p id="section-1.2-2.7.1">Stage: A specific point in mail processing at which the MTA invokes registered hooks. Different stages provide access to different message properties.<a href="#section-1.2-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.8">
            <p id="section-1.2-2.8.1">Action: An instruction from a scanner indicating how the MTA should proceed with message processing.<a href="#section-1.2-2.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-2.9">
            <p id="section-1.2-2.9.1">Modification: A change to message properties requested by a scanner, expressed as operations on the hook request object.<a href="#section-1.2-2.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="data-types">
<section id="section-1.3">
        <h3 id="name-data-types">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-data-types" class="section-name selfRef">Data Types</a>
        </h3>
<p id="section-1.3-1">This specification defines several object types used throughout the protocol. The following primitive types are used:<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-1.3-2">
          <dt id="section-1.3-2.1"><strong>String</strong></dt>
          <dd style="margin-left: 1.5em" id="section-1.3-2.2">
            <p id="section-1.3-2.2.1">A JSON string value.<a href="#section-1.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.3"><strong>Int</strong></dt>
          <dd style="margin-left: 1.5em" id="section-1.3-2.4">
            <p id="section-1.3-2.4.1">An integer in the range -2^53+1 &lt;= value &lt;= 2^53-1.<a href="#section-1.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.5"><strong>UnsignedInt</strong></dt>
          <dd style="margin-left: 1.5em" id="section-1.3-2.6">
            <p id="section-1.3-2.6.1">An integer in the range 0 &lt;= value &lt;= 2^53-1.<a href="#section-1.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.7"><strong>Boolean</strong></dt>
          <dd style="margin-left: 1.5em" id="section-1.3-2.8">
            <p id="section-1.3-2.8.1">A JSON boolean value (true or false).<a href="#section-1.3-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.3-2.9"><strong>UTCDate</strong></dt>
          <dd style="margin-left: 1.5em" id="section-1.3-2.10">
            <p id="section-1.3-2.10.1">A string in "date-time" format as defined in <span>[<a href="#RFC3339" class="cite xref">RFC3339</a>]</span>, where the time-offset component <span class="bcp14">MUST</span> be "Z" (UTC time). For example, "2024-12-21T15:30:00Z".<a href="#section-1.3-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="protocol-overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">MTA Hooks defines a request-response protocol where the MTA acts as an HTTP client and scanners act as HTTP servers. During mail processing, the MTA constructs a request containing message properties and context information, transmits it to registered scanner endpoints, and processes the response to determine subsequent actions.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="architecture">
<section id="section-2.1">
        <h3 id="name-architecture">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-architecture" class="section-name selfRef">Architecture</a>
        </h3>
<p id="section-2.1-1">The protocol architecture consists of three primary components:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.1-2">
<li id="section-2.1-2.1">
            <p id="section-2.1-2.1.1">The MTA, which initiates HTTP requests to scanner endpoints at configured processing stages.<a href="#section-2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">Scanner services, which receive requests, perform analysis, and return responses containing actions and modifications.<a href="#section-2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-2.3">
            <p id="section-2.1-2.3.1">A registration mechanism through which scanners declare their capabilities and subscribe to specific processing stages.<a href="#section-2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<span id="name-mta-hooks-protocol-flow"></span><div id="fig-architecture">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-3.1">
<pre>
+-------+                              +---------+
|       |  1. Discovery Request        |         |
|       |-----------------------------&gt;|         |
|       |  2. Discovery Response       |         |
|       |&lt;-----------------------------|         |
|       |                              |         |
|       |  3. Registration Request     |         |
|  MTA  |-----------------------------&gt;| Scanner |
|       |  4. Registration Response    |         |
|       |&lt;-----------------------------|         |
|       |                              |         |
|       |  5. Hook Request             |         |
|       |-----------------------------&gt;|         |
|       |  6. Hook Response            |         |
|       |&lt;-----------------------------|         |
+-------+                              +---------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-mta-hooks-protocol-flow" class="selfRef">MTA Hooks Protocol Flow</a>
          </figcaption></figure>
</div>
<p id="section-2.1-4">The protocol flow proceeds as follows:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.1-5">
<li id="section-2.1-5.1">
            <p id="section-2.1-5.1.1">The MTA discovers scanner capabilities by requesting the well-known discovery endpoint.<a href="#section-2.1-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">The scanner returns a discovery document describing supported stages, actions, and configuration options.<a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-5.3">
            <p id="section-2.1-5.3.1">The scanner submits a registration request specifying desired stages, properties, and callback configuration.<a href="#section-2.1-5.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-5.4">
            <p id="section-2.1-5.4.1">The MTA validates the request, optionally verifies the callback endpoint, and returns registration confirmation.<a href="#section-2.1-5.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-5.5">
            <p id="section-2.1-5.5.1">During mail processing, the MTA invokes the scanner's callback URL with message properties and context.<a href="#section-2.1-5.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.1-5.6">
            <p id="section-2.1-5.6.1">The scanner returns a response containing an action and optional modifications.<a href="#section-2.1-5.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="serialization">
<section id="section-2.2">
        <h3 id="name-serialization">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-serialization" class="section-name selfRef">Serialization</a>
        </h3>
<p id="section-2.2-1">Requests and responses are serialized using either JSON <span>[<a href="#RFC8259" class="cite xref">RFC8259</a>]</span> or CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>. The serialization format is negotiated during registration and indicated via HTTP <code>Content-Type</code> headers.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">For JSON serialization, the <code>Content-Type</code> header <span class="bcp14">MUST</span> be "application/json". For CBOR serialization, the <code>Content-Type</code> header <span class="bcp14">MUST</span> be "application/cbor".<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">Binary data handling differs between formats. In JSON serialization, binary content such as message body parts <span class="bcp14">MUST</span> be encoded using Base64. In CBOR serialization, binary content <span class="bcp14">SHOULD</span> be transmitted as raw byte strings.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="processing-stages">
<section id="section-2.3">
        <h3 id="name-processing-stages">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-processing-stages" class="section-name selfRef">Processing Stages</a>
        </h3>
<p id="section-2.3-1">MTA Hooks defines processing stages for both inbound and outbound message handling. Scanners subscribe to specific stages during registration and receive invocations only for subscribed stages.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div id="inbound-stages">
<section id="section-2.3.1">
          <h4 id="name-inbound-stages">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-inbound-stages" class="section-name selfRef">Inbound Stages</a>
          </h4>
<p id="section-2.3.1-1">Inbound stages correspond to SMTP protocol events during message reception:<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.1-2.1">
              <p id="section-2.3.1-2.1.1">connect: Invoked when a remote client establishes a connection, before any SMTP commands are exchanged.<a href="#section-2.3.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-2.2">
              <p id="section-2.3.1-2.2.1">ehlo: Invoked after the client sends EHLO or HELO command.<a href="#section-2.3.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-2.3">
              <p id="section-2.3.1-2.3.1">mail: Invoked after each MAIL FROM command.<a href="#section-2.3.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-2.4">
              <p id="section-2.3.1-2.4.1">rcpt: Invoked after each RCPT TO command. This stage may be invoked multiple times per transaction.<a href="#section-2.3.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.1-2.5">
              <p id="section-2.3.1-2.5.1">data: Invoked after the complete message has been received, following the DATA command and message content.<a href="#section-2.3.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="outbound-stages">
<section id="section-2.3.2">
          <h4 id="name-outbound-stages">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-outbound-stages" class="section-name selfRef">Outbound Stages</a>
          </h4>
<p id="section-2.3.2-1">Outbound stages correspond to delivery events during message transmission:<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3.2-2.1">
              <p id="section-2.3.2-2.1.1">delivery: Invoked after a delivery attempt completes for all recipients, regardless of success or failure.<a href="#section-2.3.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.2-2.2">
              <p id="section-2.3.2-2.2.1">defer: Invoked only when at least one recipient delivery cannot be completed and requires retry.<a href="#section-2.3.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.3.2-2.3">
              <p id="section-2.3.2-2.3.1">dsn: Invoked when the MTA generates a Delivery Status Notification of any type.<a href="#section-2.3.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.3.2-3">For outbound stages, the hook is invoked once after delivery attempts for all recipients in a given delivery batch have completed. The scanner receives the delivery status for each recipient and may modify per-recipient handling.<a href="#section-2.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="inbound-message-processing">
<section id="section-2.4">
        <h3 id="name-inbound-message-processing">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-inbound-message-processing" class="section-name selfRef">Inbound Message Processing</a>
        </h3>
<p id="section-2.4-1">During inbound processing, the MTA invokes registered hooks as it receives messages from remote SMTP clients. This corresponds to traditional mail filtering scenarios where external services inspect incoming mail for spam, viruses, or policy violations.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">The inbound flow proceeds through SMTP protocol stages:<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.4-3">
<li id="section-2.4-3.1">
            <p id="section-2.4-3.1.1">A remote client connects to the MTA.<a href="#section-2.4-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-3.2">
            <p id="section-2.4-3.2.1">The MTA invokes hooks registered for the "connect" stage.<a href="#section-2.4-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-3.3">
            <p id="section-2.4-3.3.1">The client sends EHLO/HELO; the MTA invokes "ehlo" stage hooks.<a href="#section-2.4-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-3.4">
            <p id="section-2.4-3.4.1">The client sends MAIL FROM; the MTA invokes "mail" stage hooks.<a href="#section-2.4-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-3.5">
            <p id="section-2.4-3.5.1">The client sends one or more RCPT TO commands; the MTA invokes "rcpt" stage hooks for each.<a href="#section-2.4-3.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.4-3.6">
            <p id="section-2.4-3.6.1">The client sends DATA and message content; the MTA invokes "data" stage hooks.<a href="#section-2.4-3.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.4-4">At each stage, scanners may instruct the MTA to accept, reject, or modify the transaction.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
<div id="multiple-scanner-handling">
<section id="section-2.4.1">
          <h4 id="name-multiple-scanner-handling">
<a href="#section-2.4.1" class="section-number selfRef">2.4.1. </a><a href="#name-multiple-scanner-handling" class="section-name selfRef">Multiple Scanner Handling</a>
          </h4>
<p id="section-2.4.1-1">When multiple scanners are registered for the same stage, the MTA invokes them sequentially in an implementation-defined order. Each scanner's response affects the request seen by subsequent scanners.<a href="#section-2.4.1-1" class="pilcrow">¶</a></p>
<p id="section-2.4.1-2">The scanner chain terminates early when a scanner returns a terminal action:<a href="#section-2.4.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4.1-3.1">
              <p id="section-2.4.1-3.1.1">Inbound terminal actions: "reject", "discard", "disconnect"<a href="#section-2.4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.4.1-3.2">
              <p id="section-2.4.1-3.2.1">Outbound terminal actions: "cancel"<a href="#section-2.4.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.4.1-4">Non-terminal actions ("accept", "quarantine" for inbound; "continue" for outbound) allow the chain to proceed, and subsequent scanners may override these actions.<a href="#section-2.4.1-4" class="pilcrow">¶</a></p>
<p id="section-2.4.1-5">Implementations <span class="bcp14">SHOULD</span> provide configuration options for:<a href="#section-2.4.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4.1-6.1">
              <p id="section-2.4.1-6.1.1">Scanner invocation order (priority-based or explicit ordering)<a href="#section-2.4.1-6.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.4.1-6.2">
              <p id="section-2.4.1-6.2.1">Whether to allow subsequent scanners to override "quarantine" decisions<a href="#section-2.4.1-6.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-2.4.1-6.3">
              <p id="section-2.4.1-6.3.1">Logging of chain termination events for operational visibility<a href="#section-2.4.1-6.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-2.4.1-7">Example chain behavior:<a href="#section-2.4.1-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.4.1-8">
<li id="section-2.4.1-8.1">
              <p id="section-2.4.1-8.1.1">Scanner A (spam filter) sets action to "accept" and adds X-Spam-Score header<a href="#section-2.4.1-8.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.4.1-8.2">
              <p id="section-2.4.1-8.2.1">Scanner B (virus scanner) receives modified request, detects malware, sets action to "reject"<a href="#section-2.4.1-8.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.4.1-8.3">
              <p id="section-2.4.1-8.3.1">Chain terminates; Scanner C is not invoked<a href="#section-2.4.1-8.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-2.4.1-8.4">
              <p id="section-2.4.1-8.4.1">MTA rejects the message<a href="#section-2.4.1-8.4.1" class="pilcrow">¶</a></p>
</li>
          </ol>
</section>
</div>
</section>
</div>
<div id="outbound-message-processing">
<section id="section-2.5">
        <h3 id="name-outbound-message-processing">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-outbound-message-processing" class="section-name selfRef">Outbound Message Processing</a>
        </h3>
<p id="section-2.5-1">During outbound processing, the MTA invokes registered hooks as it delivers messages to remote SMTP servers. This supports use cases including delivery logging, compliance monitoring, and routing decisions.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">The outbound flow proceeds as follows:<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.5-3">
<li id="section-2.5-3.1">
            <p id="section-2.5-3.1.1">The MTA selects a queued message for delivery and identifies the recipients due for delivery at this time.<a href="#section-2.5-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.5-3.2">
            <p id="section-2.5-3.2.1">The MTA attempts delivery to all selected recipients.<a href="#section-2.5-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.5-3.3">
            <p id="section-2.5-3.3.1">After all attempts in this delivery job complete, the MTA invokes hooks registered for the "delivery" stage.<a href="#section-2.5-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.5-3.4">
            <p id="section-2.5-3.4.1">If any recipient requires retry, the MTA invokes "defer" stage hooks.<a href="#section-2.5-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-2.5-3.5">
            <p id="section-2.5-3.5.1">If the MTA generates a DSN, it invokes "dsn" stage hooks before sending.<a href="#section-2.5-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-2.5-4">A delivery job represents a single processing cycle where the MTA retrieves a message from the queue and attempts delivery to one or more recipients. The specific batching of recipients into delivery jobs is implementation-defined and may depend on factors such as destination domain, connection reuse, or queue configuration. The "delivery" stage hook is invoked once per delivery job after all recipient attempts within that job have completed.<a href="#section-2.5-4" class="pilcrow">¶</a></p>
<p id="section-2.5-5">Scanners may modify per-recipient delivery status, suppress DSN generation, or alter retry scheduling.<a href="#section-2.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="modifications">
<section id="section-2.6">
        <h3 id="name-modifications">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-modifications" class="section-name selfRef">Modifications</a>
        </h3>
<p id="section-2.6-1">Scanners communicate changes through modifications to the hook request object. Modifications are expressed as operations on JSON Pointers <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span> referencing properties within the request structure.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.6-2">Three modification operations are supported:<a href="#section-2.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.6-3.1">
            <p id="section-2.6-3.1.1">Set: Replace the value at a specified path.<a href="#section-2.6-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.6-3.2">
            <p id="section-2.6-3.2.1">Add: Insert a value at a specified path, including array element insertion.<a href="#section-2.6-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.6-3.3">
            <p id="section-2.6-3.3.1">Delete: Remove the value at a specified path.<a href="#section-2.6-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.6-4">The MTA applies modifications in a defined order: set operations first, followed by add operations, and finally delete operations. Any modification that fails (for example, referencing a non-existent path for deletion) <span class="bcp14">SHOULD</span> be logged and included in failure statistics, but <span class="bcp14">MUST NOT</span> cause the entire response to be rejected.<a href="#section-2.6-4" class="pilcrow">¶</a></p>
<p id="section-2.6-5">If a scanner modifies both the "message" and "rawMessage" properties, the "rawMessage" modification takes precedence and "message" modifications are ignored.<a href="#section-2.6-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="discovery">
<section id="section-3">
      <h2 id="name-discovery">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-discovery" class="section-name selfRef">Discovery</a>
      </h2>
<p id="section-3-1">MTAs discover scanner capabilities through a well-known HTTP endpoint. Discovery is <span class="bcp14">OPTIONAL</span>; scanner endpoints <span class="bcp14">MAY</span> alternatively be configured manually.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="well-known-endpoint">
<section id="section-3.1">
        <h3 id="name-well-known-endpoint">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-well-known-endpoint" class="section-name selfRef">Well-Known Endpoint</a>
        </h3>
<p id="section-3.1-1">Scanners that support discovery <span class="bcp14">MUST</span> expose a discovery document at the path "/.well-known/mta-hooks". The MTA retrieves this document using an HTTP GET request.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The discovery endpoint <span class="bcp14">MUST</span> support JSON serialization. Support for CBOR serialization is <span class="bcp14">OPTIONAL</span>.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discovery-document-format">
<section id="section-3.2">
        <h3 id="name-discovery-document-format">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-discovery-document-format" class="section-name selfRef">Discovery Document Format</a>
        </h3>
<p id="section-3.2-1">The discovery document is a JSON or CBOR object containing the following fields:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.2-2">
          <dt id="section-3.2-2.1">
<strong>version</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.2">
            <p id="section-3.2-2.2.1">The protocol version. This specification defines version "1.0".<a href="#section-3.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-2.3">
<strong>endpoints</strong>: <code>DiscoveryEndpoints</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.4">
            <p id="section-3.2-2.4.1">URLs for protocol operations.<a href="#section-3.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-2.5">
<strong>serialization</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.6">
            <p id="section-3.2-2.6.1">Supported serialization formats. Valid values are "json" and "cbor".<a href="#section-3.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-2.7">
<strong>capabilities</strong>: <code>DiscoveryCapabilities</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.8">
            <p id="section-3.2-2.8.1">Supported protocol capabilities.<a href="#section-3.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-2.9">
<strong>limits</strong>: <code>DiscoveryLimits|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.10">
            <p id="section-3.2-2.10.1">Operational limits, or null if no specific limits are advertised.<a href="#section-3.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-2.11">
<strong>extensions</strong>: <code>String[]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-2.12">
            <p id="section-3.2-2.12.1">Supported protocol extensions. Extension identifiers <span class="bcp14">SHOULD</span> use a reverse domain name prefix for vendor-specific extensions.<a href="#section-3.2-2.12.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-3">A <strong>DiscoveryEndpoints</strong> object has the following properties:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.2-4">
          <dt id="section-3.2-4.1">
<strong>registration</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-4.2">
            <p id="section-3.2-4.2.1">URL path for submitting registration requests.<a href="#section-3.2-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-4.3">
<strong>deregistration</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-4.4">
            <p id="section-3.2-4.4.1">URL path template for deregistration, with "{registration_id}" placeholder.<a href="#section-3.2-4.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-5">A <strong>DiscoveryCapabilities</strong> object has the following properties:<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-6">
          <dt id="section-3.2-6.1">
<strong>inbound</strong>: <code>DirectionCapabilities|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-6.2">
            <p id="section-3.2-6.2.1">Inbound processing capabilities, or null if inbound processing is not supported.<a href="#section-3.2-6.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-6.3">
<strong>outbound</strong>: <code>DirectionCapabilities|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-6.4">
            <p id="section-3.2-6.4.1">Outbound processing capabilities, or null if outbound processing is not supported.<a href="#section-3.2-6.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-7">A <strong>DirectionCapabilities</strong> object has the following properties:<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-3.2-8">
          <dt id="section-3.2-8.1">
<strong>stages</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-8.2">
            <p id="section-3.2-8.2.1">Supported stages for this processing direction.<a href="#section-3.2-8.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-8.3">
<strong>actions</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-8.4">
            <p id="section-3.2-8.4.1">Supported actions that scanners may request.<a href="#section-3.2-8.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-8.5">
<strong>fetchProperties</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-8.6">
            <p id="section-3.2-8.6.1">JSON Pointers for properties the MTA can include in hook requests.<a href="#section-3.2-8.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-8.7">
<strong>updateProperties</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-8.8">
            <p id="section-3.2-8.8.1">JSON Pointers for properties scanners may modify.<a href="#section-3.2-8.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-9">A <strong>DiscoveryLimits</strong> object has the following properties:<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.2-10">
          <dt id="section-3.2-10.1">
<strong>maxMessageSize</strong>: <code>UnsignedInt|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-10.2">
            <p id="section-3.2-10.2.1">Maximum message size in bytes the scanner accepts.<a href="#section-3.2-10.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-10.3">
<strong>maxRegistrations</strong>: <code>UnsignedInt|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-10.4">
            <p id="section-3.2-10.4.1">Maximum concurrent registrations.<a href="#section-3.2-10.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-3.2-10.5">
<strong>timeoutMs</strong>: <code>UnsignedInt|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-3.2-10.6">
            <p id="section-3.2-10.6.1">Default timeout in milliseconds for hook invocations.<a href="#section-3.2-10.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.2-11">The <code>fetchProperties</code> and <code>updateProperties</code> arrays contain JSON Pointers as defined in <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>.  Each pointer identifies a property within
the hook request structure that the MTA supports including or that scanners may modify. For example, "/envelope/from/address" refers to the sender's email address within the envelope object.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<div id="example-discovery-document">
<section id="section-3.2.1">
          <h4 id="name-example-discovery-document">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-example-discovery-document" class="section-name selfRef">Example Discovery Document</a>
          </h4>
<div class="lang-json sourcecode" id="section-3.2.1-1">
<pre>
{
  "version": "1.0",

  "endpoints": {
    "registration": "/v1/hooks/register",
    "deregistration": "/v1/hooks/register/{registration_id}"
  },

  "serialization": ["json", "cbor"],

  "capabilities": {
    "inbound": {
      "stages": ["connect", "ehlo", "mail", "rcpt", "data"],
      "actions": ["accept", "reject", "discard",
                  "quarantine", "disconnect"],
      "fetchProperties": ["/envelope", "/message", "/rawMessage",
                          "/server", "/tls", "/auth", "/senderAuth",
                          "/client", "/stage", "/action",
                          "/timestamp","/response", "/protocol",
                          "/queue"],
      "updateProperties": ["/envelope", "/message", "/rawMessage",
                           "/action", "/response"]
    },
    "outbound": {
      "stages": ["delivery", "defer", "dsn"],
      "actions": ["continue", "cancel"],
      "fetchProperties": ["/envelope", "/message", "/rawMessage",
                          "/server", "/queue", "/stage", "/action",
                          "/timestamp", "/protocol"],
      "updateProperties": ["/envelope/to", "/action", "/message",
                           "/rawMessage"]
    }
  },

  "limits": {
    "maxMessageSize": 52428800,
    "maxRegistrations": 64,
    "timeoutMs": 30000
  },

  "extensions": ["x-vendor-feature"]
}
</pre><a href="#section-3.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="manual-configuration">
<section id="section-3.3">
        <h3 id="name-manual-configuration">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-manual-configuration" class="section-name selfRef">Manual Configuration</a>
        </h3>
<p id="section-3.3-1">Discovery is <span class="bcp14">OPTIONAL</span>. Administrators <span class="bcp14">MAY</span> configure scanner endpoints manually, including capability restrictions and authentication credentials. Manual configuration may be necessary in environments where the well-known endpoint is not accessible or where policy requires explicit configuration.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="registration">
<section id="section-4">
      <h2 id="name-registration">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-registration" class="section-name selfRef">Registration</a>
      </h2>
<p id="section-4-1">Scanners register with MTAs to establish callback configuration and negotiate capabilities. Registration creates a persistent relationship that remains active until explicit deregistration or expiration.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="registration-request">
<section id="section-4.1">
        <h3 id="name-registration-request">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-registration-request" class="section-name selfRef">Registration Request</a>
        </h3>
<p id="section-4.1-1">Scanners submit registration requests via HTTP POST to the registration endpoint. The request body contains a JSON or CBOR object with the following fields:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.1-2">
          <dt id="section-4.1-2.1">
<strong>name</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">Human-readable name identifying the scanner.<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.3">
<strong>version</strong>: <code>String|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.4">
            <p id="section-4.1-2.4.1">Scanner software version string.<a href="#section-4.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.5">
<strong>callback</strong>: <code>CallbackConfig</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.6">
            <p id="section-4.1-2.6.1">Callback configuration.<a href="#section-4.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.7">
<strong>expiresAt</strong>: <code>UTCDate|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.8">
            <p id="section-4.1-2.8.1">Requested registration expiration timestamp. The MTA <span class="bcp14">MAY</span> assign a different expiration based on policy.<a href="#section-4.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.9">
<strong>serialization</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.10">
            <p id="section-4.1-2.10.1">Requested serialization format for hook requests. <span class="bcp14">MUST</span> be a value from the MTA's supported serialization list.<a href="#section-4.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.11">
<strong>inbound</strong>: <code>StageSubscription|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.12">
            <p id="section-4.1-2.12.1">Inbound hook configuration. Omit or set to null if not subscribing to inbound stages.<a href="#section-4.1-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.13">
<strong>outbound</strong>: <code>StageSubscription|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.14">
            <p id="section-4.1-2.14.1">Outbound hook configuration. Omit or set to null if not subscribing to outbound stages.<a href="#section-4.1-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.15">
<strong>filter</strong>: <code>FilterOperator|FilterCondition|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.16">
            <p id="section-4.1-2.16.1">Filter configuration to limit which messages trigger hooks. Uses filter syntax from <span><a href="https://rfc-editor.org/rfc/rfc8620#section-5.5" class="relref">Section 5.5</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>.<a href="#section-4.1-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-2.17">
<strong>metadata</strong>: <code>String[String]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-2.18">
            <p id="section-4.1-2.18.1">Arbitrary key-value pairs for scanner identification and operational metadata.<a href="#section-4.1-2.18.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.1-3">A <strong>CallbackConfig</strong> object has the following properties:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.1-4">
          <dt id="section-4.1-4.1">
<strong>url</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-4.2">
            <p id="section-4.1-4.2.1">HTTPS URL where the MTA sends hook requests.<a href="#section-4.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-4.3">
<strong>timeoutMs</strong>: <code>UnsignedInt|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-4.4">
            <p id="section-4.1-4.4.1">Requested timeout in milliseconds. The MTA <span class="bcp14">MAY</span> ignore or cap this value.<a href="#section-4.1-4.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.1-5">A <strong>StageSubscription</strong> object has the following properties:<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.1-6">
          <dt id="section-4.1-6.1">
<strong>stages</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-6.2">
            <p id="section-4.1-6.2.1">Stages to subscribe to. <span class="bcp14">MUST</span> be a subset of the MTA's supported stages for this direction.<a href="#section-4.1-6.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.1-6.3">
<strong>properties</strong>: <code>String[]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.1-6.4">
            <p id="section-4.1-6.4.1">JSON Pointers specifying message properties to receive. A value of null requests all supported properties.<a href="#section-4.1-6.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.1-7">At least one of "inbound" or "outbound" <span class="bcp14">MUST</span> be present and non-null in the registration request.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<div id="filter-configuration">
<section id="section-4.1.1">
          <h4 id="name-filter-configuration">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-filter-configuration" class="section-name selfRef">Filter Configuration</a>
          </h4>
<p id="section-4.1.1-1">The filter field uses the FilterOperator and FilterCondition syntax defined in <span><a href="https://rfc-editor.org/rfc/rfc8620#section-5.5" class="relref">Section 5.5</a> of [<a href="#RFC8620" class="cite xref">RFC8620</a>]</span>. A FilterOperator combines multiple conditions using AND, OR, or NOT logic. A FilterCondition specifies criteria that a message must match.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">Filter conditions follow <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4.4.1" class="relref">Section 4.4.1</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span> with the following restrictions on metadata conditions: only the "size" condition from <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4.1.1" class="relref">Section 4.1.1</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span> is permitted. All other metadata conditions are NOT supported as they depend on mailbox state or JMAP-specific concepts not applicable to MTA processing:<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-3.1">
              <p id="section-4.1.1-3.1.1">inMailbox<a href="#section-4.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.2">
              <p id="section-4.1.1-3.2.1">inMailboxOtherThan<a href="#section-4.1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.3">
              <p id="section-4.1.1-3.3.1">before<a href="#section-4.1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.4">
              <p id="section-4.1.1-3.4.1">after<a href="#section-4.1.1-3.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.5">
              <p id="section-4.1.1-3.5.1">minSize<a href="#section-4.1.1-3.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.6">
              <p id="section-4.1.1-3.6.1">maxSize<a href="#section-4.1.1-3.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.7">
              <p id="section-4.1.1-3.7.1">allInThreadHaveKeyword<a href="#section-4.1.1-3.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.8">
              <p id="section-4.1.1-3.8.1">someInThreadHaveKeyword<a href="#section-4.1.1-3.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.9">
              <p id="section-4.1.1-3.9.1">noneInThreadHaveKeyword<a href="#section-4.1.1-3.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.10">
              <p id="section-4.1.1-3.10.1">hasKeyword<a href="#section-4.1.1-3.10.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.1.1-3.11">
              <p id="section-4.1.1-3.11.1">notKeyword<a href="#section-4.1.1-3.11.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.1.1-4">All other filter conditions defined in <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4.4.1" class="relref">Section 4.4.1</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span> are permitted by this specification, including text-matching conditions such as "from", "to", "cc", "bcc", "subject", "body", "header", and "text". However, support for specific conditions is determined by the MTA implementation. If a scanner specifies a filter condition that the MTA does not support, the registration <span class="bcp14">MUST</span> be rejected with an UNSUPPORTED_FILTER error.<a href="#section-4.1.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1.1-5">The following additional conditions are defined for envelope filtering:<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.1.1-6">
            <dt id="section-4.1.1-6.1">
<strong>envelopeFrom</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.1.1-6.2">
              <p id="section-4.1.1-6.2.1">Matches if the MAIL FROM address matches the given value. The value <span class="bcp14">MAY</span> include wildcards using the "*" character, which matches zero or more characters.<a href="#section-4.1.1-6.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.1.1-6.3">
<strong>envelopeTo</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.1.1-6.4">
              <p id="section-4.1.1-6.4.1">Matches if any RCPT TO address matches the given value. The value <span class="bcp14">MAY</span> include wildcards using the "*" character, which matches zero or more characters.<a href="#section-4.1.1-6.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.1.1-7">Filters apply only to the "data" stage for content-based conditions (those examining message headers or body). For the "mail" and "rcpt" stages, only envelopeFrom and envelopeTo conditions are evaluated; other conditions are ignored for these stages. Messages or envelope commands not matching the filter do not trigger hook invocations.<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-registration-request">
<section id="section-4.1.2">
          <h4 id="name-example-registration-reques">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-example-registration-reques" class="section-name selfRef">Example Registration Request</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.1.2-1">
<pre>
POST /v1/hooks/register HTTP/1.1
Host: mta.example.com
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...

{
  "name": "Acme Spam Filter",
  "version": "2.1.0",

  "callback": {
    "url": "https://scanner.example.com/hooks/scan",
    "timeoutMs": 25000
  },

  "expiresAt": "2025-12-21T15:30:00Z",

  "serialization": "json",

  "inbound": {
    "stages": ["data"],
    "properties": ["/message", "/envelope", "/senderAuth"]
  },

  "outbound": {
    "stages": ["delivery"],
    "properties": null
  },

  "filter": {
    "operator": "OR",
    "conditions": [
      {"from": "*@external.example.com"},
      {"envelopeFrom": "*@partner.example.org"}
    ]
  },

  "metadata": {
    "vendor": "acme-security",
    "environment": "production",
    "instance": "scanner-01"
  }
}
</pre><a href="#section-4.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="callback-verification">
<section id="section-4.2">
        <h3 id="name-callback-verification">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-callback-verification" class="section-name selfRef">Callback Verification</a>
        </h3>
<p id="section-4.2-1">Upon receiving a registration request, the MTA <span class="bcp14">SHOULD</span> verify that the callback URL is reachable and operated by the registering party. Verification proceeds as follows:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2-2">
<li id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">The MTA generates a unique verification token.<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">The MTA sends an HTTP POST request to the callback URL with <code>Content-Type</code> set to the serialization format requested in the registration request. The request body contains:<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div class="lang-json sourcecode" id="section-4.2-3">
<pre>
{
  "action": "verify",
  "token": "vrf_8f3a2b1c9d4e5f6a7b8c9d0e1f2a3b4c"
}
</pre><a href="#section-4.2-3" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal type-1" id="section-4.2-4">
<li id="section-4.2-4.1">
            <p id="section-4.2-4.1.1">The scanner <span class="bcp14">MUST</span> respond with HTTP status 200 and a body containing the same token:<a href="#section-4.2-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<div class="lang-json sourcecode" id="section-4.2-5">
<pre>
{
  "token": "vrf_8f3a2b1c9d4e5f6a7b8c9d0e1f2a3b4c"
}
</pre><a href="#section-4.2-5" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal type-1" id="section-4.2-6">
<li id="section-4.2-6.1">
            <p id="section-4.2-6.1.1">The MTA confirms the response token matches the request token.<a href="#section-4.2-6.1.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.2-7">If verification fails, the MTA <span class="bcp14">MUST</span> reject the registration request:<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-8.1">
            <p id="section-4.2-8.1.1">If the callback URL is unreachable or times out: HTTP 422 with error code CALLBACK_UNREACHABLE<a href="#section-4.2-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-8.2">
            <p id="section-4.2-8.2.1">If the callback responds but the token does not match: HTTP 422 with error code CALLBACK_VERIFICATION_FAILED<a href="#section-4.2-8.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-8.3">
            <p id="section-4.2-8.3.1">If the callback URL does not use HTTPS: HTTP 422 with error code TLS_REQUIRED<a href="#section-4.2-8.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-8.4">
            <p id="section-4.2-8.4.1">If the callback URL's TLS certificate is invalid: HTTP 422 with error code TLS_CERTIFICATE_INVALID<a href="#section-4.2-8.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="registration-response">
<section id="section-4.3">
        <h3 id="name-registration-response">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-registration-response" class="section-name selfRef">Registration Response</a>
        </h3>
<p id="section-4.3-1">Upon successful registration, the MTA returns HTTP status 201 Created with a response body containing:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.3-2">
          <dt id="section-4.3-2.1">
<strong>registrationId</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">Unique identifier for this registration. The identifier <span class="bcp14">MUST</span> consist of ASCII alphanumeric characters plus hyphen (-), underscore (_), and colon (:), with a maximum length of 255 characters.<a href="#section-4.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.3">
<strong>status</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.4">
            <p id="section-4.3-2.4.1">Registration status. Values are "active", "suspended", or "pending_verification".<a href="#section-4.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.5">
<strong>createdAt</strong>: <code>UTCDate</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.6">
            <p id="section-4.3-2.6.1">Timestamp of registration creation.<a href="#section-4.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.7">
<strong>expiresAt</strong>: <code>UTCDate|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.8">
            <p id="section-4.3-2.8.1">Timestamp when registration expires, or null if no expiration is set.<a href="#section-4.3-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.9">
<strong>callback</strong>: <code>CallbackConfig</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.10">
            <p id="section-4.3-2.10.1">Confirmed callback configuration, which may differ from the request if the MTA adjusted values.<a href="#section-4.3-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.11">
<strong>negotiated</strong>: <code>NegotiatedCapabilities</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.12">
            <p id="section-4.3-2.12.1">Final negotiated capabilities representing the intersection of scanner request and MTA support.<a href="#section-4.3-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-2.13">
<strong>endpoints</strong>: <code>RegistrationEndpoints</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-2.14">
            <p id="section-4.3-2.14.1">URLs for managing this registration.<a href="#section-4.3-2.14.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.3-3">A <strong>NegotiatedCapabilities</strong> object has the following properties:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.3-4">
          <dt id="section-4.3-4.1">
<strong>serialization</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-4.2">
            <p id="section-4.3-4.2.1">Confirmed serialization format.<a href="#section-4.3-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-4.3">
<strong>inbound</strong>: <code>NegotiatedSubscription|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-4.4">
            <p id="section-4.3-4.4.1">Confirmed inbound configuration, or null if not registered for inbound processing.<a href="#section-4.3-4.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-4.5">
<strong>outbound</strong>: <code>NegotiatedSubscription|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-4.6">
            <p id="section-4.3-4.6.1">Confirmed outbound configuration, or null if not registered for outbound processing.<a href="#section-4.3-4.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.3-5">A <strong>NegotiatedSubscription</strong> object has the following properties:<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.3-6">
          <dt id="section-4.3-6.1">
<strong>stages</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-6.2">
            <p id="section-4.3-6.2.1">Confirmed stages.<a href="#section-4.3-6.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-6.3">
<strong>properties</strong>: <code>String[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-6.4">
            <p id="section-4.3-6.4.1">Confirmed property list.<a href="#section-4.3-6.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-4.3-7">A <strong>RegistrationEndpoints</strong> object has the following properties:<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.3-8">
          <dt id="section-4.3-8.1">
<strong>deregistration</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-8.2">
            <p id="section-4.3-8.2.1">URL for deregistration requests.<a href="#section-4.3-8.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-4.3-8.3">
<strong>status</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-4.3-8.4">
            <p id="section-4.3-8.4.1">URL for status queries.<a href="#section-4.3-8.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<div id="example-registration-response">
<section id="section-4.3.1">
          <h4 id="name-example-registration-respon">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-example-registration-respon" class="section-name selfRef">Example Registration Response</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.3.1-1">
<pre>
HTTP/1.1 201 Created
Content-Type: application/json
Location: /v1/hooks/register/reg_7a3b9c2e-4d5f-6a7b-8c9d-0e1f2a3b4c5d

{
  "registrationId": "reg_7a3b9c2e-4d5f-6a7b-8c9d-0e1f2a3b4c5d",
  "status": "active",
  "createdAt": "2024-12-21T15:30:00Z",
  "expiresAt": "2025-12-21T15:30:00Z",

  "callback": {
    "url": "https://scanner.example.com/hooks/scan",
    "timeoutMs": 25000
  },

  "negotiated": {
    "serialization": "json",
    "inbound": {
      "stages": ["data"],
      "properties": ["/message", "/envelope", "/senderAuth"]
    },
    "outbound": {
      "stages": ["delivery"],
      "properties": ["/message", "/envelope", "/queue", "/server"]
    }
  },

  "endpoints": {
    "deregistration": "/v1/hooks/register/reg_7a3b9c2e",
    "status": "/v1/hooks/register/reg_7a3b9c2e/status"
  }
}
</pre><a href="#section-4.3.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="authentication">
<section id="section-4.4">
        <h3 id="name-authentication">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-authentication" class="section-name selfRef">Authentication</a>
        </h3>
<p id="section-4.4-1">Authentication for registration requests is <span class="bcp14">REQUIRED</span> but the specific mechanism is out of scope for this specification. Implementations <span class="bcp14">SHOULD</span> support at least one of the following authentication methods:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Bearer tokens via the HTTP Authorization header<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">Mutual TLS with client certificate verification<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.3">
            <p id="section-4.4-2.3.1">HMAC-based pre-shared key authentication<a href="#section-4.4-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-3">See <a href="#security-considerations" class="auto internal xref">Section 9</a> for deployment guidance on authentication.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration-lifecycle">
<section id="section-4.5">
        <h3 id="name-registration-lifecycle">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-registration-lifecycle" class="section-name selfRef">Registration Lifecycle</a>
        </h3>
<div id="status-queries">
<section id="section-4.5.1">
          <h4 id="name-status-queries">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-status-queries" class="section-name selfRef">Status Queries</a>
          </h4>
<p id="section-4.5.1-1">Scanners <span class="bcp14">MAY</span> query their registration status via HTTP GET to the status endpoint returned during registration.<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-2">
<pre>
GET /v1/hooks/register/reg_7a3b9c2e/status HTTP/1.1
Host: mta.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
</pre><a href="#section-4.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-3">The response contains registration status and optional statistics:<a href="#section-4.5.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.5.1-4">
            <dt id="section-4.5.1-4.1">
<strong>registrationId</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.2">
              <p id="section-4.5.1-4.2.1">The registration identifier.<a href="#section-4.5.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.3">
<strong>status</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.4">
              <p id="section-4.5.1-4.4.1">Current status: "active", "suspended", or "deregistered".<a href="#section-4.5.1-4.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.5">
<strong>createdAt</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.6">
              <p id="section-4.5.1-4.6.1">Timestamp of creation.<a href="#section-4.5.1-4.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.7">
<strong>expiresAt</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.8">
              <p id="section-4.5.1-4.8.1">Timestamp of expiration.<a href="#section-4.5.1-4.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.9">
<strong>lastInvocation</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.10">
              <p id="section-4.5.1-4.10.1">Timestamp of most recent hook invocation.<a href="#section-4.5.1-4.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.11">
<strong>statistics</strong>: <code>RegistrationStatistics|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.12">
              <p id="section-4.5.1-4.12.1">Operational statistics.<a href="#section-4.5.1-4.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-4.13">
<strong>health</strong>: <code>HealthStatus|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-4.14">
              <p id="section-4.5.1-4.14.1">Health check status.<a href="#section-4.5.1-4.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.5.1-5">A <strong>RegistrationStatistics</strong> object has the following properties:<a href="#section-4.5.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.5.1-6">
            <dt id="section-4.5.1-6.1">
<strong>invocations</strong>: <code>InvocationCounts</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-6.2">
              <p id="section-4.5.1-6.2.1">Invocation counts.<a href="#section-4.5.1-6.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-6.3">
<strong>errors</strong>: <code>InvocationCounts</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-6.4">
              <p id="section-4.5.1-6.4.1">Error counts with the same time period structure as invocations.<a href="#section-4.5.1-6.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-6.5">
<strong>averageResponseMs</strong>: <code>Number</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-6.6">
              <p id="section-4.5.1-6.6.1">Average response time in milliseconds.<a href="#section-4.5.1-6.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.5.1-7">An <strong>InvocationCounts</strong> object has the following properties:<a href="#section-4.5.1-7" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.5.1-8">
            <dt id="section-4.5.1-8.1">
<strong>total</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-8.2">
              <p id="section-4.5.1-8.2.1">Total count since registration.<a href="#section-4.5.1-8.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-8.3">
<strong>last24h</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-8.4">
              <p id="section-4.5.1-8.4.1">Count in past 24 hours.<a href="#section-4.5.1-8.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-8.5">
<strong>last7d</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-8.6">
              <p id="section-4.5.1-8.6.1">Count in past 7 days.<a href="#section-4.5.1-8.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-8.7">
<strong>last30d</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-8.8">
              <p id="section-4.5.1-8.8.1">Count in past 30 days.<a href="#section-4.5.1-8.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-4.5.1-9">A <strong>HealthStatus</strong> object has the following properties:<a href="#section-4.5.1-9" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-4.5.1-10">
            <dt id="section-4.5.1-10.1">
<strong>status</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-10.2">
              <p id="section-4.5.1-10.2.1">Health status: "healthy", "degraded", or "unhealthy".<a href="#section-4.5.1-10.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-10.3">
<strong>lastCheck</strong>: <code>UTCDate</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-10.4">
              <p id="section-4.5.1-10.4.1">Timestamp of last health check.<a href="#section-4.5.1-10.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-4.5.1-10.5">
<strong>consecutiveFailures</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-4.5.1-10.6">
              <p id="section-4.5.1-10.6.1">Count of consecutive failed health checks.<a href="#section-4.5.1-10.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="example-status-response">
<section id="section-4.5.2">
          <h4 id="name-example-status-response">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-example-status-response" class="section-name selfRef">Example Status Response</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-4.5.2-1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "registrationId": "reg_7a3b9c2e-4d5f-6a7b-8c9d-0e1f2a3b4c5d",
  "status": "active",
  "createdAt": "2024-12-21T15:30:00Z",
  "expiresAt": "2025-12-21T15:30:00Z",
  "lastInvocation": "2024-12-21T16:42:18Z",

  "statistics": {
    "invocations": {
      "total": 15482,
      "last24h": 3241,
      "last7d": 10234,
      "last30d": 43210
    },
    "errors": {
      "total": 32,
      "last24h": 5,
      "last7d": 12,
      "last30d": 28
    },
    "averageResponseMs": 45
  },

  "health": {
    "status": "healthy",
    "lastCheck": "2024-12-21T16:44:00Z",
    "consecutiveFailures": 0
  }
}
</pre><a href="#section-4.5.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="registration-expiration-and-renewal">
<section id="section-4.5.3">
          <h4 id="name-registration-expiration-and">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-registration-expiration-and" class="section-name selfRef">Registration Expiration and Renewal</a>
          </h4>
<p id="section-4.5.3-1">Registrations <span class="bcp14">MAY</span> have an expiration time set by the MTA based on policy. Scanners <span class="bcp14">MUST</span> re-register before expiration to maintain continuous service. Re-registration follows the same process as initial registration and requires full capability renegotiation.<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3-2">The MTA <span class="bcp14">SHOULD</span> provide advance notice of pending expiration through the status endpoint. Scanners <span class="bcp14">SHOULD</span> monitor their registration status and initiate re-registration before expiration.<a href="#section-4.5.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deregistration">
<section id="section-4.6">
        <h3 id="name-deregistration">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-deregistration" class="section-name selfRef">Deregistration</a>
        </h3>
<p id="section-4.6-1">Scanners deregister by sending an HTTP DELETE request to the deregistration endpoint.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-2">
<pre>
DELETE /v1/hooks/register/reg_7a3b9c2e HTTP/1.1
Host: mta.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
</pre><a href="#section-4.6-2" class="pilcrow">¶</a>
</div>
<p id="section-4.6-3">Upon successful deregistration, the MTA returns HTTP status 200 with confirmation:<a href="#section-4.6-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-4">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "registrationId": "reg_7a3b9c2e-4d5f-6a7b-8c9d-0e1f2a3b4c5d",
  "status": "deregistered",
  "deregisteredAt": "2024-12-21T16:45:00Z"
}
</pre><a href="#section-4.6-4" class="pilcrow">¶</a>
</div>
<p id="section-4.6-5">After deregistration, the MTA <span class="bcp14">MUST NOT</span> send further hook invocations to the scanner's callback URL.<a href="#section-4.6-5" class="pilcrow">¶</a></p>
<div id="in-flight-requests">
<section id="section-4.6.1">
          <h4 id="name-in-flight-requests">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-in-flight-requests" class="section-name selfRef">In-Flight Requests</a>
          </h4>
<p id="section-4.6.1-1">Hook invocations that are in-flight at the time of deregistration <span class="bcp14">MAY</span> complete normally. The MTA <span class="bcp14">SHOULD</span> accept and process responses from these in-flight invocations. Scanners <span class="bcp14">SHOULD</span> continue to respond to hook requests that arrive during or shortly after deregistration processing, as network latency may cause requests dispatched before deregistration to arrive afterward.<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<p id="section-4.6.1-2">Once deregistration completes, the MTA <span class="bcp14">MUST NOT</span> initiate new hook invocations to the deregistered scanner's callback URL. The MTA <span class="bcp14">SHOULD</span> allow a brief grace period (implementation-defined, but typically a few seconds) for in-flight responses before considering the deregistration fully complete.<a href="#section-4.6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="automatic-deregistration">
<section id="section-4.6.2">
          <h4 id="name-automatic-deregistration">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-automatic-deregistration" class="section-name selfRef">Automatic Deregistration</a>
          </h4>
<p id="section-4.6.2-1">The MTA <span class="bcp14">MAY</span> automatically deregister scanners that become unreachable. Implementation-specific policies govern the threshold for automatic deregistration, such as consecutive failure counts or timeout periods. The MTA <span class="bcp14">SHOULD</span> log automatic deregistrations for operational visibility.<a href="#section-4.6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="hook-request">
<section id="section-5">
      <h2 id="name-hook-request">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hook-request" class="section-name selfRef">Hook Request</a>
      </h2>
<p id="section-5-1">When processing reaches a stage for which scanners are registered, the MTA constructs a hook request and transmits it to each registered scanner's callback URL.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="request-structure">
<section id="section-5.1">
        <h3 id="name-request-structure">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-request-structure" class="section-name selfRef">Request Structure</a>
        </h3>
<p id="section-5.1-1">Hook requests are transmitted via HTTP POST to the scanner's callback URL. The <code>Content-Type</code> header indicates the serialization format negotiated during registration.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The MTA <span class="bcp14">MAY</span> include an <code>X-MTA-Hooks-Registration</code> header containing the registration identifier. This header is <span class="bcp14">OPTIONAL</span> but can assist scanners that handle multiple registrations at a single endpoint.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">The request body contains a JSON or CBOR object with properties determined by the scanner's registration. The following sections describe available properties organized by category.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="common-properties">
<section id="section-5.2">
        <h3 id="name-common-properties">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-common-properties" class="section-name selfRef">Common Properties</a>
        </h3>
<p id="section-5.2-1">The following properties are available for both inbound and outbound processing:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.2-2">
          <dt id="section-5.2-2.1">
<strong>stage</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.2">
            <p id="section-5.2-2.2.1">The current processing stage.<a href="#section-5.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.3">
<strong>action</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.4">
            <p id="section-5.2-2.4.1">The action the MTA will perform if no scanner modifications occur. For inbound processing, values are "accept", "reject", "discard", "quarantine", or "disconnect". For outbound processing, values are "continue" or "cancel".<a href="#section-5.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.5">
<strong>envelope</strong>: <code>Envelope</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.6">
            <p id="section-5.2-2.6.1">The message envelope containing sender and recipient information.<a href="#section-5.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.7">
<strong>message</strong>: <code>Object|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.8">
            <p id="section-5.2-2.8.1">A structured representation of the email message based on the Email object defined in <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4" class="relref">Section 4</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span>.<a href="#section-5.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.9">
<strong>rawMessage</strong>: <code>String|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.10">
            <p id="section-5.2-2.10.1">The complete message in Internet Message Format as defined in <span>[<a href="#RFC5322" class="cite xref">RFC5322</a>]</span>. In JSON serialization, the value is Base64-encoded. In CBOR serialization, the value is a raw byte string.<a href="#section-5.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.11">
<strong>timestamp</strong>: <code>UTCDate</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.12">
            <p id="section-5.2-2.12.1">Timestamp when the current stage began.<a href="#section-5.2-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.13">
<strong>protocol</strong>: <code>ProtocolInfo|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.14">
            <p id="section-5.2-2.14.1">Protocol information.<a href="#section-5.2-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.15">
<strong>queue</strong>: <code>QueueInfo|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.16">
            <p id="section-5.2-2.16.1">Queue information.<a href="#section-5.2-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-2.17">
<strong>server</strong>: <code>ServerInfo|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.2-2.18">
            <p id="section-5.2-2.18.1">Information about the MTA.<a href="#section-5.2-2.18.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="envelope-properties">
<section id="section-5.3">
        <h3 id="name-envelope-properties">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-envelope-properties" class="section-name selfRef">Envelope Properties</a>
        </h3>
<p id="section-5.3-1">An <strong>Envelope</strong> object has the following properties:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.3-2">
          <dt id="section-5.3-2.1">
<strong>from</strong>: <code>EnvelopeAddress</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-2.2">
            <p id="section-5.3-2.2.1">Sender information from MAIL FROM command.<a href="#section-5.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.3">
<strong>to</strong>: <code>EnvelopeAddress[]|DeliveryRecipient[]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-2.4">
            <p id="section-5.3-2.4.1">Recipient information from RCPT TO commands. For inbound processing, this is an array of EnvelopeAddress objects. For outbound processing, this is an array of DeliveryRecipient objects.<a href="#section-5.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.3-3">An <strong>EnvelopeAddress</strong> object represents an address in the message envelope and has the following properties:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.3-4">
          <dt id="section-5.3-4.1">
<strong>address</strong>: <code>String|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-4.2">
            <p id="section-5.3-4.2.1">The email address. For MAIL FROM, this <span class="bcp14">MAY</span> be null to represent the null reverse-path. For RCPT TO, this <span class="bcp14">MUST NOT</span> be null.<a href="#section-5.3-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-4.3">
<strong>parameters</strong>: <code>String[String]</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-4.4">
            <p id="section-5.3-4.4.1">SMTP parameters associated with the address as key-value pairs. Common parameters include ORCPT, ENVID, and other DSN-related parameters defined in <span>[<a href="#RFC3461" class="cite xref">RFC3461</a>]</span>.<a href="#section-5.3-4.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.3-5">For outbound processing, recipient objects include additional delivery status fields described in <a href="#outbound-properties" class="auto internal xref">Section 5.9</a>.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="queue-properties">
<section id="section-5.4">
        <h3 id="name-queue-properties">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-queue-properties" class="section-name selfRef">Queue Properties</a>
        </h3>
<p id="section-5.4-1">A <strong>QueueInfo</strong> object has the following properties:<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.4-2">
          <dt id="section-5.4-2.1">
<strong>id</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.4-2.2">
            <p id="section-5.4-2.2.1">Unique queue identifier for this message within this MTA. The identifier <span class="bcp14">MUST</span> be unique for the lifetime of the message in the queue and <span class="bcp14">SHOULD</span> remain stable across hook invocations for the same queued message.<a href="#section-5.4-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="message-properties">
<section id="section-5.5">
        <h3 id="name-message-properties">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-message-properties" class="section-name selfRef">Message Properties</a>
        </h3>
<div id="structured-message">
<section id="section-5.5.1">
          <h4 id="name-structured-message">
<a href="#section-5.5.1" class="section-number selfRef">5.5.1. </a><a href="#name-structured-message" class="section-name selfRef">Structured Message</a>
          </h4>
<p id="section-5.5.1-1">The <code>message</code> property contains a structured representation of the email message based on the Email object defined in <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4" class="relref">Section 4</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span>. The following differences from the JMAP Email object apply:<a href="#section-5.5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.1-2.1">
              <p id="section-5.5.1-2.1.1">Metadata properties defined in <span><a href="https://rfc-editor.org/rfc/rfc8621#section-4.1.1" class="relref">Section 4.1.1</a> of [<a href="#RFC8621" class="cite xref">RFC8621</a>]</span> are not included, with the exception of the "size" property which <span class="bcp14">MAY</span> be present.<a href="#section-5.5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.1-2.2">
              <p id="section-5.5.1-2.2.1">The <code>blobId</code> property is replaced by a <code>blob</code> property containing the actual content. In JSON serialization, blob values are Base64-encoded strings. In CBOR serialization, blob values are raw byte strings.<a href="#section-5.5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.5.1-3">Property availability depends on the processing stage and MTA capabilities. At early stages such as "connect" or "ehlo", message properties are not available.<a href="#section-5.5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="raw-message">
<section id="section-5.5.2">
          <h4 id="name-raw-message">
<a href="#section-5.5.2" class="section-number selfRef">5.5.2. </a><a href="#name-raw-message" class="section-name selfRef">Raw Message</a>
          </h4>
<p id="section-5.5.2-1">The <code>rawMessage</code> property contains the complete message in Internet Message Format as defined in <span>[<a href="#RFC5322" class="cite xref">RFC5322</a>]</span>, including all MIME parts
and attachments. In JSON serialization, the value is Base64-encoded. In CBOR serialization, the value is a raw byte string.<a href="#section-5.5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.5.2-2">The <code>rawMessage</code> property represents the entire message as stored or received by the MTA. When present, it provides byte-exact access to the message content, which is necessary for operations such as cryptographic signature verification.<a href="#section-5.5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.5.2-3">Scanners <span class="bcp14">MAY</span> request both <code>message</code> and <code>rawMessage</code> properties. If a scanner's response modifies both properties, only <code>rawMessage</code> modifications are applied; <code>message</code> modifications are ignored.<a href="#section-5.5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.5.2-4">The raw message content <span class="bcp14">MUST NOT</span> appear within the <code>message</code> property as a blob value. The <code>message</code> property contains only the structured parsed representation with individual body part contents available via <code>bodyValues</code>, while <code>rawMessage</code> contains the complete unparsed message.<a href="#section-5.5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="choosing-between-structured-and-raw">
<section id="section-5.5.3">
          <h4 id="name-choosing-between-structured">
<a href="#section-5.5.3" class="section-number selfRef">5.5.3. </a><a href="#name-choosing-between-structured" class="section-name selfRef">Choosing Between Structured and Raw</a>
          </h4>
<p id="section-5.5.3-1">The <code>message</code> property provides a structured, parsed representation suitable for:<a href="#section-5.5.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.3-2.1">
              <p id="section-5.5.3-2.1.1">Header inspection and modification<a href="#section-5.5.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-2.2">
              <p id="section-5.5.3-2.2.1">Recipient analysis<a href="#section-5.5.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-2.3">
              <p id="section-5.5.3-2.3.1">Content-type aware body part processing<a href="#section-5.5.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-2.4">
              <p id="section-5.5.3-2.4.1">Efficient access to specific message components<a href="#section-5.5.3-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.5.3-3">The <code>rawMessage</code> property provides the complete RFC 5322 message suitable for:<a href="#section-5.5.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.3-4.1">
              <p id="section-5.5.3-4.1.1">Cryptographic verification (DKIM signature validation)<a href="#section-5.5.3-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-4.2">
              <p id="section-5.5.3-4.2.1">Archival or compliance logging<a href="#section-5.5.3-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-4.3">
              <p id="section-5.5.3-4.3.1">Processing that requires byte-exact message content<a href="#section-5.5.3-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.3-4.4">
              <p id="section-5.5.3-4.4.1">Forwarding or re-injection without modification<a href="#section-5.5.3-4.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.5.3-5">Scanners that need both structured access and raw content <span class="bcp14">SHOULD</span> request both properties. When modifying messages, scanners <span class="bcp14">SHOULD</span> prefer structured modifications via the <code>message</code> property unless byte-exact control is required. Modifications to <code>rawMessage</code> require the scanner to produce a complete, valid RFC 5322 message.<a href="#section-5.5.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server-properties">
<section id="section-5.6">
        <h3 id="name-server-properties">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-server-properties" class="section-name selfRef">Server Properties</a>
        </h3>
<p id="section-5.6-1">A <strong>ServerInfo</strong> object has the following properties:<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.6-2">
          <dt id="section-5.6-2.1">
<strong>name</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.6-2.2">
            <p id="section-5.6-2.2.1">Server hostname.<a href="#section-5.6-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.6-2.3">
<strong>ip</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.6-2.4">
            <p id="section-5.6-2.4.1">Server IP address.<a href="#section-5.6-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.6-2.5">
<strong>port</strong>: <code>UnsignedInt</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.6-2.6">
            <p id="section-5.6-2.6.1">Server port number.<a href="#section-5.6-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="protocol-properties">
<section id="section-5.7">
        <h3 id="name-protocol-properties">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-protocol-properties" class="section-name selfRef">Protocol Properties</a>
        </h3>
<p id="section-5.7-1">A <strong>ProtocolInfo</strong> object has the following properties:<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.7-2">
          <dt id="section-5.7-2.1">
<strong>version</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.7-2.2">
            <p id="section-5.7-2.2.1">MTA Hooks protocol version.<a href="#section-5.7-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="inbound-properties">
<section id="section-5.8">
        <h3 id="name-inbound-properties">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-inbound-properties" class="section-name selfRef">Inbound Properties</a>
        </h3>
<p id="section-5.8-1">The following properties are available only during inbound processing:<a href="#section-5.8-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.8-2">
          <dt id="section-5.8-2.1">
<strong>response</strong>: <code>SmtpResponse|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.8-2.2">
            <p id="section-5.8-2.2.1">The SMTP response the MTA would send if no scanner modifications occur.<a href="#section-5.8-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.8-2.3">
<strong>client</strong>: <code>ClientInfo|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.8-2.4">
            <p id="section-5.8-2.4.1">Information about the connecting SMTP client.<a href="#section-5.8-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.8-2.5">
<strong>senderAuth</strong>: <code>SenderAuthentication|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.8-2.6">
            <p id="section-5.8-2.6.1">Results of sender authentication checks.<a href="#section-5.8-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.8-2.7">
<strong>auth</strong>: <code>SmtpAuthentication|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.8-2.8">
            <p id="section-5.8-2.8.1">SMTP authentication information, if the client authenticated.<a href="#section-5.8-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.8-2.9">
<strong>tls</strong>: <code>TlsInfo|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-5.8-2.10">
            <p id="section-5.8-2.10.1">TLS connection information.<a href="#section-5.8-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<div id="smtp-response-properties">
<section id="section-5.8.1">
          <h4 id="name-smtp-response-properties">
<a href="#section-5.8.1" class="section-number selfRef">5.8.1. </a><a href="#name-smtp-response-properties" class="section-name selfRef">SMTP Response Properties</a>
          </h4>
<p id="section-5.8.1-1">An <strong>SmtpResponse</strong> object represents an SMTP response and has the following properties:<a href="#section-5.8.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.8.1-2">
            <dt id="section-5.8.1-2.1">
<strong>code</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.1-2.2">
              <p id="section-5.8.1-2.2.1">The three-digit SMTP status code.<a href="#section-5.8.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.1-2.3">
<strong>enhancedCode</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.1-2.4">
              <p id="section-5.8.1-2.4.1">The enhanced status code as defined in <span>[<a href="#RFC3461" class="cite xref">RFC3461</a>]</span>, if available.<a href="#section-5.8.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.1-2.5">
<strong>message</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.1-2.6">
              <p id="section-5.8.1-2.6.1">The human-readable response text.<a href="#section-5.8.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="client-properties">
<section id="section-5.8.2">
          <h4 id="name-client-properties">
<a href="#section-5.8.2" class="section-number selfRef">5.8.2. </a><a href="#name-client-properties" class="section-name selfRef">Client Properties</a>
          </h4>
<p id="section-5.8.2-1">A <strong>ClientInfo</strong> object has the following properties:<a href="#section-5.8.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.8.2-2">
            <dt id="section-5.8.2-2.1">
<strong>ip</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.2">
              <p id="section-5.8.2-2.2.1">Client IP address.<a href="#section-5.8.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.3">
<strong>port</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.4">
              <p id="section-5.8.2-2.4.1">Client port number.<a href="#section-5.8.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.5">
<strong>ptr</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.6">
              <p id="section-5.8.2-2.6.1">PTR record for client IP, if available.<a href="#section-5.8.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.7">
<strong>ehlo</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.8">
              <p id="section-5.8.2-2.8.1">EHLO or HELO string sent by client.<a href="#section-5.8.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.9">
<strong>asn</strong>: <code>UnsignedInt|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.10">
              <p id="section-5.8.2-2.10.1">Autonomous System Number for client IP, if available.<a href="#section-5.8.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.11">
<strong>country</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.12">
              <p id="section-5.8.2-2.12.1">ISO 3166-1 alpha-2 country code for client IP, if available.<a href="#section-5.8.2-2.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.2-2.13">
<strong>activeConnections</strong>: <code>UnsignedInt|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.2-2.14">
              <p id="section-5.8.2-2.14.1">Number of concurrent connections from this client.<a href="#section-5.8.2-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="tls-properties">
<section id="section-5.8.3">
          <h4 id="name-tls-properties">
<a href="#section-5.8.3" class="section-number selfRef">5.8.3. </a><a href="#name-tls-properties" class="section-name selfRef">TLS Properties</a>
          </h4>
<p id="section-5.8.3-1">A <strong>TlsInfo</strong> object has the following properties:<a href="#section-5.8.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.8.3-2">
            <dt id="section-5.8.3-2.1">
<strong>version</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.3-2.2">
              <p id="section-5.8.3-2.2.1">TLS protocol version (e.g., "TLSv1.3").<a href="#section-5.8.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.3-2.3">
<strong>cipher</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.3-2.4">
              <p id="section-5.8.3-2.4.1">Cipher suite name.<a href="#section-5.8.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.3-2.5">
<strong>cipherBits</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.3-2.6">
              <p id="section-5.8.3-2.6.1">Cipher key length in bits.<a href="#section-5.8.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.3-2.7">
<strong>certIssuer</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.3-2.8">
              <p id="section-5.8.3-2.8.1">Client certificate issuer, if a client certificate was presented.<a href="#section-5.8.3-2.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.3-2.9">
<strong>certSubject</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.3-2.10">
              <p id="section-5.8.3-2.10.1">Client certificate subject, if a client certificate was presented.<a href="#section-5.8.3-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="sender-authentication-properties">
<section id="section-5.8.4">
          <h4 id="name-sender-authentication-prope">
<a href="#section-5.8.4" class="section-number selfRef">5.8.4. </a><a href="#name-sender-authentication-prope" class="section-name selfRef">Sender Authentication Properties</a>
          </h4>
<p id="section-5.8.4-1">A <strong>SenderAuthentication</strong> object has the following properties:<a href="#section-5.8.4-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.8.4-2">
            <dt id="section-5.8.4-2.1">
<strong>spf-ehlo</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.4-2.2">
              <p id="section-5.8.4-2.2.1">SPF result for EHLO identity as defined in <span>[<a href="#RFC7208" class="cite xref">RFC7208</a>]</span>.<a href="#section-5.8.4-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.4-2.3">
<strong>spf-mail</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.4-2.4">
              <p id="section-5.8.4-2.4.1">SPF result for MAIL FROM identity as defined in <span>[<a href="#RFC7208" class="cite xref">RFC7208</a>]</span>.<a href="#section-5.8.4-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.4-2.5">
<strong>dkim</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.4-2.6">
              <p id="section-5.8.4-2.6.1">DKIM verification result as defined in <span>[<a href="#RFC6376" class="cite xref">RFC6376</a>]</span>.<a href="#section-5.8.4-2.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.4-2.7">
<strong>arc</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.4-2.8">
              <p id="section-5.8.4-2.8.1">ARC verification result.<a href="#section-5.8.4-2.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.4-2.9">
<strong>dmarc</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.4-2.10">
              <p id="section-5.8.4-2.10.1">DMARC evaluation result as defined in <span>[<a href="#RFC7489" class="cite xref">RFC7489</a>]</span>.<a href="#section-5.8.4-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5.8.4-3">Authentication result values follow the conventions established in the respective specifications.<a href="#section-5.8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="smtp-authentication-properties">
<section id="section-5.8.5">
          <h4 id="name-smtp-authentication-propert">
<a href="#section-5.8.5" class="section-number selfRef">5.8.5. </a><a href="#name-smtp-authentication-propert" class="section-name selfRef">SMTP Authentication Properties</a>
          </h4>
<p id="section-5.8.5-1">An <strong>SmtpAuthentication</strong> object has the following properties:<a href="#section-5.8.5-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.8.5-2">
            <dt id="section-5.8.5-2.1">
<strong>login</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.5-2.2">
              <p id="section-5.8.5-2.2.1">Authenticated username.<a href="#section-5.8.5-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.8.5-2.3">
<strong>method</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.8.5-2.4">
              <p id="section-5.8.5-2.4.1">SASL mechanism used for authentication.<a href="#section-5.8.5-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="outbound-properties">
<section id="section-5.9">
        <h3 id="name-outbound-properties">
<a href="#section-5.9" class="section-number selfRef">5.9. </a><a href="#name-outbound-properties" class="section-name selfRef">Outbound Properties</a>
        </h3>
<p id="section-5.9-1">The following properties are available only during outbound processing.<a href="#section-5.9-1" class="pilcrow">¶</a></p>
<div id="extended-queue-properties">
<section id="section-5.9.1">
          <h4 id="name-extended-queue-properties">
<a href="#section-5.9.1" class="section-number selfRef">5.9.1. </a><a href="#name-extended-queue-properties" class="section-name selfRef">Extended Queue Properties</a>
          </h4>
<p id="section-5.9.1-1">For outbound processing, the queue property uses an <strong>OutboundQueueInfo</strong> object, which extends QueueInfo with additional fields:<a href="#section-5.9.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.9.1-2">
            <dt id="section-5.9.1-2.1">
<strong>id</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.1-2.2">
              <p id="section-5.9.1-2.2.1">Unique queue identifier for this message.<a href="#section-5.9.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.1-2.3">
<strong>expiresAt</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.1-2.4">
              <p id="section-5.9.1-2.4.1">Timestamp when the queue entry expires.<a href="#section-5.9.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.1-2.5">
<strong>attempts</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.1-2.6">
              <p id="section-5.9.1-2.6.1">Total delivery attempts made so far.<a href="#section-5.9.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="recipient-delivery-status">
<section id="section-5.9.2">
          <h4 id="name-recipient-delivery-status">
<a href="#section-5.9.2" class="section-number selfRef">5.9.2. </a><a href="#name-recipient-delivery-status" class="section-name selfRef">Recipient Delivery Status</a>
          </h4>
<p id="section-5.9.2-1">For outbound processing, each recipient in envelope.to is represented as a DeliveryRecipient object.<a href="#section-5.9.2-1" class="pilcrow">¶</a></p>
<p id="section-5.9.2-2">A <strong>DeliveryRecipient</strong> object extends EnvelopeAddress with delivery status information and has the following properties:<a href="#section-5.9.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-5.9.2-3">
            <dt id="section-5.9.2-3.1">
<strong>address</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.2">
              <p id="section-5.9.2-3.2.1">The recipient email address.<a href="#section-5.9.2-3.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.3">
<strong>parameters</strong>: <code>String[String]</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.4">
              <p id="section-5.9.2-3.4.1">SMTP parameters associated with the address as key-value pairs.<a href="#section-5.9.2-3.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.5">
<strong>status</strong>: <code>String</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.6">
              <p id="section-5.9.2-3.6.1">The delivery status for this recipient. Values are "pending", "delivered", "deferred", "failed", or "failed-silent".<a href="#section-5.9.2-3.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.7">
<strong>attempt</strong>: <code>UnsignedInt</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.8">
              <p id="section-5.9.2-3.8.1">The current delivery attempt number for this recipient.<a href="#section-5.9.2-3.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.9">
<strong>lastResponse</strong>: <code>SmtpResponse|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.10">
              <p id="section-5.9.2-3.10.1">The last SMTP response received for this recipient, or null if no attempt has been made.<a href="#section-5.9.2-3.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.11">
<strong>nextAttemptAt</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.12">
              <p id="section-5.9.2-3.12.1">The scheduled time for the next delivery attempt, or null if no retry is scheduled.<a href="#section-5.9.2-3.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.13">
<strong>nextDsnAt</strong>: <code>UTCDate|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.14">
              <p id="section-5.9.2-3.14.1">The scheduled time for the next DSN generation, or null if no DSN is scheduled.<a href="#section-5.9.2-3.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-5.9.2-3.15">
<strong>queueName</strong>: <code>String|null</code>
</dt>
            <dd style="margin-left: 1.5em" id="section-5.9.2-3.16">
              <p id="section-5.9.2-3.16.1">The name of the outbound queue handling this recipient, if applicable.<a href="#section-5.9.2-3.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-5.9.2-4">For the "dsn" stage, the <code>message</code> and <code>rawMessage</code> properties contain the DSN message that the MTA is about to send. Scanners <span class="bcp14">MAY</span> modify or delete these properties to alter or suppress DSN generation.<a href="#section-5.9.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="example-inbound-hook-request">
<section id="section-5.10">
        <h3 id="name-example-inbound-hook-reques">
<a href="#section-5.10" class="section-number selfRef">5.10. </a><a href="#name-example-inbound-hook-reques" class="section-name selfRef">Example Inbound Hook Request</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.10-1">
<pre>
POST /hooks/scan HTTP/1.1
Host: scanner.example.com
Content-Type: application/json
X-MTA-Hooks-Registration: reg_7a3b9c2e

{
  "stage": "data",
  "action": "accept",
  "timestamp": "2024-12-21T16:30:00Z",

  "response": {
    "code": 250,
    "enhancedCode": "2.0.0",
    "message": "OK"
  },

  "protocol": {
    "version": "1.0"
  },

  "queue": {
    "id": "queue_abc123"
  },

  "envelope": {
    "from": {
      "address": "sender@example.org",
      "parameters": {}
    },
    "to": [
      {
        "address": "recipient@example.com",
        "parameters": {}
      }
    ]
  },

  "message": {
    "size": 2048,
    "subject": "Meeting Tomorrow",
    "from": [
      {
        "name": "Sender Name",
        "email": "sender@example.org"
      }
    ],
    "to": [
      {
        "email": "recipient@example.com"
      }
    ],
    "sentAt": "2024-12-21T16:29:00Z",
    "messageId": ["&lt;msg123@example.org&gt;"],
    "headers": [
      {"name": "From", "value": "Sender Name &lt;sender@example.org&gt;"},
      {"name": "To", "value": "recipient@example.com"},
      {"name": "Subject", "value": "Meeting Tomorrow"},
      {"name": "Date", "value": "Sat, 21 Dec 2024 16:29:00 +0000"},
      {"name": "Message-ID", "value": "&lt;msg123@example.org&gt;"}
    ],
    "bodyStructure": {
      "type": "text/plain",
      "charset": "utf-8",
      "size": 28
    },
    "bodyValues": {
      "1": {
        "value": "Let's meet tomorrow at 10am.",
        "isEncodingProblem": false,
        "isTruncated": false
      }
    }
  },

  "client": {
    "ip": "192.0.2.100",
    "port": 54321,
    "ptr": "mail.example.org",
    "ehlo": "mail.example.org",
    "activeConnections": 3
  },

  "server": {
    "name": "mx1.example.com",
    "ip": "198.51.100.25",
    "port": 25
  },

  "tls": {
    "version": "TLSv1.3",
    "cipher": "TLS_AES_256_GCM_SHA384",
    "cipherBits": 256
  },

  "senderAuth": {
    "spf-mail": "pass",
    "dkim": "pass",
    "dmarc": "pass"
  }
}
</pre><a href="#section-5.10-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="example-outbound-hook-request">
<section id="section-5.11">
        <h3 id="name-example-outbound-hook-reque">
<a href="#section-5.11" class="section-number selfRef">5.11. </a><a href="#name-example-outbound-hook-reque" class="section-name selfRef">Example Outbound Hook Request</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-5.11-1">
<pre>
POST /hooks/delivery HTTP/1.1
Host: scanner.example.com
Content-Type: application/json
X-MTA-Hooks-Registration: reg_7a3b9c2e

{
  "stage": "delivery",
  "action": "continue",
  "timestamp": "2024-12-21T17:00:00Z",

  "protocol": {
    "version": "1.0"
  },

  "queue": {
    "id": "queue_def456",
    "expiresAt": "2024-12-24T17:00:00Z",
    "attempts": 3
  },

  "envelope": {
    "from": {
      "address": "notifications@example.com",
      "parameters": {}
    },
    "to": [
      {
        "address": "user1@recipient.example",
        "parameters": {},
        "status": "delivered",
        "attempt": 1,
        "lastResponse": {
          "code": 250,
          "enhancedCode": "2.0.0",
          "message": "Message accepted"
        }
      },
      {
        "address": "user2@recipient.example",
        "parameters": {},
        "status": "deferred",
        "attempt": 3,
        "lastResponse": {
          "code": 451,
          "enhancedCode": "4.7.1",
          "message": "Try again later"
        },
        "nextAttemptAt": "2024-12-21T18:00:00Z",
        "nextDsnAt": "2024-12-22T17:00:00Z"
      }
    ]
  },

  "message": {
    "subject": "Your order has shipped",
    "from": [{"email": "notifications@example.com"}],
    "to": [
      {"email": "user1@recipient.example"},
      {"email": "user2@recipient.example"}
    ],
    "size": 4096
  },

  "server": {
    "name": "smtp-out.example.com",
    "ip": "198.51.100.50",
    "port": 25
  }
}
</pre><a href="#section-5.11-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="hook-response">
<section id="section-6">
      <h2 id="name-hook-response">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-hook-response" class="section-name selfRef">Hook Response</a>
      </h2>
<p id="section-6-1">Scanners respond to hook requests with modifications to the request object. These modifications instruct the MTA how to proceed with message processing.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="response-structure">
<section id="section-6.1">
        <h3 id="name-response-structure">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-response-structure" class="section-name selfRef">Response Structure</a>
        </h3>
<p id="section-6.1-1">Scanners respond with an HTTP 200 status code. The response body contains a JSON or CBOR object specifying modifications to apply to the hook request. The object has the following fields:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-6.1-2">
          <dt id="section-6.1-2.1">
<strong>set</strong>: <code>SetOperation[]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">An array of set operations to apply, or null if no set operations.<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-2.3">
<strong>add</strong>: <code>AddOperation[]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-2.4">
            <p id="section-6.1-2.4.1">An array of add operations to apply, or null if no add operations.<a href="#section-6.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-2.5">
<strong>delete</strong>: <code>DeleteOperation[]|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-2.6">
            <p id="section-6.1-2.6.1">An array of delete operations to apply, or null if no delete
operations.<a href="#section-6.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.1-3">A <strong>SetOperation</strong> object has the following properties:<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.1-4">
          <dt id="section-6.1-4.1">
<strong>path</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-4.2">
            <p id="section-6.1-4.2.1">JSON Pointer (per <span>[<a href="#RFC6901" class="cite xref">RFC6901</a>]</span>) to the property to replace.<a href="#section-6.1-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-4.3">
<strong>value</strong>: <code>any</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-4.4">
            <p id="section-6.1-4.4.1">The new value for the property.<a href="#section-6.1-4.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.1-5">An <strong>AddOperation</strong> object has the following properties:<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.1-6">
          <dt id="section-6.1-6.1">
<strong>path</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-6.2">
            <p id="section-6.1-6.2.1">JSON Pointer to the location where the value should be added.<a href="#section-6.1-6.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-6.3">
<strong>value</strong>: <code>any</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-6.4">
            <p id="section-6.1-6.4.1">The value to add.<a href="#section-6.1-6.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.1-6.5">
<strong>index</strong>: <code>UnsignedInt|null</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-6.6">
            <p id="section-6.1-6.6.1">For array additions, the zero-based index at which to insert the
value. If null or omitted, the value is appended to the array.<a href="#section-6.1-6.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-6.1-7">A <strong>DeleteOperation</strong> object has the following properties:<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.1-8">
          <dt id="section-6.1-8.1">
<strong>path</strong>: <code>String</code>
</dt>
          <dd style="margin-left: 1.5em" id="section-6.1-8.2">
            <p id="section-6.1-8.2.1">JSON Pointer to the property to remove.<a href="#section-6.1-8.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="actions">
<section id="section-6.2">
        <h3 id="name-actions">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-actions" class="section-name selfRef">Actions</a>
        </h3>
<p id="section-6.2-1">Scanners change the MTA's action by including a set operation targeting the "/action" path. The following values are valid for inbound and outbound processing respectively.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The following action values are valid:<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<div id="inbound-actions">
<section id="section-6.2.1">
          <h4 id="name-inbound-actions">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-inbound-actions" class="section-name selfRef">Inbound Actions</a>
          </h4>
<span class="break"></span><dl class="dlNewline" id="section-6.2.1-1">
            <dt id="section-6.2.1-1.1"><strong>accept</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.1-1.2">
              <p id="section-6.2.1-1.2.1">Accept the message for delivery to recipients. Non-terminal; chain
continues.<a href="#section-6.2.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.1-1.3"><strong>reject</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.1-1.4">
              <p id="section-6.2.1-1.4.1">Reject the message and return an error response to the sending
client. Terminal; chain stops.<a href="#section-6.2.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.1-1.5"><strong>discard</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.1-1.6">
              <p id="section-6.2.1-1.6.1">Accept the message from the client but do not deliver it. The
client receives a success response. Terminal; chain stops.<a href="#section-6.2.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.1-1.7"><strong>quarantine</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.1-1.8">
              <p id="section-6.2.1-1.8.1">Accept the message and place it in quarantine for administrative
review. Quarantine location and handling are implementation-defined.
Non-terminal; chain continues.<a href="#section-6.2.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.1-1.9"><strong>disconnect</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.1-1.10">
              <p id="section-6.2.1-1.10.1">Terminate the SMTP connection immediately. Terminal; chain stops.<a href="#section-6.2.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="outbound-actions">
<section id="section-6.2.2">
          <h4 id="name-outbound-actions">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-outbound-actions" class="section-name selfRef">Outbound Actions</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-6.2.2-1">
            <dt id="section-6.2.2-1.1"><strong>continue</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-1.2">
              <p id="section-6.2.2-1.2.1">Proceed with normal processing. Non-terminal; chain continues.<a href="#section-6.2.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-6.2.2-1.3"><strong>cancel</strong></dt>
            <dd style="margin-left: 1.5em" id="section-6.2.2-1.4">
              <p id="section-6.2.2-1.4.1">Cancel all pending deliveries for this message. Terminal; chain stops.<a href="#section-6.2.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="modifications-1">
<section id="section-6.3">
        <h3 id="name-modifications-2">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-modifications-2" class="section-name selfRef">Modifications</a>
        </h3>
<p id="section-6.3-1">Scanners communicate changes by specifying operations on the hook request object. The response contains JSON Pointer paths identifying properties to modify and the operations to perform. These modifications can alter any aspect of the transaction that the MTA permits, including:<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3-2.1">
            <p id="section-6.3-2.1.1">The action the MTA should take (accept, reject, quarantine, etc.)<a href="#section-6.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.3-2.2">
            <p id="section-6.3-2.2.1">The SMTP response to send to the client or expect from the server<a href="#section-6.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.3-2.3">
            <p id="section-6.3-2.3.1">Message headers and body content<a href="#section-6.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.3-2.4">
            <p id="section-6.3-2.4.1">Envelope addresses (sender and recipients)<a href="#section-6.3-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.3-2.5">
            <p id="section-6.3-2.5.1">Per-recipient delivery status for outbound processing<a href="#section-6.3-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.3-3">Three modification operations are supported:<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.3-4">
          <dt id="section-6.3-4.1"><strong>set</strong></dt>
          <dd style="margin-left: 1.5em" id="section-6.3-4.2">
            <p id="section-6.3-4.2.1">Replace the value at a specified path with a new value.<a href="#section-6.3-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.3-4.3"><strong>add</strong></dt>
          <dd style="margin-left: 1.5em" id="section-6.3-4.4">
            <p id="section-6.3-4.4.1">Insert a value at a specified path. For objects, this adds a new
property. For arrays, this inserts an element at the specified
index or appends if no index is given.<a href="#section-6.3-4.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-6.3-4.5"><strong>delete</strong></dt>
          <dd style="margin-left: 1.5em" id="section-6.3-4.6">
            <p id="section-6.3-4.6.1">Remove the value at a specified path.<a href="#section-6.3-4.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<div id="set-operations">
<section id="section-6.3.1">
          <h4 id="name-set-operations">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-set-operations" class="section-name selfRef">Set Operations</a>
          </h4>
<p id="section-6.3.1-1">Set operations replace values at specified paths.<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.3.1-2">
<pre>
{
  "set": [
    {
      "path": "/action",
      "value": "reject"
    },
    {
      "path": "/response",
      "value": {
        "code": 550,
        "enhancedCode": "5.7.1",
        "message": "Message rejected due to policy"
      }
    }
  ]
}
</pre><a href="#section-6.3.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="add-operations">
<section id="section-6.3.2">
          <h4 id="name-add-operations">
<a href="#section-6.3.2" class="section-number selfRef">6.3.2. </a><a href="#name-add-operations" class="section-name selfRef">Add Operations</a>
          </h4>
<p id="section-6.3.2-1">Add operations insert new values. For arrays, an optional index specifies insertion position.<a href="#section-6.3.2-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.3.2-2">
<pre>
{
  "add": [
    {
      "path": "/message/headers",
      "value": {"name": "X-Spam-Score", "value": "5.2"},
      "index": 0
    },
    {
      "path": "/envelope/to",
      "value": {
        "address": "archive@example.com",
        "parameters": {}
      }
    }
  ]
}
</pre><a href="#section-6.3.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="delete-operations">
<section id="section-6.3.3">
          <h4 id="name-delete-operations">
<a href="#section-6.3.3" class="section-number selfRef">6.3.3. </a><a href="#name-delete-operations" class="section-name selfRef">Delete Operations</a>
          </h4>
<p id="section-6.3.3-1">Delete operations remove values at specified paths. When deleting array elements, indices refer to positions in the array at the time each delete operation executes. Because delete operations execute sequentially and earlier deletions cause subsequent elements to shift to lower indices, scanners <span class="bcp14">SHOULD</span> order array deletions from highest to lowest index to avoid unexpected results.<a href="#section-6.3.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3.3-2">For example, to delete elements originally at indices 1 and 3 from an array:<a href="#section-6.3.3-2" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.3.3-3">
<pre>
{
  "delete": [
    {"path": "/message/headers/3"},
    {"path": "/message/headers/1"}
  ]
}
</pre><a href="#section-6.3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-6.3.3-4">Deleting index 3 first leaves the element originally at index 1 still at index 1. If the order were reversed, deleting index 1 first would shift the element originally at index 3 to index 2.<a href="#section-6.3.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="modification-order">
<section id="section-6.3.4">
          <h4 id="name-modification-order">
<a href="#section-6.3.4" class="section-number selfRef">6.3.4. </a><a href="#name-modification-order" class="section-name selfRef">Modification Order</a>
          </h4>
<p id="section-6.3.4-1">The MTA applies modifications in the following order:<a href="#section-6.3.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.3.4-2">
<li id="section-6.3.4-2.1">
              <p id="section-6.3.4-2.1.1">Set operations<a href="#section-6.3.4-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.3.4-2.2">
              <p id="section-6.3.4-2.2.1">Add operations<a href="#section-6.3.4-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.3.4-2.3">
              <p id="section-6.3.4-2.3.1">Delete operations<a href="#section-6.3.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-6.3.4-3">This ordering allows predictable results when multiple operations affect related paths.<a href="#section-6.3.4-3" class="pilcrow">¶</a></p>
<p id="section-6.3.4-4">To change the action the MTA takes, the scanner sets the "/action" path to the desired value. To modify the SMTP response, the scanner can either set individual response fields (e.g., "/response/code", "/response/message") or replace the entire response object by setting "/response".<a href="#section-6.3.4-4" class="pilcrow">¶</a></p>
<p id="section-6.3.4-5">If a scanner modifies both the "message" and "rawMessage" properties, the "rawMessage" modification takes precedence and "message" modifications are ignored.<a href="#section-6.3.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conflicting-operations">
<section id="section-6.3.5">
          <h4 id="name-conflicting-operations">
<a href="#section-6.3.5" class="section-number selfRef">6.3.5. </a><a href="#name-conflicting-operations" class="section-name selfRef">Conflicting Operations</a>
          </h4>
<p id="section-6.3.5-1">If a response contains multiple operations targeting the same path or overlapping paths, the MTA applies them in the defined order (set, then add, then delete). The final state reflects all operations applied sequentially. For example, if a response sets "/message/subject" and also deletes "/message/subject", the subject will be deleted (delete operations execute last).<a href="#section-6.3.5-1" class="pilcrow">¶</a></p>
<p id="section-6.3.5-2">Implementations <span class="bcp14">SHOULD NOT</span> submit responses with conflicting operations targeting the same path, as the resulting behavior, while deterministic, may be confusing.<a href="#section-6.3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="no-modification-response">
<section id="section-6.3.6">
          <h4 id="name-no-modification-response">
<a href="#section-6.3.6" class="section-number selfRef">6.3.6. </a><a href="#name-no-modification-response" class="section-name selfRef">No Modification Response</a>
          </h4>
<p id="section-6.3.6-1">If a scanner has no modifications to request, it <span class="bcp14">MUST</span> return either:<a href="#section-6.3.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.3.6-2.1">
              <p id="section-6.3.6-2.1.1">An empty JSON/CBOR object: <code>{}</code><a href="#section-6.3.6-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.3.6-2.2">
              <p id="section-6.3.6-2.2.1">A response with empty or null modification arrays: <code>{"set": null, "add": null, "delete": null}</code><a href="#section-6.3.6-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-6.3.6-2.3">
              <p id="section-6.3.6-2.3.1">An HTTP 204 No Content response with no body<a href="#section-6.3.6-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-6.3.6-3">In all cases, the MTA proceeds with the action specified in the original request. The scanner chain continues to the next registered scanner unless the current action is terminal.<a href="#section-6.3.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="size-limits">
<section id="section-6.3.7">
          <h4 id="name-size-limits">
<a href="#section-6.3.7" class="section-number selfRef">6.3.7. </a><a href="#name-size-limits" class="section-name selfRef">Size Limits</a>
          </h4>
<p id="section-6.3.7-1">MTAs <span class="bcp14">MAY</span> impose limits on the size of modification values. If a modification would cause a header or message to exceed configured size limits, the MTA <span class="bcp14">SHOULD</span> reject that specific modification and log the failure.<a href="#section-6.3.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="modification-errors">
<section id="section-6.3.8">
          <h4 id="name-modification-errors">
<a href="#section-6.3.8" class="section-number selfRef">6.3.8. </a><a href="#name-modification-errors" class="section-name selfRef">Modification Errors</a>
          </h4>
<p id="section-6.3.8-1">If a modification cannot be applied (for example, the path references a non-existent property for deletion, or the path is not in the permitted updateProperties list), the MTA <span class="bcp14">SHOULD</span>:<a href="#section-6.3.8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.3.8-2">
<li id="section-6.3.8-2.1">
              <p id="section-6.3.8-2.1.1">Log the error with sufficient detail for debugging<a href="#section-6.3.8-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.3.8-2.2">
              <p id="section-6.3.8-2.2.1">Increment modification failure statistics<a href="#section-6.3.8-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-6.3.8-2.3">
              <p id="section-6.3.8-2.3.1">Continue processing remaining modifications in the response<a href="#section-6.3.8-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-6.3.8-3">The MTA <span class="bcp14">MUST NOT</span> reject the entire response due to a single failed modification unless the failed modification is critical to interpreting the response (such as an invalid action value).<a href="#section-6.3.8-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="example-hook-responses">
<section id="section-6.4">
        <h3 id="name-example-hook-responses">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-example-hook-responses" class="section-name selfRef">Example Hook Responses</a>
        </h3>
<div id="accept-with-header-addition">
<section id="section-6.4.1">
          <h4 id="name-accept-with-header-addition">
<a href="#section-6.4.1" class="section-number selfRef">6.4.1. </a><a href="#name-accept-with-header-addition" class="section-name selfRef">Accept with Header Addition</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-6.4.1-1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "add": [
    {
      "path": "/message/headers",
      "value": {"name": "X-Spam-Status", "value": "No"},
      "index": 0
    },
    {
      "path": "/message/headers",
      "value": {"name": "X-Spam-Score", "value": "1.2"},
      "index": 1
    }
  ]
}
</pre><a href="#section-6.4.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="reject-with-custom-response">
<section id="section-6.4.2">
          <h4 id="name-reject-with-custom-response">
<a href="#section-6.4.2" class="section-number selfRef">6.4.2. </a><a href="#name-reject-with-custom-response" class="section-name selfRef">Reject with Custom Response</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-6.4.2-1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "set": [
    {
      "path": "/action",
      "value": "reject"
    },
    {
      "path": "/response",
      "value": {
        "code": 550,
        "enhancedCode": "5.7.1",
        "message": "Message rejected: virus detected"
      }
    }
  ]
}
</pre><a href="#section-6.4.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="modify-subject-and-add-recipient">
<section id="section-6.4.3">
          <h4 id="name-modify-subject-and-add-reci">
<a href="#section-6.4.3" class="section-number selfRef">6.4.3. </a><a href="#name-modify-subject-and-add-reci" class="section-name selfRef">Modify Subject and Add Recipient</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-6.4.3-1">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "set": [
    {
      "path": "/message/subject",
      "value": "[EXTERNAL] Original Subject"
    }
  ],
  "add": [
    {
      "path": "/envelope/to",
      "value": {
        "address": "compliance@example.com",
        "parameters": {}
      }
    }
  ]
}
</pre><a href="#section-6.4.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cancel-specific-recipient-delivery">
<section id="section-6.4.4">
          <h4 id="name-cancel-specific-recipient-d">
<a href="#section-6.4.4" class="section-number selfRef">6.4.4. </a><a href="#name-cancel-specific-recipient-d" class="section-name selfRef">Cancel Specific Recipient Delivery</a>
          </h4>
<p id="section-6.4.4-1">For outbound processing, to cancel delivery for a specific recipient:<a href="#section-6.4.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.4.4-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "set": [
    {
      "path": "/envelope/to/1/status",
      "value": "failed-silent"
    }
  ]
}
</pre><a href="#section-6.4.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="no-action-response">
<section id="section-6.4.5">
          <h4 id="name-no-action-response">
<a href="#section-6.4.5" class="section-number selfRef">6.4.5. </a><a href="#name-no-action-response" class="section-name selfRef">No Action Response</a>
          </h4>
<p id="section-6.4.5-1">If a scanner has no changes to request, it returns an empty response body or a response with no action or modifications:<a href="#section-6.4.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.4.5-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{}
</pre><a href="#section-6.4.5-2" class="pilcrow">¶</a>
</div>
<p id="section-6.4.5-3">The MTA proceeds with the default action specified in the request.<a href="#section-6.4.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="transport">
<section id="section-7">
      <h2 id="name-transport">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-transport" class="section-name selfRef">Transport</a>
      </h2>
<p id="section-7-1">This section specifies HTTP transport requirements for MTA Hooks communications.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="http-version">
<section id="section-7.1">
        <h3 id="name-http-version">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-http-version" class="section-name selfRef">HTTP Version</a>
        </h3>
<p id="section-7.1-1">Implementations <span class="bcp14">MUST</span> support HTTP/1.1 <span>[<a href="#RFC9112" class="cite xref">RFC9112</a>]</span>. Implementations <span class="bcp14">SHOULD</span> support HTTP/2 <span>[<a href="#RFC9113" class="cite xref">RFC9113</a>]</span> for improved performance through multiplexing. Implementations <span class="bcp14">MAY</span> support HTTP/3 <span>[<a href="#RFC9114" class="cite xref">RFC9114</a>]</span>.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">When multiple HTTP versions are available, implementations <span class="bcp14">SHOULD</span> prefer newer versions for their performance benefits while maintaining fallback to HTTP/1.1.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-requirements">
<section id="section-7.2">
        <h3 id="name-tls-requirements">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-tls-requirements" class="section-name selfRef">TLS Requirements</a>
        </h3>
<p id="section-7.2-1">All MTA Hooks communications <span class="bcp14">MUST</span> use TLS. Implementations <span class="bcp14">MUST</span> support TLS 1.2 <span>[<a href="#RFC5246" class="cite xref">RFC5246</a>]</span> and <span class="bcp14">SHOULD</span> support TLS 1.3 <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Implementations <span class="bcp14">MUST</span> validate server certificates against trusted certificate authorities. Self-signed certificates <span class="bcp14">SHOULD NOT</span> be accepted in production deployments unless explicitly configured by administrators.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">Cipher suite selection <span class="bcp14">SHOULD</span> follow current best practices. Implementations <span class="bcp14">SHOULD</span> disable cipher suites known to be weak or compromised.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-methods">
<section id="section-7.3">
        <h3 id="name-request-methods">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-request-methods" class="section-name selfRef">Request Methods</a>
        </h3>
<p id="section-7.3-1">The following HTTP methods are used:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3-2.1">
            <p id="section-7.3-2.1.1">GET: Discovery document retrieval and status queries<a href="#section-7.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-2.2">
            <p id="section-7.3-2.2.1">POST: Registration requests and hook invocations<a href="#section-7.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-7.3-2.3">
            <p id="section-7.3-2.3.1">DELETE: Deregistration requests<a href="#section-7.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="content-negotiation">
<section id="section-7.4">
        <h3 id="name-content-negotiation">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-content-negotiation" class="section-name selfRef">Content Negotiation</a>
        </h3>
<p id="section-7.4-1">For hook requests and responses, the <code>Content-Type</code> header <span class="bcp14">MUST</span> be set to "application/json" for JSON serialization or "application/cbor" for CBOR serialization.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">The <code>Accept</code> header <span class="bcp14">MAY</span> be used during discovery to indicate preferred serialization format. If the scanner cannot provide the requested format, it <span class="bcp14">SHOULD</span> return the discovery document in JSON format.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="error-handling">
<section id="section-7.5">
        <h3 id="name-error-handling">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
        </h3>
<div id="http-status-codes">
<section id="section-7.5.1">
          <h4 id="name-http-status-codes">
<a href="#section-7.5.1" class="section-number selfRef">7.5.1. </a><a href="#name-http-status-codes" class="section-name selfRef">HTTP Status Codes</a>
          </h4>
<p id="section-7.5.1-1">MTAs <span class="bcp14">SHOULD</span> interpret HTTP status codes as follows:<a href="#section-7.5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.5.1-2.1">
              <p id="section-7.5.1-2.1.1">2xx: Request successful. Process response body.<a href="#section-7.5.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.1-2.2">
              <p id="section-7.5.1-2.2.1">4xx: Client error. Do not retry; log error and proceed with default action.<a href="#section-7.5.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.1-2.3">
              <p id="section-7.5.1-2.3.1">5xx: Server error. May retry according to policy.<a href="#section-7.5.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="timeout-handling">
<section id="section-7.5.2">
          <h4 id="name-timeout-handling">
<a href="#section-7.5.2" class="section-number selfRef">7.5.2. </a><a href="#name-timeout-handling" class="section-name selfRef">Timeout Handling</a>
          </h4>
<p id="section-7.5.2-1">If a scanner does not respond within the configured timeout, the MTA <span class="bcp14">SHOULD</span> proceed with the default action. Timeout handling policy (fail-open vs. fail-closed) is implementation-defined and <span class="bcp14">SHOULD</span> be configurable.<a href="#section-7.5.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retry-policy">
<section id="section-7.5.3">
          <h4 id="name-retry-policy">
<a href="#section-7.5.3" class="section-number selfRef">7.5.3. </a><a href="#name-retry-policy" class="section-name selfRef">Retry Policy</a>
          </h4>
<p id="section-7.5.3-1">For transient errors (5xx status codes, network failures, timeouts), implementations <span class="bcp14">SHOULD</span> implement retry with exponential backoff. A recommended policy is:<a href="#section-7.5.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.5.3-2.1">
              <p id="section-7.5.3-2.1.1">Maximum 3 retry attempts<a href="#section-7.5.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.3-2.2">
              <p id="section-7.5.3-2.2.1">Initial delay: 100 milliseconds<a href="#section-7.5.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.3-2.3">
              <p id="section-7.5.3-2.3.1">Backoff multiplier: 2<a href="#section-7.5.3-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.3-2.4">
              <p id="section-7.5.3-2.4.1">Maximum delay: 5 seconds<a href="#section-7.5.3-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-7.5.3-2.5">
              <p id="section-7.5.3-2.5.1">Add random jitter of 0-100 milliseconds<a href="#section-7.5.3-2.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-7.5.3-3">Implementations <span class="bcp14">MAY</span> provide configuration options to adjust retry parameters.<a href="#section-7.5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="connection-management">
<section id="section-7.6">
        <h3 id="name-connection-management">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-connection-management" class="section-name selfRef">Connection Management</a>
        </h3>
<p id="section-7.6-1">Implementations <span class="bcp14">SHOULD</span> use connection pooling to reduce latency for repeated requests to the same scanner endpoint. HTTP/2 multiplexing, where available, reduces the need for multiple connections.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<p id="section-7.6-2">Implementations <span class="bcp14">SHOULD</span> respect HTTP keep-alive semantics and connection limits advertised by scanners.<a href="#section-7.6-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implementation-considerations">
<section id="section-8">
      <h2 id="name-implementation-consideratio">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
      </h2>
<div id="mta-considerations">
<section id="section-8.1">
        <h3 id="name-mta-considerations">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-mta-considerations" class="section-name selfRef">MTA Considerations</a>
        </h3>
<div id="multiple-scanner-handling-1">
<section id="section-8.1.1">
          <h4 id="name-multiple-scanner-handling-2">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-multiple-scanner-handling-2" class="section-name selfRef">Multiple Scanner Handling</a>
          </h4>
<p id="section-8.1.1-1">When multiple scanners are registered for the same stage, the MTA invokes them sequentially in an implementation-defined order. Each scanner's response affects the request seen by subsequent scanners.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">Implementations <span class="bcp14">SHOULD</span> provide configuration options for:<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.1-3.1">
              <p id="section-8.1.1-3.1.1">Scanner invocation order (priority-based or explicit ordering)<a href="#section-8.1.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.1.1-3.2">
              <p id="section-8.1.1-3.2.1">Conflict resolution when scanners return conflicting actions<a href="#section-8.1.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.1.1-3.3">
              <p id="section-8.1.1-3.3.1">Short-circuit behavior (whether to skip remaining scanners after certain actions)<a href="#section-8.1.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="unavailable-scanners">
<section id="section-8.1.2">
          <h4 id="name-unavailable-scanners">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-unavailable-scanners" class="section-name selfRef">Unavailable Scanners</a>
          </h4>
<p id="section-8.1.2-1">When a scanner becomes unavailable (timeouts, errors, deregistration), the MTA must determine how to proceed. Common policies include:<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.2-2.1">
              <p id="section-8.1.2-2.1.1">Fail-open: Proceed with default action as if scanner approved<a href="#section-8.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.1.2-2.2">
              <p id="section-8.1.2-2.2.1">Fail-closed: Reject or defer message processing<a href="#section-8.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-8.1.2-3">The appropriate policy depends on deployment requirements. Security-focused deployments may prefer fail-closed, while availability-focused deployments may prefer fail-open. Implementations <span class="bcp14">SHOULD</span> make this policy configurable.<a href="#section-8.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="performance-considerations">
<section id="section-8.1.3">
          <h4 id="name-performance-considerations">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance Considerations</a>
          </h4>
<p id="section-8.1.3-1">Synchronous hook invocation adds latency to mail processing. Implementations <span class="bcp14">SHOULD</span> consider:<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.3-2.1">
              <p id="section-8.1.3-2.1.1">Connection pooling and keep-alive for scanner connections<a href="#section-8.1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.1.3-2.2">
              <p id="section-8.1.3-2.2.1">Parallel invocation of independent scanners where ordering is not required<a href="#section-8.1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.1.3-2.3">
              <p id="section-8.1.3-2.3.1">Timeout tuning based on scanner response time characteristics<a href="#section-8.1.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="scanner-considerations">
<section id="section-8.2">
        <h3 id="name-scanner-considerations">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-scanner-considerations" class="section-name selfRef">Scanner Considerations</a>
        </h3>
<div id="idempotency">
<section id="section-8.2.1">
          <h4 id="name-idempotency">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-idempotency" class="section-name selfRef">Idempotency</a>
          </h4>
<p id="section-8.2.1-1">Scanners <span class="bcp14">SHOULD</span> design their processing to be idempotent. Network issues or MTA retries may result in duplicate invocations for the same message. Scanners <span class="bcp14">SHOULD</span> handle duplicate requests gracefully.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="response-time">
<section id="section-8.2.2">
          <h4 id="name-response-time">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-response-time" class="section-name selfRef">Response Time</a>
          </h4>
<p id="section-8.2.2-1">Scanners operate in the critical path of mail delivery. Long response times delay message processing and may cause timeouts. Scanners <span class="bcp14">SHOULD</span>:<a href="#section-8.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.2-2.1">
              <p id="section-8.2.2-2.1.1">Process requests promptly<a href="#section-8.2.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.2-2.2">
              <p id="section-8.2.2-2.2.1">Implement internal timeouts shorter than MTA timeouts<a href="#section-8.2.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.2-2.3">
              <p id="section-8.2.2-2.3.1">Consider asynchronous processing for expensive operations<a href="#section-8.2.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.2.2-2.4">
              <p id="section-8.2.2-2.4.1">Return default responses when processing cannot complete in time<a href="#section-8.2.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="stateless-design">
<section id="section-8.2.3">
          <h4 id="name-stateless-design">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-stateless-design" class="section-name selfRef">Stateless Design</a>
          </h4>
<p id="section-8.2.3-1">Scanners <span class="bcp14">SHOULD</span> avoid relying on state from previous invocations. Each hook request contains complete context for processing decisions. Stateless design improves reliability and simplifies horizontal scaling.<a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="large-message-handling">
<section id="section-8.3">
        <h3 id="name-large-message-handling">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-large-message-handling" class="section-name selfRef">Large Message Handling</a>
        </h3>
<p id="section-8.3-1">Large messages present challenges for both MTAs and scanners. Implementations <span class="bcp14">SHOULD</span> consider:<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3-2.1">
            <p id="section-8.3-2.1.1">Message size limits advertised in discovery documents<a href="#section-8.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.3-2.2">
            <p id="section-8.3-2.2.1">Truncation policies for oversized messages<a href="#section-8.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-8.3-2.3">
            <p id="section-8.3-2.3.1">Memory management for large message bodies<a href="#section-8.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.3-3">Streaming or chunked delivery is not currently specified. For very large messages, implementations <span class="bcp14">MAY</span> arrange out-of-band content retrieval, though this is outside the scope of this specification.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="high-availability">
<section id="section-8.4">
        <h3 id="name-high-availability">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-high-availability" class="section-name selfRef">High Availability</a>
        </h3>
<div id="scanner-high-availability">
<section id="section-8.4.1">
          <h4 id="name-scanner-high-availability">
<a href="#section-8.4.1" class="section-number selfRef">8.4.1. </a><a href="#name-scanner-high-availability" class="section-name selfRef">Scanner High Availability</a>
          </h4>
<p id="section-8.4.1-1">For production deployments, scanners <span class="bcp14">SHOULD</span> be deployed with redundancy. Approaches include:<a href="#section-8.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.4.1-2.1">
              <p id="section-8.4.1-2.1.1">Multiple scanner instances behind a load balancer<a href="#section-8.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.4.1-2.2">
              <p id="section-8.4.1-2.2.1">Health checking with automatic failover<a href="#section-8.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-8.4.1-2.3">
              <p id="section-8.4.1-2.3.1">Geographic distribution for disaster recovery<a href="#section-8.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-8.4.1-3">The MTA registers a single callback URL; load balancing occurs at the network layer.<a href="#section-8.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration-state">
<section id="section-8.4.2">
          <h4 id="name-registration-state">
<a href="#section-8.4.2" class="section-number selfRef">8.4.2. </a><a href="#name-registration-state" class="section-name selfRef">Registration State</a>
          </h4>
<p id="section-8.4.2-1">Registration state resides at the MTA. Scanner instances <span class="bcp14">SHOULD NOT</span> assume persistent local state. If scanner instances share a registration, they <span class="bcp14">MUST</span> coordinate to avoid conflicting operations (such as simultaneous deregistration).<a href="#section-8.4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="authentication-and-authorization">
<section id="section-9.1">
        <h3 id="name-authentication-and-authoriz">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-authentication-and-authoriz" class="section-name selfRef">Authentication and Authorization</a>
        </h3>
<p id="section-9.1-1">Authentication of registration requests is critical to prevent unauthorized scanners from receiving email content. Implementations <span class="bcp14">MUST</span> require authentication for registration operations.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Recommended authentication approaches:<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-3.1">
            <p id="section-9.1-3.1.1">Bearer tokens: Simple to implement; tokens should be generated with sufficient entropy and rotated periodically.<a href="#section-9.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-3.2">
            <p id="section-9.1-3.2.1">Mutual TLS: Provides strong authentication and binds identity to transport security.<a href="#section-9.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.1-3.3">
            <p id="section-9.1-3.3.1">HMAC signatures: Allows authentication without transmitting secrets; requires secure key distribution.<a href="#section-9.1-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.1-4">Authorization policies <span class="bcp14">SHOULD</span> restrict which scanners may register and what capabilities they may request. Policies may be based on scanner identity, requested stages, or other criteria.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transport-security">
<section id="section-9.2">
        <h3 id="name-transport-security">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-transport-security" class="section-name selfRef">Transport Security</a>
        </h3>
<p id="section-9.2-1">All MTA Hooks communications <span class="bcp14">MUST</span> use TLS to protect message content and authentication credentials in transit. Implementations <span class="bcp14">MUST</span> validate certificates to prevent man-in-the-middle attacks.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">For internal network deployments, administrators may choose to use private certificate authorities. However, disabling certificate validation is <span class="bcp14">NOT RECOMMENDED</span> even for internal communications.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-confidentiality">
<section id="section-9.3">
        <h3 id="name-message-confidentiality">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-message-confidentiality" class="section-name selfRef">Message Confidentiality</a>
        </h3>
<p id="section-9.3-1">Email messages frequently contain sensitive personal or business information. Scanners necessarily receive access to message content to perform their functions. Deployments <span class="bcp14">SHOULD</span> consider:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.3-2.1">
            <p id="section-9.3-2.1.1">Data handling policies for scanner operators<a href="#section-9.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-2.2">
            <p id="section-9.3-2.2.1">Logging policies that avoid recording message content<a href="#section-9.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-2.3">
            <p id="section-9.3-2.3.1">Data retention limits at scanner endpoints<a href="#section-9.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.3-2.4">
            <p id="section-9.3-2.4.1">Regulatory requirements such as GDPR for personal data processing<a href="#section-9.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="denial-of-service">
<section id="section-9.4">
        <h3 id="name-denial-of-service">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial of Service</a>
        </h3>
<div id="registration-attacks">
<section id="section-9.4.1">
          <h4 id="name-registration-attacks">
<a href="#section-9.4.1" class="section-number selfRef">9.4.1. </a><a href="#name-registration-attacks" class="section-name selfRef">Registration Attacks</a>
          </h4>
<p id="section-9.4.1-1">Attackers may attempt to exhaust MTA resources through excessive registration requests. Implementations <span class="bcp14">SHOULD</span>:<a href="#section-9.4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.4.1-2.1">
              <p id="section-9.4.1-2.1.1">Rate limit registration attempts per source<a href="#section-9.4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.1-2.2">
              <p id="section-9.4.1-2.2.1">Limit maximum concurrent registrations<a href="#section-9.4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.1-2.3">
              <p id="section-9.4.1-2.3.1">Require authentication before processing registrations<a href="#section-9.4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.1-2.4">
              <p id="section-9.4.1-2.4.1">Validate callback URLs before completing registration<a href="#section-9.4.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="scanner-resource-exhaustion">
<section id="section-9.4.2">
          <h4 id="name-scanner-resource-exhaustion">
<a href="#section-9.4.2" class="section-number selfRef">9.4.2. </a><a href="#name-scanner-resource-exhaustion" class="section-name selfRef">Scanner Resource Exhaustion</a>
          </h4>
<p id="section-9.4.2-1">Malicious or misconfigured MTAs could overwhelm scanners with requests. Scanners <span class="bcp14">SHOULD</span>:<a href="#section-9.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.4.2-2.1">
              <p id="section-9.4.2-2.1.1">Implement rate limiting<a href="#section-9.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.2-2.2">
              <p id="section-9.4.2-2.2.1">Set appropriate resource limits<a href="#section-9.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.2-2.3">
              <p id="section-9.4.2-2.3.1">Monitor for unusual request patterns<a href="#section-9.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="slow-scanner-attacks">
<section id="section-9.4.3">
          <h4 id="name-slow-scanner-attacks">
<a href="#section-9.4.3" class="section-number selfRef">9.4.3. </a><a href="#name-slow-scanner-attacks" class="section-name selfRef">Slow Scanner Attacks</a>
          </h4>
<p id="section-9.4.3-1">Slow responses from scanners can exhaust MTA resources (connection limits, memory). MTAs <span class="bcp14">SHOULD</span>:<a href="#section-9.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.4.3-2.1">
              <p id="section-9.4.3-2.1.1">Enforce strict timeouts<a href="#section-9.4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.3-2.2">
              <p id="section-9.4.3-2.2.1">Limit concurrent requests to any single scanner<a href="#section-9.4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-9.4.3-2.3">
              <p id="section-9.4.3-2.3.1">Implement circuit breaker patterns for repeatedly slow scanners<a href="#section-9.4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="injection-attacks">
<section id="section-9.5">
        <h3 id="name-injection-attacks">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-injection-attacks" class="section-name selfRef">Injection Attacks</a>
        </h3>
<p id="section-9.5-1">Scanner responses contain modifications applied to message processing. Implementations <span class="bcp14">MUST</span> validate all scanner-provided data:<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5-2.1">
            <p id="section-9.5-2.1.1">Header values <span class="bcp14">MUST</span> be validated to prevent header injection<a href="#section-9.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.5-2.2">
            <p id="section-9.5-2.2.1">Recipient addresses <span class="bcp14">MUST</span> be validated against policy<a href="#section-9.5-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.5-2.3">
            <p id="section-9.5-2.3.1">Body modifications <span class="bcp14">MUST</span> not introduce malformed content<a href="#section-9.5-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9.6">
        <h3 id="name-privacy-considerations">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
        </h3>
<p id="section-9.6-1">Email processing inherently involves access to personal communications. Implementations <span class="bcp14">SHOULD</span> minimize data exposure:<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.6-2.1">
            <p id="section-9.6-2.1.1">Scanners <span class="bcp14">SHOULD</span> request only necessary properties<a href="#section-9.6-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.2">
            <p id="section-9.6-2.2.1">MTAs <span class="bcp14">SHOULD</span> honor property restrictions from capability negotiation<a href="#section-9.6-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.3">
            <p id="section-9.6-2.3.1">Logging <span class="bcp14">SHOULD</span> avoid recording message content or metadata<a href="#section-9.6-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.6-2.4">
            <p id="section-9.6-2.4.1">Scanner operators <span class="bcp14">SHOULD</span> implement appropriate data protection measures<a href="#section-9.6-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="well-known-uri-registration">
<section id="section-10.1">
        <h3 id="name-well-known-uri-registration">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-well-known-uri-registration" class="section-name selfRef">Well-Known URI Registration</a>
        </h3>
<p id="section-10.1-1">This document registers the following well-known URI per <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>:<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">URI suffix: mta-hooks<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">Change controller: IETF<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">Specification document: This document<a href="#section-10.1-4" class="pilcrow">¶</a></p>
<p id="section-10.1-5">Status: permanent<a href="#section-10.1-5" class="pilcrow">¶</a></p>
<p id="section-10.1-6">Related information: N/A<a href="#section-10.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-serialization-format-registry">
<section id="section-10.2">
        <h3 id="name-mta-hooks-serialization-for">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-mta-hooks-serialization-for" class="section-name selfRef">MTA Hooks Serialization Format Registry</a>
        </h3>
<p id="section-10.2-1">IANA is requested to create a new registry entitled "MTA Hooks Serialization Formats" with the following initial contents:<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.2-2.1">
            <p id="section-10.2-2.1.1">Format: json<a href="#section-10.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.2-2.1.2.1">
                <p id="section-10.2-2.1.2.1.1">Description: JSON serialization per RFC 8259<a href="#section-10.2-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.2-2.1.2.2">
                <p id="section-10.2-2.1.2.2.1">Reference: This document<a href="#section-10.2-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.2-2.2">
            <p id="section-10.2-2.2.1">Format: cbor<a href="#section-10.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.2-2.2.2.1">
                <p id="section-10.2-2.2.2.1.1">Description: CBOR serialization per RFC 8949<a href="#section-10.2-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.2-2.2.2.2">
                <p id="section-10.2-2.2.2.2.1">Reference: This document<a href="#section-10.2-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.2-3">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-inbound-action-registry">
<section id="section-10.3">
        <h3 id="name-mta-hooks-inbound-action-re">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-mta-hooks-inbound-action-re" class="section-name selfRef">MTA Hooks Inbound Action Registry</a>
        </h3>
<p id="section-10.3-1">IANA is requested to create a new registry entitled "MTA Hooks Inbound Actions" with the following initial contents:<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.1">
            <p id="section-10.3-2.1.1">Action: accept<a href="#section-10.3-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.1.2.1">
                <p id="section-10.3-2.1.2.1.1">Description: Accept message for delivery<a href="#section-10.3-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.3-2.1.2.2">
                <p id="section-10.3-2.1.2.2.1">Reference: This document<a href="#section-10.3-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.3-2.2">
            <p id="section-10.3-2.2.1">Action: reject<a href="#section-10.3-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.2.2.1">
                <p id="section-10.3-2.2.2.1.1">Description: Reject message with error response<a href="#section-10.3-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.3-2.2.2.2">
                <p id="section-10.3-2.2.2.2.1">Reference: This document<a href="#section-10.3-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.3-2.3">
            <p id="section-10.3-2.3.1">Action: discard<a href="#section-10.3-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.3.2.1">
                <p id="section-10.3-2.3.2.1.1">Description: Accept but do not deliver message<a href="#section-10.3-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.3-2.3.2.2">
                <p id="section-10.3-2.3.2.2.1">Reference: This document<a href="#section-10.3-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.3-2.4">
            <p id="section-10.3-2.4.1">Action: quarantine<a href="#section-10.3-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.4.2.1">
                <p id="section-10.3-2.4.2.1.1">Description: Place message in quarantine<a href="#section-10.3-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.3-2.4.2.2">
                <p id="section-10.3-2.4.2.2.1">Reference: This document<a href="#section-10.3-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.3-2.5">
            <p id="section-10.3-2.5.1">Action: disconnect<a href="#section-10.3-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.5.2.1">
                <p id="section-10.3-2.5.2.1.1">Description: Terminate SMTP connection<a href="#section-10.3-2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.3-2.5.2.2">
                <p id="section-10.3-2.5.2.2.1">Reference: This document<a href="#section-10.3-2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.3-3">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-outbound-action-registry">
<section id="section-10.4">
        <h3 id="name-mta-hooks-outbound-action-r">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-mta-hooks-outbound-action-r" class="section-name selfRef">MTA Hooks Outbound Action Registry</a>
        </h3>
<p id="section-10.4-1">IANA is requested to create a new registry entitled "MTA Hooks Outbound Actions" with the following initial contents:<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.4-2.1">
            <p id="section-10.4-2.1.1">Action: continue<a href="#section-10.4-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.4-2.1.2.1">
                <p id="section-10.4-2.1.2.1.1">Description: Proceed with normal delivery processing<a href="#section-10.4-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.4-2.1.2.2">
                <p id="section-10.4-2.1.2.2.1">Reference: This document<a href="#section-10.4-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.4-2.2">
            <p id="section-10.4-2.2.1">Action: cancel<a href="#section-10.4-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.4-2.2.2.1">
                <p id="section-10.4-2.2.2.1.1">Description: Cancel pending deliveries<a href="#section-10.4-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.4-2.2.2.2">
                <p id="section-10.4-2.2.2.2.1">Reference: This document<a href="#section-10.4-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.4-3">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-inbound-stage-registry">
<section id="section-10.5">
        <h3 id="name-mta-hooks-inbound-stage-reg">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-mta-hooks-inbound-stage-reg" class="section-name selfRef">MTA Hooks Inbound Stage Registry</a>
        </h3>
<p id="section-10.5-1">IANA is requested to create a new registry entitled "MTA Hooks Inbound Stages" with the following initial contents:<a href="#section-10.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.1">
            <p id="section-10.5-2.1.1">Stage: connect<a href="#section-10.5-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.1.2.1">
                <p id="section-10.5-2.1.2.1.1">Description: Client connection established<a href="#section-10.5-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.5-2.1.2.2">
                <p id="section-10.5-2.1.2.2.1">Reference: This document<a href="#section-10.5-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.5-2.2">
            <p id="section-10.5-2.2.1">Stage: ehlo<a href="#section-10.5-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.2.2.1">
                <p id="section-10.5-2.2.2.1.1">Description: EHLO/HELO command received<a href="#section-10.5-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.5-2.2.2.2">
                <p id="section-10.5-2.2.2.2.1">Reference: This document<a href="#section-10.5-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.5-2.3">
            <p id="section-10.5-2.3.1">Stage: mail<a href="#section-10.5-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.3.2.1">
                <p id="section-10.5-2.3.2.1.1">Description: MAIL FROM command received<a href="#section-10.5-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.5-2.3.2.2">
                <p id="section-10.5-2.3.2.2.1">Reference: This document<a href="#section-10.5-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.5-2.4">
            <p id="section-10.5-2.4.1">Stage: rcpt<a href="#section-10.5-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.4.2.1">
                <p id="section-10.5-2.4.2.1.1">Description: RCPT TO command received<a href="#section-10.5-2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.5-2.4.2.2">
                <p id="section-10.5-2.4.2.2.1">Reference: This document<a href="#section-10.5-2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.5-2.5">
            <p id="section-10.5-2.5.1">Stage: data<a href="#section-10.5-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.5-2.5.2.1">
                <p id="section-10.5-2.5.2.1.1">Description: Message content received<a href="#section-10.5-2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.5-2.5.2.2">
                <p id="section-10.5-2.5.2.2.1">Reference: This document<a href="#section-10.5-2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.5-3">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-outbound-stage-registry">
<section id="section-10.6">
        <h3 id="name-mta-hooks-outbound-stage-re">
<a href="#section-10.6" class="section-number selfRef">10.6. </a><a href="#name-mta-hooks-outbound-stage-re" class="section-name selfRef">MTA Hooks Outbound Stage Registry</a>
        </h3>
<p id="section-10.6-1">IANA is requested to create a new registry entitled "MTA Hooks Outbound Stages" with the following initial contents:<a href="#section-10.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.6-2.1">
            <p id="section-10.6-2.1.1">Stage: delivery<a href="#section-10.6-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.6-2.1.2.1">
                <p id="section-10.6-2.1.2.1.1">Description: Delivery attempt completed<a href="#section-10.6-2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.6-2.1.2.2">
                <p id="section-10.6-2.1.2.2.1">Reference: This document<a href="#section-10.6-2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.6-2.2">
            <p id="section-10.6-2.2.1">Stage: defer<a href="#section-10.6-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.6-2.2.2.1">
                <p id="section-10.6-2.2.2.1.1">Description: Delivery deferred for retry<a href="#section-10.6-2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.6-2.2.2.2">
                <p id="section-10.6-2.2.2.2.1">Reference: This document<a href="#section-10.6-2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="normal" id="section-10.6-2.3">
            <p id="section-10.6-2.3.1">Stage: dsn<a href="#section-10.6-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.6-2.3.2.1">
                <p id="section-10.6-2.3.2.1.1">Description: DSN generation pending<a href="#section-10.6-2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-10.6-2.3.2.2">
                <p id="section-10.6-2.3.2.2.1">Reference: This document<a href="#section-10.6-2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
        </ul>
<p id="section-10.6-3">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.6-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mta-hooks-error-code-registry">
<section id="section-10.7">
        <h3 id="name-mta-hooks-error-code-regist">
<a href="#section-10.7" class="section-number selfRef">10.7. </a><a href="#name-mta-hooks-error-code-regist" class="section-name selfRef">MTA Hooks Error Code Registry</a>
        </h3>
<p id="section-10.7-1">IANA is requested to create a new registry entitled "MTA Hooks Error Codes" with the initial contents specified in <a href="#error-codes" class="auto internal xref">Appendix A</a>.<a href="#section-10.7-1" class="pilcrow">¶</a></p>
<p id="section-10.7-2">New registrations require Specification Required per <span>[<a href="#RFC8126" class="cite xref">RFC8126</a>]</span>.<a href="#section-10.7-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3339">[RFC3339]</dt>
        <dd>
<span class="refAuthor">Klyne, G.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"Date and Time on the Internet: Timestamps"</span>, <span class="seriesInfo">RFC 3339</span>, <span class="seriesInfo">DOI 10.17487/RFC3339</span>, <time datetime="2002-07" class="refDate">July 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3339">https://www.rfc-editor.org/rfc/rfc3339</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5246">[RFC5246]</dt>
        <dd>
<span class="refAuthor">Dierks, T.</span> and <span class="refAuthor">E. Rescorla</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.2"</span>, <span class="seriesInfo">RFC 5246</span>, <span class="seriesInfo">DOI 10.17487/RFC5246</span>, <time datetime="2008-08" class="refDate">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5246">https://www.rfc-editor.org/rfc/rfc5246</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5321">[RFC5321]</dt>
        <dd>
<span class="refAuthor">Klensin, J.</span>, <span class="refTitle">"Simple Mail Transfer Protocol"</span>, <span class="seriesInfo">RFC 5321</span>, <span class="seriesInfo">DOI 10.17487/RFC5321</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5321">https://www.rfc-editor.org/rfc/rfc5321</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5322">[RFC5322]</dt>
        <dd>
<span class="refAuthor">Resnick, P., Ed.</span>, <span class="refTitle">"Internet Message Format"</span>, <span class="seriesInfo">RFC 5322</span>, <span class="seriesInfo">DOI 10.17487/RFC5322</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5322">https://www.rfc-editor.org/rfc/rfc5322</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6901">[RFC6901]</dt>
        <dd>
<span class="refAuthor">Bryan, P., Ed.</span>, <span class="refAuthor">Zyp, K.</span>, and <span class="refAuthor">M. Nottingham, Ed.</span>, <span class="refTitle">"JavaScript Object Notation (JSON) Pointer"</span>, <span class="seriesInfo">RFC 6901</span>, <span class="seriesInfo">DOI 10.17487/RFC6901</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6901">https://www.rfc-editor.org/rfc/rfc6901</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span>, <span class="refAuthor">Leiba, B.</span>, and <span class="refAuthor">T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8126">https://www.rfc-editor.org/rfc/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8259">[RFC8259]</dt>
        <dd>
<span class="refAuthor">Bray, T., Ed.</span>, <span class="refTitle">"The JavaScript Object Notation (JSON) Data Interchange Format"</span>, <span class="seriesInfo">STD 90</span>, <span class="seriesInfo">RFC 8259</span>, <span class="seriesInfo">DOI 10.17487/RFC8259</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8259">https://www.rfc-editor.org/rfc/rfc8259</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8615">[RFC8615]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8615">https://www.rfc-editor.org/rfc/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8620">[RFC8620]</dt>
        <dd>
<span class="refAuthor">Jenkins, N.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"The JSON Meta Application Protocol (JMAP)"</span>, <span class="seriesInfo">RFC 8620</span>, <span class="seriesInfo">DOI 10.17487/RFC8620</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8620">https://www.rfc-editor.org/rfc/rfc8620</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8621">[RFC8621]</dt>
        <dd>
<span class="refAuthor">Jenkins, N.</span> and <span class="refAuthor">C. Newman</span>, <span class="refTitle">"The JSON Meta Application Protocol (JMAP) for Mail"</span>, <span class="seriesInfo">RFC 8621</span>, <span class="seriesInfo">DOI 10.17487/RFC8621</span>, <time datetime="2019-08" class="refDate">August 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8621">https://www.rfc-editor.org/rfc/rfc8621</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9112">[RFC9112]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9112">https://www.rfc-editor.org/rfc/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9113">[RFC9113]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9113">https://www.rfc-editor.org/rfc/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9114">[RFC9114]</dt>
      <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC3461">[RFC3461]</dt>
        <dd>
<span class="refAuthor">Moore, K.</span>, <span class="refTitle">"Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)"</span>, <span class="seriesInfo">RFC 3461</span>, <span class="seriesInfo">DOI 10.17487/RFC3461</span>, <time datetime="2003-01" class="refDate">January 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3461">https://www.rfc-editor.org/rfc/rfc3461</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6376">[RFC6376]</dt>
        <dd>
<span class="refAuthor">Crocker, D., Ed.</span>, <span class="refAuthor">Hansen, T., Ed.</span>, and <span class="refAuthor">M. Kucherawy, Ed.</span>, <span class="refTitle">"DomainKeys Identified Mail (DKIM) Signatures"</span>, <span class="seriesInfo">STD 76</span>, <span class="seriesInfo">RFC 6376</span>, <span class="seriesInfo">DOI 10.17487/RFC6376</span>, <time datetime="2011-09" class="refDate">September 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6376">https://www.rfc-editor.org/rfc/rfc6376</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7208">[RFC7208]</dt>
        <dd>
<span class="refAuthor">Kitterman, S.</span>, <span class="refTitle">"Sender Policy Framework (SPF) for Authorizing Use of Domains in Email, Version 1"</span>, <span class="seriesInfo">RFC 7208</span>, <span class="seriesInfo">DOI 10.17487/RFC7208</span>, <time datetime="2014-04" class="refDate">April 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7208">https://www.rfc-editor.org/rfc/rfc7208</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7489">[RFC7489]</dt>
      <dd>
<span class="refAuthor">Kucherawy, M., Ed.</span> and <span class="refAuthor">E. Zwicky, Ed.</span>, <span class="refTitle">"Domain-based Message Authentication, Reporting, and Conformance (DMARC)"</span>, <span class="seriesInfo">RFC 7489</span>, <span class="seriesInfo">DOI 10.17487/RFC7489</span>, <time datetime="2015-03" class="refDate">March 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7489">https://www.rfc-editor.org/rfc/rfc7489</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="error-codes">
<section id="appendix-A">
      <h2 id="name-error-codes">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-error-codes" class="section-name selfRef">Error Codes</a>
      </h2>
<p id="appendix-A-1">This appendix defines error codes used in MTA Hooks error responses.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="error-response-structure">
<section id="appendix-A.1">
        <h3 id="name-error-response-structure">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-error-response-structure" class="section-name selfRef">Error Response Structure</a>
        </h3>
<p id="appendix-A.1-1">Error responses use the following structure:<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="appendix-A.1-2">
<pre>
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error description"
  }
}
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="http-400-bad-request">
<section id="appendix-A.2">
        <h3 id="name-http-400-bad-request">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-http-400-bad-request" class="section-name selfRef">HTTP 400 Bad Request</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.2-1.1">
            <p id="appendix-A.2-1.1.1">INVALID_REQUEST: Malformed JSON/CBOR or missing required fields.<a href="#appendix-A.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.2">
            <p id="appendix-A.2-1.2.1">INVALID_CALLBACK_URL: Callback URL is malformed or uses disallowed scheme.<a href="#appendix-A.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.3">
            <p id="appendix-A.2-1.3.1">CAPABILITY_MISMATCH: Requested capability not supported by MTA.<a href="#appendix-A.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.4">
            <p id="appendix-A.2-1.4.1">INVALID_STAGE: One or more requested stages are not valid.<a href="#appendix-A.2-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.5">
            <p id="appendix-A.2-1.5.1">INVALID_ACTION: One or more requested actions are not valid.<a href="#appendix-A.2-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.6">
            <p id="appendix-A.2-1.6.1">INVALID_MODIFICATION: One or more requested modifications are not valid.<a href="#appendix-A.2-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.7">
            <p id="appendix-A.2-1.7.1">NO_STAGES_REQUESTED: Neither inbound nor outbound stages were specified.<a href="#appendix-A.2-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-1.8">
            <p id="appendix-A.2-1.8.1">FILTER_INVALID: Filter configuration is syntactically invalid.<a href="#appendix-A.2-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-401-unauthorized">
<section id="appendix-A.3">
        <h3 id="name-http-401-unauthorized">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-http-401-unauthorized" class="section-name selfRef">HTTP 401 Unauthorized</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.3-1.1">
            <p id="appendix-A.3-1.1.1">AUTHENTICATION_REQUIRED: No authentication credentials provided.<a href="#appendix-A.3-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.3-1.2">
            <p id="appendix-A.3-1.2.1">INVALID_CREDENTIALS: Provided credentials are invalid or expired.<a href="#appendix-A.3-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-403-forbidden">
<section id="appendix-A.4">
        <h3 id="name-http-403-forbidden">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-http-403-forbidden" class="section-name selfRef">HTTP 403 Forbidden</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.4-1.1">
            <p id="appendix-A.4-1.1.1">REGISTRATION_DENIED: Valid credentials but not authorized to register.<a href="#appendix-A.4-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.2">
            <p id="appendix-A.4-1.2.1">DOMAIN_NOT_ALLOWED: Scanner not authorized for requested domains.<a href="#appendix-A.4-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-1.3">
            <p id="appendix-A.4-1.3.1">CALLBACK_NOT_ALLOWED: Callback URL not in allowlist.<a href="#appendix-A.4-1.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-404-not-found">
<section id="appendix-A.5">
        <h3 id="name-http-404-not-found">
<a href="#appendix-A.5" class="section-number selfRef">A.5. </a><a href="#name-http-404-not-found" class="section-name selfRef">HTTP 404 Not Found</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.5-1.1">
            <p id="appendix-A.5-1.1.1">REGISTRATION_NOT_FOUND: No registration exists with the specified ID.<a href="#appendix-A.5-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-409-conflict">
<section id="appendix-A.6">
        <h3 id="name-http-409-conflict">
<a href="#appendix-A.6" class="section-number selfRef">A.6. </a><a href="#name-http-409-conflict" class="section-name selfRef">HTTP 409 Conflict</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.6-1.1">
            <p id="appendix-A.6-1.1.1">ALREADY_REGISTERED: Scanner with same callback URL already registered.<a href="#appendix-A.6-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.6-1.2">
            <p id="appendix-A.6-1.2.1">REGISTRATION_LIMIT_REACHED: Maximum number of registrations exceeded.<a href="#appendix-A.6-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-422-unprocessable-entity">
<section id="appendix-A.7">
        <h3 id="name-http-422-unprocessable-enti">
<a href="#appendix-A.7" class="section-number selfRef">A.7. </a><a href="#name-http-422-unprocessable-enti" class="section-name selfRef">HTTP 422 Unprocessable Entity</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.7-1.1">
            <p id="appendix-A.7-1.1.1">UNSUPPORTED_FILTER: The filter contains conditions that are not supported by this MTA.<a href="#appendix-A.7-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-1.2">
            <p id="appendix-A.7-1.2.1">CALLBACK_UNREACHABLE: MTA could not reach callback URL for verification.<a href="#appendix-A.7-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-1.3">
            <p id="appendix-A.7-1.3.1">CALLBACK_VERIFICATION_FAILED: Callback URL responded but verification failed.<a href="#appendix-A.7-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-1.4">
            <p id="appendix-A.7-1.4.1">TLS_REQUIRED: Callback URL must use HTTPS.<a href="#appendix-A.7-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.7-1.5">
            <p id="appendix-A.7-1.5.1">TLS_CERTIFICATE_INVALID: Callback URL TLS certificate is invalid or untrusted.<a href="#appendix-A.7-1.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-429-too-many-requests">
<section id="appendix-A.8">
        <h3 id="name-http-429-too-many-requests">
<a href="#appendix-A.8" class="section-number selfRef">A.8. </a><a href="#name-http-429-too-many-requests" class="section-name selfRef">HTTP 429 Too Many Requests</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.8-1.1">
            <p id="appendix-A.8-1.1.1">RATE_LIMITED: Too many registration attempts; retry after specified time.<a href="#appendix-A.8-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-500-internal-server-error">
<section id="appendix-A.9">
        <h3 id="name-http-500-internal-server-er">
<a href="#appendix-A.9" class="section-number selfRef">A.9. </a><a href="#name-http-500-internal-server-er" class="section-name selfRef">HTTP 500 Internal Server Error</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.9-1.1">
            <p id="appendix-A.9-1.1.1">INTERNAL_ERROR: Unexpected server error during processing.<a href="#appendix-A.9-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="http-503-service-unavailable">
<section id="appendix-A.10">
        <h3 id="name-http-503-service-unavailabl">
<a href="#appendix-A.10" class="section-number selfRef">A.10. </a><a href="#name-http-503-service-unavailabl" class="section-name selfRef">HTTP 503 Service Unavailable</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-A.10-1.1">
            <p id="appendix-A.10-1.1.1">REGISTRATION_DISABLED: Registration temporarily disabled by administrator.<a href="#appendix-A.10-1.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="complete-example-flows">
<section id="appendix-B">
      <h2 id="name-complete-example-flows">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-complete-example-flows" class="section-name selfRef">Complete Example Flows</a>
      </h2>
<p id="appendix-B-1">This appendix provides complete request and response examples for common scenarios.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="inbound-spam-filtering">
<section id="appendix-B.1">
        <h3 id="name-inbound-spam-filtering">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-inbound-spam-filtering" class="section-name selfRef">Inbound Spam Filtering</a>
        </h3>
<p id="appendix-B.1-1">This example shows a complete flow for spam filtering during inbound message reception.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div id="discovery-1">
<section id="appendix-B.1.1">
          <h4 id="name-discovery-2">
<a href="#appendix-B.1.1" class="section-number selfRef">B.1.1. </a><a href="#name-discovery-2" class="section-name selfRef">Discovery</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.1-1">
<pre>
GET /.well-known/mta-hooks HTTP/1.1
Host: scanner.example.com
Accept: application/json
</pre><a href="#appendix-B.1.1-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.1.1-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "version": "1.0",
  "endpoints": {
    "registration": "/v1/hooks/register",
    "deregistration": "/v1/hooks/register/{registration_id}"
  },
  "serialization": ["json"],
  "capabilities": {
    "inbound": {
      "stages": ["data"],
      "actions": ["accept", "reject", "quarantine"],
      "fetchProperties": ["/message", "/envelope", "/senderAuth",
                          "/client"],
      "updateProperties": ["/message/headers", "/action", "/response"]
    }
  },
  "limits": {
    "maxMessageSize": 26214400,
    "timeoutMs": 30000
  }
}
</pre><a href="#appendix-B.1.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="registration-1">
<section id="appendix-B.1.2">
          <h4 id="name-registration-2">
<a href="#appendix-B.1.2" class="section-number selfRef">B.1.2. </a><a href="#name-registration-2" class="section-name selfRef">Registration</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.2-1">
<pre>
POST /v1/hooks/register HTTP/1.1
Host: scanner.example.com
Content-Type: application/json
Authorization: Bearer sk_live_abc123

{
  "name": "SpamFilter Pro",
  "version": "3.0.1",
  "callback": {
    "url": "https://filter.example.net/hooks/spam",
    "timeoutMs": 20000
  },
  "serialization": "json",
  "inbound": {
    "stages": ["data"],
    "properties": ["/message", "/envelope", "/senderAuth", "/client"]
  },
  "metadata": {
    "customer": "acme-corp"
  }
}
</pre><a href="#appendix-B.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="verification-callback">
<section id="appendix-B.1.3">
          <h4 id="name-verification-callback">
<a href="#appendix-B.1.3" class="section-number selfRef">B.1.3. </a><a href="#name-verification-callback" class="section-name selfRef">Verification Callback</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.3-1">
<pre>
POST /hooks/spam HTTP/1.1
Host: filter.example.net
Content-Type: application/json

{
  "action": "verify",
  "token": "vrf_xyz789"
}
</pre><a href="#appendix-B.1.3-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.1.3-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "token": "vrf_xyz789"
}
</pre><a href="#appendix-B.1.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="registration-response-1">
<section id="appendix-B.1.4">
          <h4 id="name-registration-response-2">
<a href="#appendix-B.1.4" class="section-number selfRef">B.1.4. </a><a href="#name-registration-response-2" class="section-name selfRef">Registration Response</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.4-1">
<pre>
HTTP/1.1 201 Created
Content-Type: application/json
Location: /v1/hooks/register/reg_spam_001

{
  "registrationId": "reg_spam_001",
  "status": "active",
  "createdAt": "2024-12-21T10:00:00Z",
  "expiresAt": "2025-01-21T10:00:00Z",
  "callback": {
    "url": "https://filter.example.net/hooks/spam",
    "timeoutMs": 20000
  },
  "negotiated": {
    "serialization": "json",
    "inbound": {
      "stages": ["data"],
      "properties": ["/message", "/envelope", "/senderAuth", "/client"]
    }
  },
  "endpoints": {
    "deregistration": "/v1/hooks/register/reg_spam_001",
    "status": "/v1/hooks/register/reg_spam_001/status"
  }
}
</pre><a href="#appendix-B.1.4-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hook-invocation-clean-message">
<section id="appendix-B.1.5">
          <h4 id="name-hook-invocation-clean-messa">
<a href="#appendix-B.1.5" class="section-number selfRef">B.1.5. </a><a href="#name-hook-invocation-clean-messa" class="section-name selfRef">Hook Invocation - Clean Message</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.5-1">
<pre>
POST /hooks/spam HTTP/1.1
Host: filter.example.net
Content-Type: application/json
X-MTA-Hooks-Registration: reg_spam_001

{
  "stage": "data",
  "action": "accept",
  "timestamp": "2024-12-21T10:30:00Z",
  "response": {
    "code": 250,
    "enhancedCode": "2.0.0",
    "message": "OK"
  },
  "envelope": {
    "from": {"address": "alice@sender.example", "parameters": {}},
    "to": [{"address": "bob@recipient.example", "parameters": {}}]
  },
  "message": {
    "subject": "Quarterly Report",
    "from": [{"email": "alice@sender.example", "name": "Alice Smith"}],
    "to": [{"email": "bob@recipient.example"}],
    "size": 15360,
    "bodyValues": {
      "1": {
        "value": "Please find attached the Q4 report...",
        "isEncodingProblem": false,
        "isTruncated": false
      }
    }
  },
  "senderAuth": {
    "spf-mail": "pass",
    "dkim": "pass",
    "dmarc": "pass"
  },
  "client": {
    "ip": "192.0.2.50",
    "ehlo": "mail.sender.example"
  }
}
</pre><a href="#appendix-B.1.5-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.1.5-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "add": [
    {
      "path": "/message/headers",
      "value": {"name": "X-Spam-Status", "value": "No, score=0.5"},
      "index": 0
    }
  ]
}
</pre><a href="#appendix-B.1.5-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hook-invocation-spam-detected">
<section id="appendix-B.1.6">
          <h4 id="name-hook-invocation-spam-detect">
<a href="#appendix-B.1.6" class="section-number selfRef">B.1.6. </a><a href="#name-hook-invocation-spam-detect" class="section-name selfRef">Hook Invocation - Spam Detected</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.1.6-1">
<pre>
POST /hooks/spam HTTP/1.1
Host: filter.example.net
Content-Type: application/json
X-MTA-Hooks-Registration: reg_spam_001

{
  "stage": "data",
  "action": "accept",
  "timestamp": "2024-12-21T10:35:00Z",
  "response": {
    "code": 250,
    "enhancedCode": "2.0.0",
    "message": "OK"
  },
  "envelope": {
    "from": {"address": "promo@spammer.invalid", "parameters": {}},
    "to": [{"address": "bob@recipient.example", "parameters": {}}]
  },
  "message": {
    "subject": "YOU HAVE WON $1,000,000!!!",
    "from": [{"email": "winner@lottery.invalid"}],
    "to": [{"email": "bob@recipient.example"}],
    "size": 8192
  },
  "senderAuth": {
    "spf-mail": "fail",
    "dkim": "none",
    "dmarc": "fail"
  },
  "client": {
    "ip": "203.0.113.99",
    "ehlo": "totally-legit.invalid"
  }
}
</pre><a href="#appendix-B.1.6-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.1.6-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "set": [
    {
      "path": "/action",
      "value": "reject"
    },
    {
      "path": "/response",
      "value": {
        "code": 550,
        "enhancedCode": "5.7.1",
        "message": "Message rejected due to spam content"
      }
    }
  ]
}
</pre><a href="#appendix-B.1.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="outbound-delivery-logging">
<section id="appendix-B.2">
        <h3 id="name-outbound-delivery-logging">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-outbound-delivery-logging" class="section-name selfRef">Outbound Delivery Logging</a>
        </h3>
<p id="appendix-B.2-1">This example shows outbound hook usage for delivery status logging and compliance.<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div id="registration-2">
<section id="appendix-B.2.1">
          <h4 id="name-registration-3">
<a href="#appendix-B.2.1" class="section-number selfRef">B.2.1. </a><a href="#name-registration-3" class="section-name selfRef">Registration</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.2.1-1">
<pre>
POST /v1/hooks/register HTTP/1.1
Host: mta.example.com
Content-Type: application/json
Authorization: Bearer sk_live_def456

{
  "name": "Delivery Logger",
  "version": "1.0.0",
  "callback": {
    "url": "https://logger.example.net/hooks/delivery",
    "timeoutMs": 5000
  },
  "serialization": "json",
  "outbound": {
    "stages": ["delivery", "dsn"],
    "actions": ["continue"],
    "properties": null
  }
}
</pre><a href="#appendix-B.2.1-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.2.1-2">
<pre>
HTTP/1.1 201 Created
Content-Type: application/json

{
  "registrationId": "reg_logger_001",
  "status": "active",
  "createdAt": "2024-12-21T11:00:00Z",
  "negotiated": {
    "serialization": "json",
    "outbound": {
      "stages": ["delivery", "dsn"],
      "actions": ["continue"],
      "properties": ["/envelope", "/message", "/queue", "/context"]
    }
  },
  "endpoints": {
    "deregistration": "/v1/hooks/register/reg_logger_001",
    "status": "/v1/hooks/register/reg_logger_001/status"
  }
}
</pre><a href="#appendix-B.2.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hook-invocation-partial-delivery">
<section id="appendix-B.2.2">
          <h4 id="name-hook-invocation-partial-del">
<a href="#appendix-B.2.2" class="section-number selfRef">B.2.2. </a><a href="#name-hook-invocation-partial-del" class="section-name selfRef">Hook Invocation - Partial Delivery</a>
          </h4>
<div class="alignLeft art-text artwork" id="appendix-B.2.2-1">
<pre>
POST /hooks/delivery HTTP/1.1
Host: logger.example.net
Content-Type: application/json
X-MTA-Hooks-Registration: reg_logger_001

{
  "stage": "delivery",
  "action": "continue",
  "timestamp": "2024-12-21T12:00:00Z",
  "queue": {
    "id": "q_msg_12345",
    "expiresAt": "2024-12-24T12:00:00Z",
    "attempts": 1
  },
  "envelope": {
    "from": {"address": "notify@example.com", "parameters": {}},
    "to": [
      {
        "address": "user1@active.example",
        "parameters": {},
        "status": "delivered",
        "attempt": 1,
        "lastResponse": {
          "code": 250,
          "enhancedCode": "2.0.0",
          "message": "Delivered"
        }
      },
      {
        "address": "user2@slow.example",
        "parameters": {},
        "status": "deferred",
        "attempt": 1,
        "lastResponse": {
          "code": 451,
          "enhancedCode": "4.7.1",
          "message": "Greylisted, try again"
        },
        "nextAttemptAt": "2024-12-21T12:15:00Z"
      },
      {
        "address": "user3@invalid.example",
        "parameters": {},
        "status": "failed",
        "attempt": 1,
        "lastResponse": {
          "code": 550,
          "enhancedCode": "5.1.1",
          "message": "User unknown"
        }
      }
    ]
  },
  "message": {
    "subject": "System Notification",
    "messageId": "&lt;notify-12345@example.com&gt;",
    "size": 2048
  }
}
</pre><a href="#appendix-B.2.2-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.2.2-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "action": "continue"
}
</pre><a href="#appendix-B.2.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="deregistration-1">
<section id="appendix-B.3">
        <h3 id="name-deregistration-2">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-deregistration-2" class="section-name selfRef">Deregistration</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-B.3-1">
<pre>
DELETE /v1/hooks/register/reg_spam_001 HTTP/1.1
Host: scanner.example.com
Authorization: Bearer sk_live_abc123
</pre><a href="#appendix-B.3-1" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="appendix-B.3-2">
<pre>
HTTP/1.1 200 OK
Content-Type: application/json

{
  "registrationId": "reg_spam_001",
  "status": "deregistered",
  "deregisteredAt": "2024-12-21T18:00:00Z"
}
</pre><a href="#appendix-B.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The authors thank the developers and operators of existing mail filtering systems whose experience informed this design.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="changes">
<section id="appendix-D">
      <h2 id="name-changes">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-changes" class="section-name selfRef">Changes</a>
      </h2>
<p id="appendix-D-1">[[This section to be removed by RFC Editor]]<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2"><strong>draft-degennaro-mta-hooks-00</strong><a href="#appendix-D-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D-3.1">
          <p id="appendix-D-3.1.1">Initial version<a href="#appendix-D-3.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mauro De Gennaro</span></div>
<div dir="auto" class="left"><span class="org">Stalwart Labs LLC</span></div>
<div dir="auto" class="left"><span class="street-address">1309 Coffeen Avenue, Suite 1200</span></div>
<div dir="auto" class="left">
<span class="locality">Sheridan</span>, <span class="region">WY</span> <span class="postal-code">82801</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mauro@stalw.art" class="email">mauro@stalw.art</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://stalw.art" class="url">https://stalw.art</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
